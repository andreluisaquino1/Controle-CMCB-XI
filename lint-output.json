[{"filePath":"D:\\Projetos\\CMCB-XI\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\demo\\demoSeed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\demo\\demoStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\demo\\useDemoData.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\domain\\balances.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\domain\\ledger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\components\\GastoAssociacaoDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\components\\MensalidadeDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\components\\MovimentarSaldoDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\components\\PixFeeBatchDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\components\\PixNaoIdentificadoDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\components\\__tests__\\GastoAssociacaoDialog.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1477,1480],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1477,1480],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1773,1776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1773,1776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { render, screen, fireEvent, waitFor } from \"@testing-library/react\";\r\nimport { GastoAssociacaoDialog } from \"../GastoAssociacaoDialog\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\nimport { transactionService } from \"@/features/transactions/services/transactionService\";\r\nimport { toast } from \"sonner\";\r\nimport React from \"react\";\r\nimport { ACCOUNT_NAMES } from \"@/shared/lib/constants\";\r\n\r\n// Mock services/hooks\r\nvi.mock(\"@/features/transactions/services/transactionService\", () => ({\r\n    transactionService: {\r\n        createLedgerTransaction: vi.fn().mockResolvedValue({ error: null }),\r\n    }\r\n}));\r\n\r\nvi.mock(\"@/shared/hooks/use-accounts\", () => ({\r\n    useAssociacaoAccounts: vi.fn(() => ({\r\n        data: [\r\n            { id: \"a1\", name: ACCOUNT_NAMES.ESPECIE, balance: 1000, active: true },\r\n            { id: \"a2\", name: ACCOUNT_NAMES.PIX, balance: 2000, active: true },\r\n        ],\r\n        isLoading: false\r\n    })),\r\n    useEntities: vi.fn(() => ({\r\n        data: [{ id: \"e1\", type: \"associacao\", name: \"Associa├º├úo\" }],\r\n        isLoading: false\r\n    }))\r\n}));\r\n\r\nvi.mock(\"sonner\", () => ({\r\n    toast: {\r\n        success: vi.fn(),\r\n        error: vi.fn(),\r\n        warning: vi.fn(),\r\n    }\r\n}));\r\n\r\n// Mock complex form components to be simple inputs\r\nvi.mock(\"@/shared/components/forms/CurrencyInput\", () => ({\r\n    CurrencyInput: ({ value, onChange, id }: any) => (\r\n        <input\r\n            id={id}\r\n            aria-label=\"Valor\"\r\n            value={value}\r\n            onChange={(e) => onChange(Number(e.target.value))}\r\n        />\r\n    )\r\n}));\r\n\r\nvi.mock(\"@/shared/components/forms/DateInput\", () => ({\r\n    DateInput: ({ value, onChange, id }: any) => (\r\n        <input\r\n            id={id}\r\n            type=\"date\"\r\n            value={value}\r\n            onChange={(e) => onChange(e.target.value)}\r\n        />\r\n    )\r\n}));\r\n\r\nconst queryClient = new QueryClient({ defaultOptions: { queries: { retry: false } } });\r\n\r\nconst wrapper = ({ children }: { children: React.ReactNode }) => (\r\n    <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n);\r\n\r\ndescribe(\"GastoAssociacaoDialog\", () => {\r\n    const defaultProps = {\r\n        open: true,\r\n        onOpenChange: vi.fn(),\r\n        state: { date: \"2024-01-01\", meio: \"cash\", obs: \"\" },\r\n        setters: { setDate: vi.fn(), setMeio: vi.fn(), setObs: vi.fn() },\r\n        onSubmit: vi.fn(),\r\n        isLoading: false,\r\n        shortcuts: [],\r\n        addShortcut: vi.fn(),\r\n        removeShortcut: vi.fn(),\r\n    };\r\n\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n    });\r\n\r\n    it(\"should render and allow adding multiple items\", async () => {\r\n        render(<GastoAssociacaoDialog {...defaultProps} />, { wrapper });\r\n\r\n        expect(screen.getByText(\"Registrar Gasto (Lote)\")).toBeDefined();\r\n\r\n        const addButton = screen.getByText(\"Item\");\r\n        fireEvent.click(addButton);\r\n\r\n        // Should now have 2 items (default is 1)\r\n        const inputs = screen.getAllByPlaceholderText(\"Ex: Material\");\r\n        expect(inputs).toHaveLength(2);\r\n    });\r\n\r\n    it(\"should call transactionService on submit\", async () => {\r\n        render(<GastoAssociacaoDialog {...defaultProps} />, { wrapper });\r\n\r\n        // Fill description\r\n        const descInputs = screen.getAllByPlaceholderText(\"Ex: Material\");\r\n        fireEvent.change(descInputs[0], { target: { value: \"Gasolina\" } });\r\n\r\n        // Fill amount (mocked CurrencyInput takes number directly from target.value)\r\n        const amountInputs = screen.getAllByLabelText(/Valor/i);\r\n        fireEvent.change(amountInputs[0], { target: { value: \"50\" } });\r\n\r\n        const submitButton = screen.getByText(\"Lan├ºar Gastos\");\r\n        fireEvent.click(submitButton);\r\n\r\n        await waitFor(() => {\r\n            expect(transactionService.createLedgerTransaction).toHaveBeenCalled();\r\n            expect(toast.success).toHaveBeenCalledWith(\"1 despesas registradas.\");\r\n        });\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\components\\__tests__\\MovimentarSaldoDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\hooks\\__tests__\\use-associacao-actions.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\hooks\\use-associacao-actions.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'isSecretaria'. Either include it or remove the dependency array.","line":421,"column":8,"nodeType":"ArrayExpression","endLine":421,"endColumn":90,"suggestions":[{"desc":"Update the dependencies array to be: [state.ajuste, accountsMap, associacaoEntity, isSecretaria, queryClient, resetAjuste, onSuccess]","fix":{"range":[19179,19261],"text":"[state.ajuste, accountsMap, associacaoEntity, isSecretaria, queryClient, resetAjuste, onSuccess]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useMemo } from 'react';\r\nimport { Account, Entity, Transaction } from '@/types';\r\nimport { toast } from \"sonner\";\r\nimport { formatCurrencyBRL, toCents } from '@/shared/lib/currency';\r\nimport { ACCOUNT_NAMES, ACCOUNT_NAME_TO_LEDGER_KEY, LEDGER_KEYS } from '@/shared/lib/constants';\r\nimport { getTodayString } from '@/shared/lib/date-utils';\r\nimport { transactionService } from \"@/features/transactions/services/transactionService\";\r\nimport {\r\n    mensalidadeSchema,\r\n    gastoAssociacaoSchema,\r\n    movimentarSaldoSchema,\r\n    ajusteSchema\r\n} from \"@/shared/lib/schemas\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { invalidateFinance } from \"@/shared/query/invalidation\";\r\nimport { LedgerStatus } from \"@/shared/constants/ledger\";\r\nimport { useAuth } from \"@/features/auth/contexts/AuthContext\";\r\n\r\ninterface AssociacaoState {\r\n    mensalidade: {\r\n        date: string;\r\n        turno: string;\r\n        cash: number;\r\n        pix: number;\r\n        obs: string;\r\n    };\r\n    gasto: {\r\n        date: string;\r\n        meio: string;\r\n        valor: number;\r\n        descricao: string;\r\n        obs: string;\r\n    };\r\n    mov: {\r\n        date: string;\r\n        de: string;\r\n        para: string;\r\n        valor: number;\r\n        taxa: number;\r\n        descricao: string;\r\n        obs: string;\r\n    };\r\n    ajuste: {\r\n        date: string;\r\n        accountId: string;\r\n        valor: number; // The difference to add/subtract\r\n        motivo: string;\r\n        obs: string;\r\n    };\r\n}\r\n\r\nexport function useAssociacaoActions(\r\n    accounts: Account[] | undefined,\r\n    associacaoEntity?: Entity,\r\n    onSuccess?: () => void\r\n) {\r\n    const queryClient = useQueryClient();\r\n    const { isSecretaria } = useAuth();\r\n    // We'll use local state for loading since we're calling async functions directly\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n    const [state, setState] = useState<AssociacaoState>({\r\n        mensalidade: { date: getTodayString(), turno: \"\", cash: 0, pix: 0, obs: \"\" },\r\n        gasto: { date: getTodayString(), meio: \"cash\", valor: 0, descricao: \"\", obs: \"\" },\r\n        mov: { date: getTodayString(), de: \"\", para: \"\", valor: 0, taxa: 0, descricao: \"\", obs: \"\" },\r\n        ajuste: { date: getTodayString(), accountId: \"\", valor: 0, motivo: \"\", obs: \"\" },\r\n    });\r\n\r\n    const accountsMap = useMemo(() => {\r\n        const map = new Map<string, Account>();\r\n        accounts?.forEach(acc => map.set(acc.id, acc));\r\n        return map;\r\n    }, [accounts]);\r\n\r\n    const especieAccount = useMemo(() => accounts?.find(a => a.name === ACCOUNT_NAMES.ESPECIE), [accounts]);\r\n    const pixAccount = useMemo(() => accounts?.find(a => a.name === ACCOUNT_NAMES.PIX), [accounts]);\r\n    const cofreAccount = useMemo(() => accounts?.find(a => a.name === ACCOUNT_NAMES.COFRE), [accounts]);\r\n    const contaDigitalAccount = useMemo(() => accounts?.find(a => a.name === ACCOUNT_NAMES.CONTA_DIGITAL), [accounts]);\r\n\r\n    const setters = useMemo(() => ({\r\n        setMensalidadeDate: (date: string) => setState((s) => ({ ...s, mensalidade: { ...s.mensalidade, date } })),\r\n        setMensalidadeTurno: (turno: string) => setState((s) => ({ ...s, mensalidade: { ...s.mensalidade, turno } })),\r\n        setMensalidadeCash: (cash: number) => setState((s) => ({ ...s, mensalidade: { ...s.mensalidade, cash } })),\r\n        setMensalidadePix: (pix: number) => setState((s) => ({ ...s, mensalidade: { ...s.mensalidade, pix } })),\r\n        setMensalidadeObs: (obs: string) => setState((s) => ({ ...s, mensalidade: { ...s.mensalidade, obs } })),\r\n        setGastoDate: (date: string) => setState((s) => ({ ...s, gasto: { ...s.gasto, date } })),\r\n        setGastoMeio: (meio: string) => setState((s) => ({ ...s, gasto: { ...s.gasto, meio } })),\r\n        setGastoValor: (valor: number) => setState((s) => ({ ...s, gasto: { ...s.gasto, valor } })),\r\n        setGastoDescricao: (descricao: string) => setState((s) => ({ ...s, gasto: { ...s.gasto, descricao } })),\r\n        setGastoObs: (obs: string) => setState((s) => ({ ...s, gasto: { ...s.gasto, obs } })),\r\n        setMovDate: (date: string) => setState((s) => ({ ...s, mov: { ...s.mov, date } })),\r\n        setMovDe: (de: string) => setState((s) => ({ ...s, mov: { ...s.mov, de } })),\r\n        setMovPara: (para: string) => setState((s) => ({ ...s, mov: { ...s.mov, para } })),\r\n        setMovValor: (valor: number) => setState((s) => ({ ...s, mov: { ...s.mov, valor } })),\r\n        setMovTaxa: (taxa: number) => setState((s) => ({ ...s, mov: { ...s.mov, taxa } })),\r\n        setMovDescricao: (descricao: string) => setState((s) => ({ ...s, mov: { ...s.mov, descricao } })),\r\n        setMovObs: (obs: string) => setState((s) => ({ ...s, mov: { ...s.mov, obs } })),\r\n        setAjusteDate: (date: string) => setState((s) => ({ ...s, ajuste: { ...s.ajuste, date } })),\r\n        setAjusteAccountId: (accountId: string) => setState((s) => ({ ...s, ajuste: { ...s.ajuste, accountId, valor: 0 } })),\r\n        setAjusteValor: (valor: number) => setState((s) => ({ ...s, ajuste: { ...s.ajuste, valor } })),\r\n        setAjusteMotivo: (motivo: string) => setState((s) => ({ ...s, ajuste: { ...s.ajuste, motivo } })),\r\n        setAjusteObs: (obs: string) => setState((s) => ({ ...s, ajuste: { ...s.ajuste, obs } })),\r\n    }), []);\r\n\r\n    const resetMensalidade = useCallback(() => {\r\n        setState((s) => ({ ...s, mensalidade: { date: getTodayString(), turno: \"\", cash: 0, pix: 0, obs: \"\" } }));\r\n    }, []);\r\n\r\n    const resetGasto = useCallback(() => {\r\n        setState((s) => ({ ...s, gasto: { date: getTodayString(), meio: \"cash\", valor: 0, descricao: \"\", obs: \"\" } }));\r\n    }, []);\r\n\r\n    const resetMov = useCallback(() => {\r\n        setState((s) => ({ ...s, mov: { date: getTodayString(), de: \"\", para: \"\", valor: 0, taxa: 0, descricao: \"\", obs: \"\" } }));\r\n    }, []);\r\n\r\n    const resetAjuste = useCallback(() => {\r\n        setState((s) => ({ ...s, ajuste: { date: getTodayString(), accountId: \"\", valor: 0, motivo: \"\", obs: \"\" } }));\r\n    }, []);\r\n\r\n    const handleMensalidadeSubmit = useCallback(async (): Promise<boolean> => {\r\n        const result = mensalidadeSchema.safeParse(state.mensalidade);\r\n        if (!result.success) {\r\n            toast.error(result.error.errors[0].message);\r\n            return false;\r\n        }\r\n\r\n        // We don't necessarily need accounts entities for Ledger if we use constants, but valid for checks\r\n        if (!associacaoEntity) {\r\n            toast.error(\"Entidade n├úo encontrada.\");\r\n            return false;\r\n        }\r\n\r\n\r\n        try {\r\n            setIsSubmitting(true);\r\n\r\n            // TODO: Check for existing transactions in Ledger? \r\n            // For now, let's just create.\r\n\r\n            // 1. Check for existing monthly fee (Cash) if cash > 0\r\n            if (state.mensalidade.cash > 0) {\r\n                const existingCash = await transactionService.checkExistingMonthlyFee(\r\n                    state.mensalidade.date,\r\n                    state.mensalidade.turno,\r\n                    \"cash\"\r\n                );\r\n\r\n                if (existingCash && existingCash.length > 0) {\r\n                    toast.error(`J├í existe lan├ºamento de mensalidade (Esp├®cie) para o turno ${state.mensalidade.turno} nesta data.`);\r\n                    setIsSubmitting(false);\r\n                    return false;\r\n                }\r\n\r\n                await transactionService.createLedgerTransaction({\r\n                    type: \"income\",\r\n                    source_account: LEDGER_KEYS.EXTERNAL_INCOME,\r\n                    destination_account: ACCOUNT_NAME_TO_LEDGER_KEY[ACCOUNT_NAMES.ESPECIE],\r\n                    amount_cents: toCents(state.mensalidade.cash),\r\n                    status: isSecretaria ? LedgerStatus.PENDING : LedgerStatus.VALIDATED,\r\n                    description: `Mensalidade ${state.mensalidade.turno}`,\r\n                    created_at: `${state.mensalidade.date}T12:00:00`, // Set to noon to avoid timezone edge cases\r\n                    metadata: {\r\n                        module: \"mensalidade\",\r\n                        payment_method: \"cash\",\r\n                        shift: state.mensalidade.turno,\r\n                        notes: state.mensalidade.obs\r\n                    }\r\n                });\r\n            }\r\n\r\n            // 2. Check for existing monthly fee (PIX) if pix > 0\r\n            if (state.mensalidade.pix > 0) {\r\n                const existingPix = await transactionService.checkExistingMonthlyFee(\r\n                    state.mensalidade.date,\r\n                    state.mensalidade.turno,\r\n                    \"pix\"\r\n                );\r\n\r\n                if (existingPix && existingPix.length > 0) {\r\n                    toast.error(`J├í existe lan├ºamento de mensalidade (PIX) para o turno ${state.mensalidade.turno} nesta data.`);\r\n                    setIsSubmitting(false);\r\n                    return false;\r\n                }\r\n\r\n                await transactionService.createLedgerTransaction({\r\n                    type: \"income\",\r\n                    source_account: LEDGER_KEYS.EXTERNAL_INCOME,\r\n                    destination_account: ACCOUNT_NAME_TO_LEDGER_KEY[ACCOUNT_NAMES.PIX],\r\n                    amount_cents: toCents(state.mensalidade.pix),\r\n                    status: isSecretaria ? LedgerStatus.PENDING : LedgerStatus.VALIDATED,\r\n                    description: `Mensalidade ${state.mensalidade.turno} (PIX)`,\r\n                    created_at: `${state.mensalidade.date}T12:00:00`,\r\n                    metadata: {\r\n                        module: \"mensalidade_pix\",\r\n                        payment_method: \"pix\",\r\n                        shift: state.mensalidade.turno,\r\n                        notes: state.mensalidade.obs\r\n                    }\r\n                });\r\n            }\r\n\r\n            await invalidateFinance(queryClient);\r\n\r\n            toast.success(\"Mensalidade registrada.\");\r\n            resetMensalidade();\r\n            if (onSuccess) onSuccess();\r\n            return true;\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"Falha ao registrar mensalidade.\");\r\n            return false;\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    }, [state.mensalidade, associacaoEntity, isSecretaria, queryClient, resetMensalidade, onSuccess]);\r\n\r\n\r\n    const handleGastoSubmit = useCallback(async (): Promise<boolean> => {\r\n        const result = gastoAssociacaoSchema.safeParse(state.gasto);\r\n        if (!result.success) {\r\n            toast.error(result.error.errors[0].message);\r\n            return false;\r\n        }\r\n\r\n\r\n        // Mapping source account\r\n        const sourceName = state.gasto.meio === \"cash\" ? ACCOUNT_NAMES.ESPECIE : ACCOUNT_NAMES.PIX;\r\n        const sourceKey = ACCOUNT_NAME_TO_LEDGER_KEY[sourceName];\r\n\r\n        try {\r\n            setIsSubmitting(true);\r\n            await transactionService.createLedgerTransaction({\r\n                type: \"expense\",\r\n                source_account: sourceKey,\r\n                destination_account: LEDGER_KEYS.EXTERNAL_EXPENSE,\r\n                amount_cents: toCents(state.gasto.valor),\r\n                status: isSecretaria ? LedgerStatus.PENDING : LedgerStatus.VALIDATED,\r\n                description: state.gasto.descricao,\r\n                created_at: `${state.gasto.date}T12:00:00`,\r\n                metadata: {\r\n                    module: \"gasto_associacao\",\r\n                    payment_method: state.gasto.meio,\r\n                    notes: state.gasto.obs\r\n                }\r\n            });\r\n\r\n            await invalidateFinance(queryClient);\r\n\r\n            toast.success(\"Gasto registrado.\");\r\n            resetGasto();\r\n            if (onSuccess) onSuccess();\r\n            return true;\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"Falha ao registrar gasto.\");\r\n            return false;\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    }, [state.gasto, isSecretaria, queryClient, resetGasto, onSuccess]);\r\n    const handleMovimentarSubmit = useCallback(async (): Promise<boolean> => {\r\n        const result = movimentarSaldoSchema.safeParse(state.mov);\r\n        if (!result.success) {\r\n            toast.error(result.error.errors[0].message);\r\n            return false;\r\n        }\r\n\r\n        if (!associacaoEntity) return false;\r\n\r\n        const sourceAccount = accounts?.find(a => a.id === state.mov.de);\r\n        const destAccount = accounts?.find(a => a.id === state.mov.para);\r\n        if (!sourceAccount || !destAccount) return false;\r\n\r\n        // Valida├º├úo de saldo (Valor + Taxa)\r\n        const totalAmount = state.mov.valor + state.mov.taxa;\r\n        if (totalAmount > sourceAccount.balance) {\r\n            toast.error(`Saldo insuficiente em ${sourceAccount.name}. Necess├írio ${formatCurrencyBRL(totalAmount)} (Valor + Taxa).`);\r\n            return false;\r\n        }\r\n\r\n        // Phase 4: Rigid rules for Conta Digital\r\n        if (sourceAccount.name === ACCOUNT_NAMES.CONTA_DIGITAL) {\r\n            if (destAccount.name !== ACCOUNT_NAMES.PIX) {\r\n                toast.error(\"A Conta Digital s├│ pode movimentar para o PIX (Conta BB).\");\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // Mapping keys\r\n        const sourceKey = ACCOUNT_NAME_TO_LEDGER_KEY[sourceAccount.name] || sourceAccount.name; // Fallback?\r\n        const destKey = ACCOUNT_NAME_TO_LEDGER_KEY[destAccount.name] || destAccount.name;\r\n\r\n\r\n        try {\r\n            setIsSubmitting(true);\r\n\r\n            // 1. Create Transfer\r\n            // Since createLedgerTransaction (singular) doesn't return the ID easily unless we mod it, \r\n            // maybe we can't link parent_id easily if the function doesn't return it.\r\n            // Let's assume for now we don't link via parent_id or checking ledger.ts again if it returns data.\r\n            // Line 26: const { error } = await supabase...insert(...) \r\n            // It does NOT select the inserted row. So we don't get the ID back.\r\n            // We can add .select() to ledger.ts later if needed. \r\n            // For now, we'll just insert both.\r\n\r\n            await transactionService.createLedgerTransaction({\r\n                type: \"transfer\",\r\n                source_account: sourceKey,\r\n                destination_account: destKey,\r\n                amount_cents: toCents(state.mov.valor),\r\n                description: state.mov.descricao,\r\n                created_at: `${state.mov.date}T12:00:00`,\r\n                status: LedgerStatus.VALIDATED,\r\n                metadata: {\r\n                    module: \"assoc_transfer\",\r\n                    notes: state.mov.obs,\r\n                    taxa_informativa: state.mov.taxa > 0 ? formatCurrencyBRL(state.mov.taxa) : null,\r\n                },\r\n            });\r\n\r\n            // 2. Create Fee Transaction (if applicable)\r\n            if (state.mov.taxa > 0) {\r\n                let feeModule = \"gasto_associacao\";\r\n                // Determine module based on source\r\n                if (sourceAccount.name === ACCOUNT_NAMES.PIX) feeModule = \"taxa_pix_bb\";\r\n                if (sourceAccount.name === ACCOUNT_NAMES.CONTA_DIGITAL) feeModule = \"conta_digital_taxa\";\r\n\r\n                await transactionService.createLedgerTransaction({\r\n                    type: \"expense\",\r\n                    source_account: sourceKey,\r\n                    destination_account: LEDGER_KEYS.EXTERNAL_EXPENSE,\r\n                    amount_cents: toCents(state.mov.taxa),\r\n                    description: `Taxa: ${state.mov.descricao}`,\r\n                    created_at: `${state.mov.date}T12:00:00`,\r\n                    status: LedgerStatus.VALIDATED,\r\n                    metadata: {\r\n                        module: feeModule,\r\n                        original_module: \"movimentacao_taxa\", // for tracking\r\n                        notes: `Taxa referente ├á movimenta├º├úo de ${formatCurrencyBRL(state.mov.valor)}`\r\n                    }\r\n                });\r\n            }\r\n\r\n            await invalidateFinance(queryClient);\r\n\r\n            toast.success(\"Movimenta├º├úo registrada.\");\r\n            resetMov();\r\n            if (onSuccess) onSuccess();\r\n            return true;\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"Falha ao registrar movimenta├º├úo.\");\r\n            return false;\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    }, [state.mov, associacaoEntity, accounts, queryClient, resetMov, onSuccess]);\r\n\r\n    const handleAjusteSubmit = useCallback(async (): Promise<boolean> => {\r\n        const result = ajusteSchema.safeParse(state.ajuste);\r\n        if (!result.success) {\r\n            toast.error(result.error.errors[0].message);\r\n            return false;\r\n        }\r\n\r\n        const account = accountsMap.get(state.ajuste.accountId);\r\n        if (!account || !associacaoEntity) {\r\n            toast.error(\"Conta ou entidade n├úo encontrada.\");\r\n            return false;\r\n        }\r\n\r\n        // Logic for adjustment:\r\n        // Use 'income' for positive adjustment (Money In)\r\n        // Use 'expense' for negative adjustment (Money Out)\r\n        // This ensures the Balance View (SUM CASE) works correctly regardless of 'adjustment' type implementation details.\r\n\r\n        const direction = state.ajuste.valor > 0 ? \"in\" : \"out\";\r\n        const absAmount = Math.abs(state.ajuste.valor);\r\n        const accountKey = ACCOUNT_NAME_TO_LEDGER_KEY[account.name] || account.name;\r\n\r\n        // Helper\r\n\r\n        try {\r\n            setIsSubmitting(true);\r\n\r\n            let module = \"especie_ajuste\";\r\n            if (account.name === ACCOUNT_NAMES.PIX) module = \"pix_ajuste\";\r\n            else if (account.name === ACCOUNT_NAMES.COFRE) module = \"cofre_ajuste\";\r\n            else if (account.name === ACCOUNT_NAMES.CONTA_DIGITAL) module = \"conta_digital_ajuste\";\r\n\r\n            await transactionService.createLedgerTransaction({\r\n                type: direction === 'in' ? 'income' : 'expense',\r\n                source_account: direction === 'in' ? LEDGER_KEYS.EXTERNAL_INCOME : accountKey,\r\n                destination_account: direction === 'in' ? accountKey : LEDGER_KEYS.EXTERNAL_EXPENSE,\r\n                amount_cents: toCents(absAmount),\r\n                status: isSecretaria ? LedgerStatus.PENDING : LedgerStatus.VALIDATED,\r\n                description: `Ajuste: ${state.ajuste.motivo}`,\r\n                created_at: `${state.ajuste.date}T12:00:00`,\r\n                metadata: {\r\n                    module: module,\r\n                    original_type: \"adjustment\", // preserving intent\r\n                    notes: state.ajuste.obs,\r\n                    reason: state.ajuste.motivo\r\n                }\r\n            });\r\n\r\n            await invalidateFinance(queryClient);\r\n\r\n            toast.success(`Ajuste de ${account.name} registrado.`);\r\n            resetAjuste();\r\n            if (onSuccess) onSuccess();\r\n            return true;\r\n        } catch (error) {\r\n            console.error(error);\r\n            toast.error(\"Falha ao registrar ajuste.\");\r\n            return false;\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    }, [state.ajuste, accountsMap, associacaoEntity, queryClient, resetAjuste, onSuccess]);\r\n\r\n    const handlers = useMemo(() => ({\r\n        handleMensalidadeSubmit,\r\n        handleGastoSubmit,\r\n        handleMovimentarSubmit,\r\n        handleAjusteSubmit,\r\n        resetMensalidade,\r\n        resetGasto,\r\n        resetMov,\r\n        resetAjuste\r\n    }), [\r\n        handleMensalidadeSubmit,\r\n        handleGastoSubmit,\r\n        handleMovimentarSubmit,\r\n        handleAjusteSubmit,\r\n        resetMensalidade,\r\n        resetGasto,\r\n        resetMov,\r\n        resetAjuste\r\n    ]);\r\n\r\n    return {\r\n        state,\r\n        setters,\r\n        handlers,\r\n        isLoading: isSubmitting,\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\hooks\\use-pix-batch.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\pages\\AssociacaoPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":370,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15646,15649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15646,15649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DashboardLayout } from \"@/shared/components/DashboardLayout\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useExpenseShortcuts } from \"@/features/transactions/hooks/use-expense-shortcuts\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/shared/ui/card\";\r\nimport { Button } from \"@/shared/ui/button\";\r\nimport { Input } from \"@/shared/ui/input\";\r\nimport { Label } from \"@/shared/ui/label\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/shared/ui/select\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/shared/ui/dialog\";\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from \"@/shared/ui/table\";\r\nimport { useState } from \"react\";\r\nimport { Building2, Banknote, CreditCard, ArrowRightLeft, Settings, Wallet, Loader2, XCircle, X, PlusCircle, MinusCircle, ChevronDown, ChevronUp } from \"lucide-react\";\r\nimport { CurrencyInput } from \"@/shared/components/forms/CurrencyInput\";\r\nimport { DateInput } from \"@/shared/components/forms/DateInput\";\r\nimport { useVoidTransaction } from \"@/features/transactions/hooks/use-transactions\";\r\nimport { useAssociacaoAccounts, useEntities } from \"@/shared/hooks/use-accounts\";\r\nimport { useAssociacaoTransactions } from \"@/features/transactions/hooks/use-entity-transactions\";\r\nimport { formatDateBR } from \"@/shared/lib/date-utils\";\r\nimport { formatCurrencyBRL } from \"@/shared/lib/currency\";\r\nimport { ACCOUNT_NAMES, MODULE_LABELS } from \"@/shared/lib/constants\";\r\nimport { useAssociacaoActions } from \"@/features/associacao/hooks/use-associacao-actions\";\r\nimport { VoidTransactionDialog } from \"@/shared/components/VoidTransactionDialog\";\r\nimport { ActionCard } from \"@/shared/components/ActionCard\";\r\nimport { MensalidadeDialog } from \"@/features/associacao/components/MensalidadeDialog\";\r\nimport { GastoAssociacaoDialog } from \"@/features/associacao/components/GastoAssociacaoDialog\";\r\nimport { MovimentarSaldoDialog } from \"@/features/associacao/components/MovimentarSaldoDialog\";\r\nimport { AjustarSaldoDialog } from \"@/features/recursos/components/AjustarSaldoDialog\";\r\nimport { TransactionTable } from \"@/features/transactions/components/TransactionTable\";\r\nimport { PixFeeBatchDialog } from \"@/features/associacao/components/PixFeeBatchDialog\";\r\nimport { PixNaoIdentificadoDialog } from \"@/features/associacao/components/PixNaoIdentificadoDialog\";\r\nimport { FileText, Ghost, ListPlus } from \"lucide-react\";\r\nimport { TransactionExportActions } from \"@/features/transactions/components/TransactionExportActions\";\r\nimport { TransactionFilters } from \"@/features/transactions/components/TransactionFilters\";\r\nimport { startOfMonth } from \"date-fns\";\r\nimport { useAuth } from \"@/features/auth/contexts/AuthContext\";\r\nimport { useApproveTransaction } from \"@/features/transactions/hooks/use-transactions\";\r\nimport { useReportData } from \"@/features/dashboard/hooks/use-dashboard-data\";\r\nimport { getWeekStartDate, formatDateString, getTodayString } from \"@/shared/lib/date-utils\";\r\n\r\nexport default function AssociacaoPage() {\r\n  const [openDialog, setOpenDialog] = useState<string | null>(null);\r\n  const [showInfo, setShowInfo] = useState(false);\r\n  const [dateRange, setDateRange] = useState({\r\n    start: formatDateString(startOfMonth(new Date())),\r\n    end: getTodayString()\r\n  });\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n\r\n  const voidTransaction = useVoidTransaction();\r\n  const { data: accounts, isLoading: accountsLoading } = useAssociacaoAccounts();\r\n  const { data: entities } = useEntities();\r\n  const { data: transitions, isLoading: transactionsLoading } = useAssociacaoTransactions(dateRange.start, dateRange.end);\r\n  const { isSecretaria, isAdmin, profile } = useAuth();\r\n  const approveTransaction = useApproveTransaction();\r\n\r\n  const weekStart = getWeekStartDate();\r\n  const weekStartStr = formatDateString(weekStart);\r\n  const todayStr = getTodayString();\r\n\r\n  const { data: reportData } = useReportData(\r\n    weekStartStr,\r\n    todayStr,\r\n    entities?.find(e => e.type === \"associacao\")?.id\r\n  );\r\n\r\n  const totalWeeklyEntries = (reportData?.weeklyEntriesCash || 0) + (reportData?.weeklyEntriesPix || 0);\r\n\r\n  const { shortcuts: expenseShortcuts, addShortcut, removeShortcut } = useExpenseShortcuts();\r\n\r\n  const associacaoEntity = entities?.find(e => e.type === \"associacao\");\r\n  const specieAccount = accounts?.find(a => a.name === ACCOUNT_NAMES.ESPECIE);\r\n  const cofreAccount = accounts?.find(a => a.name === ACCOUNT_NAMES.COFRE);\r\n  const pixAccount = accounts?.find(a => a.name === ACCOUNT_NAMES.PIX);\r\n\r\n  const {\r\n    state,\r\n    setters,\r\n    handlers,\r\n    isLoading: actionsLoading\r\n  } = useAssociacaoActions(accounts || [], associacaoEntity);\r\n\r\n  const contaDigitalAccount = accounts?.find(a => a.name === ACCOUNT_NAMES.CONTA_DIGITAL);\r\n\r\n  const { mensalidade, gasto, mov, ajuste } = state;\r\n  const {\r\n    setMensalidadeDate, setMensalidadeTurno, setMensalidadeCash, setMensalidadePix, setMensalidadeObs,\r\n    setGastoDate, setGastoMeio, setGastoObs,\r\n    setMovDate, setMovDe, setMovPara, setMovValor, setMovDescricao, setMovObs,\r\n    setMovTaxa,\r\n    setAjusteDate, setAjusteAccountId, setAjusteValor, setAjusteMotivo, setAjusteObs,\r\n  } = setters;\r\n  const {\r\n    handleMensalidadeSubmit, handleMovimentarSubmit,\r\n    handleAjusteSubmit,\r\n    resetMensalidade, resetGasto, resetMov, resetAjuste\r\n  } = handlers;\r\n\r\n\r\n  // Void transaction state\r\n  const [voidingId, setVoidingId] = useState<string | null>(null);\r\n  const [voidReason, setVoidReason] = useState(\"\");\r\n\r\n  const handleVoidTx = async () => {\r\n    if (!voidingId || !voidReason.trim()) return;\r\n    await voidTransaction.mutateAsync({ transactionId: voidingId, reason: voidReason });\r\n    setVoidingId(null);\r\n    setVoidReason(\"\");\r\n  };\r\n\r\n  const getAccountDisplayName = (name: string) => {\r\n    if (name === ACCOUNT_NAMES.ESPECIE) return \"Esp├®cie\";\r\n    if (name === ACCOUNT_NAMES.COFRE) return \"Cofre\";\r\n    if (name === ACCOUNT_NAMES.PIX) return \"PIX (Conta BB)\";\r\n    if (name === ACCOUNT_NAMES.CONTA_DIGITAL) return \"Conta Digital (Escolaweb)\";\r\n    return name;\r\n  };\r\n\r\n  const totalBalance = (Number(specieAccount?.balance || 0)) +\r\n    (Number(pixAccount?.balance || 0)) +\r\n    (Number(contaDigitalAccount?.balance || 0)) +\r\n    (Number(cofreAccount?.balance || 0));\r\n\r\n  return (\r\n    <DashboardLayout>\r\n      <div className=\"space-y-6 animate-fade-in\">\r\n        {/* Page Header */}\r\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-foreground\">Associa├º├úo</h1>\r\n            <p className=\"text-muted-foreground\">\r\n              Gest├úo de mensalidades, gastos e movimenta├º├Áes\r\n            </p>\r\n          </div>\r\n          {!isSecretaria && (\r\n            <div className=\"bg-primary/10 px-3 py-1.5 rounded-full flex items-center gap-2 border border-primary/20\">\r\n              <span className=\"text-xs font-semibold text-primary uppercase tracking-wider\">Saldo Total</span>\r\n              {accountsLoading ? (\r\n                <Loader2 className=\"h-3 w-3 animate-spin text-primary\" />\r\n              ) : (\r\n                <span className=\"text-sm font-bold text-foreground tabular-nums\">{formatCurrencyBRL(totalBalance)}</span>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Balances */}\r\n        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\r\n          {isSecretaria ? (\r\n            <Card className=\"stat-card-success lg:col-span-4\">\r\n              <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\r\n                  <Banknote className=\"h-4 w-4\" />\r\n                  Entradas da Semana (Arrecada├º├úo)\r\n                </CardTitle>\r\n                <div className=\"text-xs text-muted-foreground\">\r\n                  Per├¡odo: {formatDateBR(weekStartStr)} at├® hoje\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-3xl font-bold text-success\">\r\n                  {formatCurrencyBRL(totalWeeklyEntries)}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          ) : (\r\n            <>\r\n\r\n              <Card className=\"stat-card-primary\">\r\n                <CardHeader className=\"pb-2\">\r\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\r\n                    <Wallet className=\"h-4 w-4\" />\r\n                    Esp├®cie\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {accountsLoading ? (\r\n                    <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n                  ) : (\r\n                    <div className=\"text-2xl font-bold text-foreground\">\r\n                      {formatCurrencyBRL(Number(specieAccount?.balance || 0))}\r\n                    </div>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n\r\n              <Card className=\"stat-card-secondary\">\r\n                <CardHeader className=\"pb-2\">\r\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\r\n                    <CreditCard className=\"h-4 w-4\" />\r\n                    PIX (Conta BB)\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {accountsLoading ? (\r\n                    <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n                  ) : (\r\n                    <div className={`text-2xl font-bold ${(Number(pixAccount?.balance || 0)) < 0 ? \"text-destructive\" : \"text-foreground\"}`}>\r\n                      {formatCurrencyBRL(Number(pixAccount?.balance || 0))}\r\n                    </div>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n\r\n              <Card className=\"stat-card-primary border-l-indigo-600\">\r\n                <CardHeader className=\"pb-2\">\r\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\r\n                    <CreditCard className=\"h-4 w-4\" />\r\n                    Conta Digital (Escolaweb)\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {accountsLoading ? (\r\n                    <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n                  ) : (\r\n                    <div className={`text-2xl font-bold ${(Number(contaDigitalAccount?.balance || 0)) < 0 ? \"text-destructive\" : \"text-foreground\"}`}>\r\n                      {formatCurrencyBRL(Number(contaDigitalAccount?.balance || 0))}\r\n                    </div>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n\r\n              <Card className=\"stat-card-accent\">\r\n                <CardHeader className=\"pb-2\">\r\n                  <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\r\n                    <Wallet className=\"h-4 w-4\" />\r\n                    Cofre\r\n                  </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  {accountsLoading ? (\r\n                    <Loader2 className=\"h-5 w-5 animate-spin\" />\r\n                  ) : (\r\n                    <div className=\"text-2xl font-bold text-foreground\">\r\n                      {formatCurrencyBRL(cofreAccount?.balance || 0)}\r\n                    </div>\r\n                  )}\r\n                </CardContent>\r\n              </Card>\r\n            </>\r\n          )}\r\n        </div>\r\n\r\n        {/* Quick Actions Consolidated with Visual Hierarchy */}\r\n        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\r\n          {/* Row 1 - Stronger Colors */}\r\n          <ActionCard\r\n            title=\"Mensalidades\"\r\n            description=\"Registrar entrada de alunos\"\r\n            icon={Banknote}\r\n            variant=\"success\"\r\n            onClick={() => setOpenDialog(\"mensalidade\")}\r\n            className=\"bg-success/15 border-l-success shadow-sm\"\r\n          />\r\n\r\n          <ActionCard\r\n            title=\"Despesa Associa├º├úo\"\r\n            description=\"Registrar pagamento direto\"\r\n            icon={CreditCard}\r\n            variant=\"destructive\"\r\n            onClick={() => setOpenDialog(\"gasto\")}\r\n            className=\"bg-destructive/15 border-l-destructive shadow-sm\"\r\n          />\r\n\r\n          {!isSecretaria && (\r\n            <>\r\n              <ActionCard\r\n                title=\"Movimentar Saldo\"\r\n                description=\"Transfer├¬ncia ou Dep├│sito\"\r\n                icon={ArrowRightLeft}\r\n                variant=\"secondary\"\r\n                onClick={() => setOpenDialog(\"movimentar\")}\r\n                className=\"bg-secondary/15 border-l-secondary shadow-sm\"\r\n              />\r\n\r\n              {/* Row 2 - Subtle Colors */}\r\n              <ActionCard\r\n                title=\"PIX Fantasma\"\r\n                description=\"Registrar PIX n├úo identificado\"\r\n                icon={Ghost}\r\n                variant=\"warning\"\r\n                onClick={() => setOpenDialog(\"pix_nao_id\")}\r\n                className=\"opacity-80 border-l-amber-500/50\"\r\n              />\r\n\r\n              <ActionCard\r\n                title=\"Taxas PIX\"\r\n                description=\"Lan├ºar tarifas em lote\"\r\n                icon={FileText}\r\n                variant=\"info\"\r\n                onClick={() => setOpenDialog(\"pix_batch\")}\r\n                className=\"opacity-80 border-l-blue-600/50\"\r\n              />\r\n\r\n              <ActionCard\r\n                title=\"Ajustar Saldo\"\r\n                description=\"Corre├º├úo ou valor inicial\"\r\n                icon={Settings}\r\n                variant=\"warning\"\r\n                onClick={() => setOpenDialog(\"ajuste\")}\r\n                className=\"opacity-80 border-l-warning/50\"\r\n              />\r\n            </>\r\n          )}\r\n        </div>\r\n\r\n\r\n      </div>\r\n\r\n      <TransactionFilters\r\n        startDate={dateRange.start}\r\n        endDate={dateRange.end}\r\n        onDateChange={(start, end) => setDateRange({ start, end })}\r\n        searchTerm={searchTerm}\r\n        onSearchChange={setSearchTerm}\r\n        onClear={() => {\r\n          setDateRange({\r\n            start: formatDateString(startOfMonth(new Date())),\r\n            end: getTodayString()\r\n          });\r\n          setSearchTerm(\"\");\r\n        }}\r\n        isLoading={transactionsLoading}\r\n      />\r\n\r\n      {/* Transactions Table */}\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex flex-row items-center justify-between\">\r\n            <CardTitle className=\"flex items-center gap-2 text-lg\">\r\n              <Building2 className=\"h-5 w-5 text-primary\" />\r\n              Hist├│rico da Associa├º├úo\r\n            </CardTitle>\r\n            <TransactionExportActions transactions={transitions} filename=\"associacao_relatorio\" />\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <TransactionTable\r\n            transactions={transitions?.filter(t => {\r\n              // Status Filter\r\n              if (t.status === 'voided') return false;\r\n\r\n              // Permission Filter\r\n              if (isSecretaria && t.created_by !== profile?.user_id) return false;\r\n\r\n              // Search Filter\r\n              if (!searchTerm) return true;\r\n\r\n              const searchLower = searchTerm.toLowerCase();\r\n              const description = t.description?.toLowerCase() || '';\r\n              const amount = t.amount?.toString() || '';\r\n              const tx = t as any;\r\n              const accountName = tx.account?.name?.toLowerCase() || '';\r\n              const category = tx.category?.toLowerCase() || '';\r\n              const obs = tx.metadata && typeof tx.metadata === 'object' ?\r\n                (tx.metadata.observation || tx.metadata.notes || '').toLowerCase() : '';\r\n\r\n              return description.includes(searchLower) ||\r\n                amount.includes(searchLower) ||\r\n                accountName.includes(searchLower) ||\r\n                category.includes(searchLower) ||\r\n                obs.includes(searchLower);\r\n            }) || []}\r\n            isLoading={transactionsLoading}\r\n            onVoid={(id) => setVoidingId(id)}\r\n            onValidate={!isSecretaria ? (id) => approveTransaction.mutate(id) : undefined}\r\n            isValidating={approveTransaction.isPending}\r\n            showShift={true}\r\n            showMethod={true}\r\n          />\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Footer Info Section - Collapsible */}\r\n      <Card className=\"bg-muted/30 border-dashed overflow-hidden\">\r\n        <CardHeader\r\n          className=\"py-3 cursor-pointer hover:bg-muted/50 transition-colors\"\r\n          onClick={() => setShowInfo(!showInfo)}\r\n        >\r\n          <div className=\"flex items-center justify-between\">\r\n            <CardTitle className=\"flex items-center gap-2 text-md font-semibold text-muted-foreground\">\r\n              <Building2 className=\"h-4 w-4\" />\r\n              Informa├º├Áes da Associa├º├úo CMCB-XI\r\n            </CardTitle>\r\n            {showInfo ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\r\n          </div>\r\n        </CardHeader>\r\n        {showInfo && (\r\n          <CardContent className=\"pt-2 pb-6 animate-in fade-in slide-in-from-top-2 duration-300\">\r\n            <div className=\"grid gap-6 sm:grid-cols-2\">\r\n              <div className=\"space-y-3\">\r\n                <div className=\"space-y-1\">\r\n                  <h4 className=\"font-bold text-foreground\">Institucional:</h4>\r\n                  <p className=\"text-sm text-muted-foreground\"><strong>CNPJ:</strong> 37.812.756/0001-45</p>\r\n                  <p className=\"text-sm text-muted-foreground leading-relaxed\">\r\n                    Respons├ível pela gest├úo das mensalidades volunt├írias e custeio das despesas operacionais.\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <h4 className=\"font-bold text-foreground mb-2\">Canais de Recebimento:</h4>\r\n                <div className=\"grid grid-cols-1 gap-2\">\r\n                  <div className=\"bg-background/50 p-2 rounded border border-border/50 text-[11px]\">\r\n                    <span className=\"font-semibold block\">PIX (Banco do Brasil)</span>\r\n                    Ag: 0782-0 | CC: 36500-9\r\n                  </div>\r\n                  <div className=\"bg-background/50 p-2 rounded border border-border/50 text-[11px]\">\r\n                    <span className=\"font-semibold block\">Escolaweb</span>\r\n                    Mensalidades recorrentes e sistema de taxas.\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        )}\r\n      </Card>\r\n\r\n      {/* Void Transaction Dialog */}\r\n      <VoidTransactionDialog\r\n        open={!!voidingId}\r\n        onClose={() => setVoidingId(null)}\r\n        reason={voidReason}\r\n        onReasonChange={setVoidReason}\r\n        onConfirm={handleVoidTx}\r\n        isPending={voidTransaction.isPending}\r\n        inputId=\"void-reason-assoc\"\r\n      />\r\n\r\n      {/* Dialogs shifted outside the main content for better organization */}\r\n      <MensalidadeDialog\r\n        open={openDialog === \"mensalidade\"}\r\n        onOpenChange={(o) => {\r\n          setOpenDialog(o ? \"mensalidade\" : null);\r\n          if (!o) resetMensalidade();\r\n        }}\r\n        state={mensalidade}\r\n        setters={{\r\n          setDate: setMensalidadeDate,\r\n          setTurno: setMensalidadeTurno,\r\n          setCash: setMensalidadeCash,\r\n          setPix: setMensalidadePix,\r\n          setObs: setMensalidadeObs,\r\n        }}\r\n        onSubmit={handleMensalidadeSubmit}\r\n        isLoading={actionsLoading}\r\n      />\r\n\r\n      <GastoAssociacaoDialog\r\n        open={openDialog === \"gasto\"}\r\n        onOpenChange={(o) => {\r\n          setOpenDialog(o ? \"gasto\" : null);\r\n          if (!o) resetGasto();\r\n        }}\r\n        state={gasto}\r\n        setters={{\r\n          setDate: setGastoDate,\r\n          setMeio: setGastoMeio,\r\n          setObs: setGastoObs,\r\n        }}\r\n        shortcuts={expenseShortcuts}\r\n        addShortcut={addShortcut}\r\n        removeShortcut={removeShortcut}\r\n        onSubmit={handlers.handleGastoSubmit}\r\n        isLoading={actionsLoading}\r\n      />\r\n\r\n      <MovimentarSaldoDialog\r\n        open={openDialog === \"movimentar\"}\r\n        onOpenChange={(o) => {\r\n          setOpenDialog(o ? \"movimentar\" : null);\r\n          if (!o) resetMov();\r\n        }}\r\n        state={mov}\r\n        setters={{\r\n          setDate: setMovDate,\r\n          setDe: setMovDe,\r\n          setPara: setMovPara,\r\n          setValor: setMovValor,\r\n          setTaxa: setMovTaxa,\r\n          setDescricao: setMovDescricao,\r\n          setObs: setMovObs,\r\n        }}\r\n        accounts={accounts || []}\r\n        onSubmit={handleMovimentarSubmit}\r\n        isLoading={actionsLoading}\r\n      />\r\n\r\n      <AjustarSaldoDialog\r\n        open={openDialog === \"ajuste\"}\r\n        onOpenChange={(o) => {\r\n          setOpenDialog(o ? \"ajuste\" : null);\r\n          if (!o) handlers.resetAjuste();\r\n        }}\r\n        state={ajuste}\r\n        setters={{\r\n          setDate: setters.setAjusteDate,\r\n          setAccountId: setters.setAjusteAccountId,\r\n          setValor: setters.setAjusteValor,\r\n          setMotivo: setters.setAjusteMotivo,\r\n          setObs: setters.setAjusteObs,\r\n        }}\r\n        accounts={accounts || []}\r\n        onSubmit={handlers.handleAjusteSubmit}\r\n        isLoading={actionsLoading}\r\n      />\r\n\r\n      <PixFeeBatchDialog\r\n        open={openDialog === \"pix_batch\"}\r\n        onOpenChange={(o) => setOpenDialog(o ? \"pix_batch\" : null)}\r\n        entityId={associacaoEntity?.id || null}\r\n      />\r\n\r\n      <PixNaoIdentificadoDialog\r\n        open={openDialog === \"pix_nao_id\"}\r\n        onOpenChange={(o) => setOpenDialog(o ? \"pix_nao_id\" : null)}\r\n        entityId={associacaoEntity?.id || null}\r\n      />\r\n    </DashboardLayout >\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\associacao\\pages\\__tests__\\AssociacaoPage.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2179,2182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2179,2182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5707,5710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5707,5710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5740,5743],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5740,5743],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { createMockQueryResult } from \"@/test/test-utils\";\r\nimport { render, screen } from \"@testing-library/react\";\r\nimport AssociacaoPage from \"@/features/associacao/pages/AssociacaoPage\";\r\nimport React from \"react\";\r\nimport { useAssociacaoAccounts, useEntities } from \"@/shared/hooks/use-accounts\";\r\nimport { useAssociacaoTransactions } from \"@/features/transactions/hooks/use-entity-transactions\";\r\nimport { useAssociacaoActions } from \"@/features/associacao/hooks/use-associacao-actions\";\r\nimport { useExpenseShortcuts } from \"@/features/transactions/hooks/use-expense-shortcuts\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\n\r\n// Mock hooks\r\nvi.mock(\"@/shared/hooks/use-accounts\", () => ({\r\n    useAssociacaoAccounts: vi.fn(),\r\n    useEntities: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/hooks/use-entity-transactions\", () => ({\r\n    useAssociacaoTransactions: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/associacao/hooks/use-associacao-actions\", () => ({\r\n    useAssociacaoActions: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/hooks/use-transactions\", () => ({\r\n    useVoidTransaction: vi.fn(() => ({\r\n        mutateAsync: vi.fn(),\r\n        isPending: false\r\n    })),\r\n    useApproveTransaction: vi.fn(() => ({\r\n        mutateAsync: vi.fn(),\r\n        isPending: false\r\n    }))\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/hooks/use-expense-shortcuts\", () => ({\r\n    useExpenseShortcuts: vi.fn(() => ({\r\n        shortcuts: [],\r\n        addShortcut: vi.fn(),\r\n        removeShortcut: vi.fn()\r\n    }))\r\n}));\r\n\r\n// Mock auth\r\nvi.mock(\"@/features/auth/contexts/AuthContext\", () => ({\r\n    useAuth: vi.fn(() => ({\r\n        user: { id: \"user-123\" },\r\n        profile: { role: \"admin\" },\r\n        isAdmin: true,\r\n        isDemo: false,\r\n        isSecretaria: false,\r\n        loading: false,\r\n    }))\r\n}));\r\n\r\n// Mock layout/components\r\nvi.mock(\"@/shared/components/DashboardLayout\", () => ({\r\n    DashboardLayout: ({ children }: { children: React.ReactNode }) => <div>{children}</div>\r\n}));\r\n\r\nvi.mock(\"@/shared/components/ActionCard\", () => ({\r\n    ActionCard: ({ title, onClick }: any) => <div onClick={onClick} data-testid=\"action-card\">{title}</div>\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/components/TransactionTable\", () => ({\r\n    TransactionTable: () => <div data-testid=\"transaction-table\">Mock Table</div>\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/components/TransactionExportActions\", () => ({\r\n    TransactionExportActions: () => <div>Mock Export</div>\r\n}));\r\n\r\n// Mock Dialogs\r\nvi.mock(\"@/features/associacao/components/MensalidadeDialog\", () => ({ MensalidadeDialog: () => <div>Mock Mensalidade</div> }));\r\nvi.mock(\"@/features/associacao/components/GastoAssociacaoDialog\", () => ({ GastoAssociacaoDialog: () => <div>Mock Gasto</div> }));\r\nvi.mock(\"@/features/associacao/components/MovimentarSaldoDialog\", () => ({ MovimentarSaldoDialog: () => <div>Mock Movimentar</div> }));\r\nvi.mock(\"@/features/recursos/components/AjustarSaldoDialog\", () => ({ AjustarSaldoDialog: () => <div>Mock Ajustar</div> }));\r\nvi.mock(\"@/features/associacao/components/PixFeeBatchDialog\", () => ({ PixFeeBatchDialog: () => <div>Mock Pix Fee</div> }));\r\nvi.mock(\"@/features/associacao/components/PixNaoIdentificadoDialog\", () => ({ PixNaoIdentificadoDialog: () => <div>Mock Pix Nao Id</div> }));\r\n\r\nconst createWrapper = () => {\r\n    const queryClient = new QueryClient({\r\n        defaultOptions: { queries: { retry: false } },\r\n    });\r\n    return ({ children }: { children: React.ReactNode }) => (\r\n        <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n    );\r\n};\r\n\r\ndescribe(\"AssociacaoPage integration\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n\r\n        // Setup default mocks\r\n        vi.mocked(useAssociacaoAccounts).mockReturnValue(createMockQueryResult([\r\n            { id: \"acc-esp\", name: \"ESPECIE\", balance: 1000, entity_id: \"ent-assoc\", active: true, type: \"cash\", agency: \"\", bank: \"\", account_number: \"\" },\r\n            { id: \"acc-pix\", name: \"PIX\", balance: 2500, entity_id: \"ent-assoc\", active: true, type: \"bank\", agency: \"0001\", bank: \"BB\", account_number: \"123\" },\r\n            { id: \"acc-dig\", name: \"CONTA_DIGITAL\", balance: 5000, entity_id: \"ent-assoc\", active: true, type: \"bank\", agency: \"0001\", bank: \"Inter\", account_number: \"456\" },\r\n            { id: \"acc-cof\", name: \"COFRE\", balance: 100, entity_id: \"ent-assoc\", active: true, type: \"cash\", agency: \"\", bank: \"\", account_number: \"\" }\r\n        ]));\r\n\r\n        vi.mocked(useEntities).mockReturnValue(createMockQueryResult([\r\n            { id: \"ent-assoc\", type: \"associacao\", name: \"Associa├º├úo CMCB-XI\", cnpj: \"00.000.000/0001-00\" }\r\n        ]));\r\n\r\n        vi.mocked(useAssociacaoTransactions).mockReturnValue(createMockQueryResult([{\r\n            id: \"t1\", amount: 50, description: \"Mensalidade Teste\", created_at: new Date().toISOString(),\r\n            creator_name: \"User\", source_account_name: \"Source\", destination_account_name: \"Dest\",\r\n            merchant_name: \"Merch\", payment_method: \"cash\", shift: \"matutino\", created_by: \"user-id\",\r\n            transaction_date: \"2024-01-01\", type: \"income\", status: \"completed\",\r\n            account_id: \"acc-1\", entity_id: \"ent-assoc\", category_id: \"cat-1\",\r\n            module: \"mensalidade\", direction: \"in\", notes: \"\", source_account_id: \"acc-source\",\r\n            destination_account_id: \"acc-dest\", merchant_id: \"merch-1\", origin_fund: \"fund\",\r\n            parent_transaction_id: null\r\n        }]));\r\n\r\n        vi.mocked(useAssociacaoActions).mockReturnValue({\r\n            state: { mensalidade: {}, gasto: {}, mov: {}, ajuste: {} } as any,\r\n            setters: {} as any,\r\n            handlers: {\r\n                resetMensalidade: vi.fn(),\r\n                resetGasto: vi.fn(),\r\n                handleMensalidadeSubmit: vi.fn(),\r\n                handleGastoSubmit: vi.fn(),\r\n                handleMovimentarSubmit: vi.fn(),\r\n                handleAjusteSubmit: vi.fn(),\r\n                resetMov: vi.fn(),\r\n                resetAjuste: vi.fn(),\r\n            },\r\n            isLoading: false\r\n        });\r\n    });\r\n\r\n    it(\"should render page header and balance cards\", async () => {\r\n        render(<AssociacaoPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Associa├º├úo\")).toBeDefined();\r\n        expect(screen.getByText(\"Esp├®cie\")).toBeDefined();\r\n        expect(screen.getByText(\"PIX (Conta BB)\")).toBeDefined();\r\n        expect(screen.getByText(\"Conta Digital (Escolaweb)\")).toBeDefined();\r\n        expect(screen.getByText(\"Cofre\")).toBeDefined();\r\n    });\r\n\r\n    it(\"should render action cards\", () => {\r\n        render(<AssociacaoPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Mensalidades\")).toBeDefined();\r\n        expect(screen.getByText(\"Despesa Associa├º├úo\")).toBeDefined();\r\n        expect(screen.getByText(\"Movimentar Saldo\")).toBeDefined();\r\n        expect(screen.getByText(\"PIX Fantasma\")).toBeDefined();\r\n        expect(screen.getByText(\"Taxas PIX\")).toBeDefined();\r\n        expect(screen.getByText(\"Ajustar Saldo\")).toBeDefined();\r\n    });\r\n\r\n    it(\"should render the transaction history table\", () => {\r\n        render(<AssociacaoPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Hist├│rico da Associa├º├úo\")).toBeDefined();\r\n        expect(screen.getByTestId(\"transaction-table\")).toBeDefined();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\auth\\contexts\\AuthContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":140,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":140,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { User, Session } from \"@supabase/supabase-js\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { env } from \"@/shared/lib/env\";\r\nimport { toast } from \"sonner\";\r\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\r\nimport { profileService, Profile } from \"@/features/users/services/profileService\";\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  session: Session | null;\r\n  profile: Profile | null;\r\n  isAdmin: boolean;\r\n  isDemo: boolean;\r\n  isSecretaria: boolean;\r\n  loading: boolean;\r\n  signIn: (email: string, password: string) => Promise<{ error: Error | null }>;\r\n  signUp: (email: string, password: string, name: string) => Promise<{ error: Error | null }>;\r\n  signOut: () => Promise<void>;\r\n  resetPassword: (email: string) => Promise<{ error: Error | null }>;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [session, setSession] = useState<Session | null>(null);\r\n  const [authLoading, setAuthLoading] = useState(true);\r\n  const queryClient = useQueryClient();\r\n\r\n  // Profile management via React Query\r\n  const {\r\n    data: profile,\r\n    isLoading: profileLoading,\r\n    isFetching: profileFetching,\r\n  } = useQuery({\r\n    queryKey: [\"profile\", user?.id],\r\n    queryFn: () => profileService.getProfile(user!.id),\r\n    enabled: !!user,\r\n    staleTime: 1000 * 60 * 15, // 15 minutes\r\n  });\r\n\r\n  useEffect(() => {\r\n    // 1. Initial manual check for session\r\n    supabase.auth.getSession().then(({ data: { session: existingSession } }) => {\r\n      setSession(existingSession);\r\n      setUser(existingSession?.user ?? null);\r\n      setAuthLoading(false);\r\n    });\r\n\r\n    // 2. Set up auth state listener\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\r\n      (event, currentSession) => {\r\n        setSession(currentSession);\r\n        setUser(currentSession?.user ?? null);\r\n\r\n        if (event === \"SIGNED_OUT\") {\r\n          queryClient.clear(); // Clear all queries on sign out\r\n        }\r\n\r\n        if (event === \"PASSWORD_RECOVERY\") {\r\n          window.location.href = \"/auth/reset-password\";\r\n        }\r\n      }\r\n    );\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, [queryClient]);\r\n\r\n  const signIn = async (email: string, password: string) => {\r\n    const { error } = await supabase.auth.signInWithPassword({\r\n      email,\r\n      password,\r\n    });\r\n    return { error };\r\n  };\r\n\r\n  const signUp = async (email: string, password: string, name: string) => {\r\n    setAuthLoading(true);\r\n    try {\r\n      const origin = env.VITE_PUBLIC_SITE_URL || window.location.origin;\r\n      const { error } = await supabase.auth.signUp({\r\n        email,\r\n        password,\r\n        options: {\r\n          emailRedirectTo: `${origin}/auth/callback`,\r\n          data: {\r\n            full_name: name,\r\n            name: name,\r\n          },\r\n        },\r\n      });\r\n      return { error };\r\n    } finally {\r\n      setAuthLoading(false);\r\n    }\r\n  };\r\n\r\n  const signOut = async () => {\r\n    await supabase.auth.signOut();\r\n    queryClient.clear();\r\n  };\r\n\r\n  const resetPassword = async (email: string) => {\r\n    setAuthLoading(true);\r\n    try {\r\n      const origin = env.VITE_PUBLIC_SITE_URL || window.location.origin;\r\n      const { error } = await supabase.auth.resetPasswordForEmail(email, {\r\n        redirectTo: `${origin}/auth/update-password`,\r\n      });\r\n      return { error };\r\n    } finally {\r\n      setAuthLoading(false);\r\n    }\r\n  };\r\n\r\n  const isLoading = authLoading || (!!user && profileLoading && profileFetching);\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        user,\r\n        session,\r\n        profile: profile || null,\r\n        isAdmin: profile?.role === \"admin\",\r\n        isDemo: profile?.role === \"demo\",\r\n        isSecretaria: profile?.role === \"secretaria\",\r\n        loading: isLoading,\r\n        signIn,\r\n        signUp,\r\n        signOut,\r\n        resetPassword,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error(\"useAuth must be used within an AuthProvider\");\r\n  }\r\n  return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\auth\\contexts\\__tests__\\AuthContext.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2504,2507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2504,2507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { renderHook, waitFor } from \"@testing-library/react\";\r\nimport { AuthProvider, useAuth } from \"../AuthContext\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { profileService, Profile } from \"@/features/users/services/profileService\";\r\nimport React from \"react\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\n\r\n// Mock supabase\r\nvi.mock(\"@/integrations/supabase/client\", () => ({\r\n    supabase: {\r\n        auth: {\r\n            getSession: vi.fn(),\r\n            onAuthStateChange: vi.fn(() => ({ data: { subscription: { unsubscribe: vi.fn() } } })),\r\n            signOut: vi.fn(),\r\n            signInWithPassword: vi.fn(),\r\n            signUp: vi.fn(),\r\n            resetPasswordForEmail: vi.fn(),\r\n        },\r\n        from: vi.fn()\r\n    }\r\n}));\r\n\r\n// Mock profileService\r\nvi.mock(\"@/features/users/services/profileService\", () => ({\r\n    profileService: {\r\n        getProfile: vi.fn(),\r\n    }\r\n}));\r\n\r\nconst queryClient = new QueryClient({\r\n    defaultOptions: {\r\n        queries: {\r\n            retry: false,\r\n            gcTime: 0,\r\n        }\r\n    }\r\n});\r\n\r\nconst wrapper = ({ children }: { children: React.ReactNode }) => (\r\n    <QueryClientProvider client={queryClient}>\r\n        <AuthProvider>{children}</AuthProvider>\r\n    </QueryClientProvider>\r\n);\r\n\r\ndescribe(\"AuthContext\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n        queryClient.clear();\r\n    });\r\n\r\n    it(\"should provide auth state (unauthenticated initially)\", async () => {\r\n        vi.mocked(supabase.auth.getSession).mockResolvedValue({ data: { session: null }, error: null });\r\n\r\n        const { result } = renderHook(() => useAuth(), { wrapper });\r\n\r\n        await waitFor(() => {\r\n            expect(result.current.loading).toBe(false);\r\n        });\r\n\r\n        expect(result.current.user).toBeNull();\r\n        expect(result.current.profile).toBeNull();\r\n    });\r\n\r\n    it(\"should handle login and load profile\", async () => {\r\n        const mockUser = { id: \"u1\", email: \"test@test.com\" };\r\n        const mockProfile: Profile = {\r\n            id: \"u1\",\r\n            user_id: \"u1\",\r\n            name: \"Test User\",\r\n            email: \"test@test.com\",\r\n            active: true,\r\n            created_at: new Date().toISOString(),\r\n            role: \"admin\"\r\n        };\r\n\r\n        vi.mocked(supabase.auth.getSession).mockResolvedValue({\r\n            data: { session: { user: mockUser } as any },\r\n            error: null\r\n        });\r\n\r\n        vi.mocked(profileService.getProfile).mockResolvedValue(mockProfile);\r\n\r\n        const { result } = renderHook(() => useAuth(), { wrapper });\r\n\r\n        // Wait for profile load\r\n        await waitFor(() => {\r\n            expect(result.current.profile).toEqual(mockProfile);\r\n            expect(result.current.isAdmin).toBe(true);\r\n        }, { timeout: 2000 });\r\n\r\n        expect(result.current.user).toEqual(mockUser);\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\auth\\pages\\AuthPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\auth\\pages\\ResetPasswordPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\dashboard\\hooks\\use-dashboard-data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\dashboard\\pages\\DashboardPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\dashboard\\pages\\__tests__\\DashboardPage.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4445,4448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4445,4448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4695,4698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4695,4698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4852,4855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4852,4855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":134,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5047,5050],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5047,5050],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5626,5629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5626,5629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5816,5819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5816,5819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { render, screen } from \"@testing-library/react\";\r\nimport DashboardPage from \"@/features/dashboard/pages/DashboardPage\";\r\nimport React from \"react\";\r\nimport { useDashboardData } from \"@/features/dashboard/hooks/use-dashboard-data\";\r\nimport { useAssociacaoAccounts, useEntitiesWithAccounts } from \"@/shared/hooks/use-accounts\";\r\nimport { useAssociacaoActions } from \"@/features/associacao/hooks/use-associacao-actions\";\r\nimport { useSaldosActions } from \"@/features/recursos/hooks/use-saldos-actions\";\r\nimport { useExpenseShortcuts } from \"@/features/transactions/hooks/use-expense-shortcuts\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\n\r\n// Mock hooks\r\nvi.mock(\"@/features/dashboard/hooks/use-dashboard-data\", () => ({\r\n    useDashboardData: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/shared/hooks/use-accounts\", () => ({\r\n    useAssociacaoAccounts: vi.fn(),\r\n    useEntitiesWithAccounts: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/associacao/hooks/use-associacao-actions\", () => ({\r\n    useAssociacaoActions: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/recursos/hooks/use-saldos-actions\", () => ({\r\n    useSaldosActions: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/hooks/use-expense-shortcuts\", () => ({\r\n    useExpenseShortcuts: vi.fn(() => ({\r\n        shortcuts: [],\r\n        addShortcut: vi.fn(),\r\n        removeShortcut: vi.fn()\r\n    }))\r\n}));\r\n\r\nvi.mock(\"@/features/auth/contexts/AuthContext\", () => ({\r\n    useAuth: vi.fn(() => ({\r\n        user: { id: \"u1\", email: \"test@example.com\" },\r\n        profile: { id: \"p1\", full_name: \"Test User\", role: \"admin\" },\r\n        isDemo: false\r\n    }))\r\n}));\r\n\r\n// Mock layout/components\r\nvi.mock(\"@/shared/components/DashboardLayout\", () => ({\r\n    DashboardLayout: ({ children }: { children: React.ReactNode }) => <div>{children}</div>\r\n}));\r\n\r\nvi.mock(\"@/shared/components/ActionCard\", () => ({\r\n    ActionCard: ({ title, onClick }: { title: string; onClick: () => void }) => <div onClick={onClick} data-testid=\"action-card\">{title}</div>\r\n}));\r\n\r\n// Mock Dialogs\r\nvi.mock(\"@/features/associacao/components/MensalidadeDialog\", () => ({ MensalidadeDialog: () => <div>Mock Mensalidade</div> }));\r\nvi.mock(\"@/features/associacao/components/GastoAssociacaoDialog\", () => ({ GastoAssociacaoDialog: () => <div>Mock Gasto Assoc</div> }));\r\nvi.mock(\"@/features/recursos/components/ConsumoSaldoDialog\", () => ({ ConsumoSaldoDialog: () => <div>Mock Consumo Mer</div> }));\r\n\r\nconst createWrapper = () => {\r\n    const queryClient = new QueryClient({\r\n        defaultOptions: { queries: { retry: false } },\r\n    });\r\n    return ({ children }: { children: React.ReactNode }) => (\r\n        <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n    );\r\n};\r\n\r\ndescribe(\"DashboardPage integration\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n\r\n        // Setup default mocks\r\n        vi.mocked(useDashboardData).mockReturnValue({\r\n            data: {\r\n                especieBalance: 1000,\r\n                pixBalance: 2000,\r\n                contaDigitalBalance: 3000,\r\n                cofreBalance: 500,\r\n                merchantBalances: [\r\n                    { id: \"m1\", name: \"Merchant A\", balance: 150, active: true, mode: \"active\" }\r\n                ],\r\n                resourceBalances: {\r\n                    UE: [{\r\n                        id: \"ue1\", name: \"UE Acc 1\", balance: 10000,\r\n                        type: \"bank\",\r\n                        entity_id: \"e1\",\r\n                        active: true,\r\n                        agency: \"\",\r\n                        bank: \"\",\r\n                        account_number: \"\"\r\n                    }],\r\n                    CX: [{\r\n                        id: \"cx1\", name: \"CX Acc 1\", balance: 5000,\r\n                        type: \"bank\",\r\n                        entity_id: \"e1\",\r\n                        active: true,\r\n                        agency: \"\",\r\n                        bank: \"\",\r\n                        account_number: \"\"\r\n                    }]\r\n                }\r\n            },\r\n            isLoading: false,\r\n            error: null,\r\n            refetch: vi.fn()\r\n        });\r\n\r\n        vi.mocked(useAssociacaoAccounts).mockReturnValue({\r\n            data: [],\r\n            isLoading: false,\r\n            error: null,\r\n            isError: false,\r\n            isSuccess: true,\r\n            refetch: vi.fn()\r\n        } as any);\r\n\r\n        vi.mocked(useEntitiesWithAccounts).mockReturnValue({\r\n            data: { entities: [], accounts: [] },\r\n            isLoading: false,\r\n            error: null,\r\n            isSuccess: true,\r\n            isError: false\r\n        } as any);\r\n\r\n        vi.mocked(useAssociacaoActions).mockReturnValue({\r\n            state: { mensalidade: {}, gasto: {}, mover: {}, ajuste: {}, receita: {} } as any,\r\n            setters: {\r\n                mensalidade: {},\r\n                gasto: {},\r\n                mover: {},\r\n                ajuste: {},\r\n                receita: {}\r\n            } as any,\r\n            handlers: {\r\n                resetMensalidade: vi.fn(),\r\n                resetGasto: vi.fn(),\r\n                handleMensalidadeSubmit: vi.fn(),\r\n                handleGastoSubmit: vi.fn(),\r\n                handleMovimentarSubmit: vi.fn(),\r\n                handleAjusteSubmit: vi.fn(),\r\n                resetMov: vi.fn(),\r\n                resetAjuste: vi.fn()\r\n            },\r\n            isLoading: false\r\n        });\r\n\r\n        vi.mocked(useSaldosActions).mockReturnValue({\r\n            state: { aporte: {}, gasto: {}, consumo: {}, mover: {}, ajuste: {} } as any,\r\n            setters: {\r\n                aporte: {},\r\n                gasto: {},\r\n                consumo: {},\r\n                mover: {},\r\n                ajuste: {}\r\n            } as any,\r\n            handlers: {\r\n                resetGasto: vi.fn(),\r\n                handleAporteSubmit: vi.fn(),\r\n                handleAddMerchant: vi.fn(),\r\n                handleEditMerchant: vi.fn(),\r\n                handleDeleteMerchant: vi.fn(),\r\n                handleActivateMerchant: vi.fn(),\r\n                handleGastoSubmit: vi.fn(), // Added this\r\n                resetAporte: vi.fn()\r\n            },\r\n            isLoading: false\r\n        });\r\n    });\r\n\r\n    it(\"should render page header and summary totals\", () => {\r\n        render(<DashboardPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Resumo\")).toBeDefined();\r\n        expect(screen.getByText(/1\\.000/)).toBeDefined(); // Especie\r\n        expect(screen.getByText(/2\\.000/)).toBeDefined(); // PIX\r\n        expect(screen.getByText(/3\\.000/)).toBeDefined(); // Conta Digital\r\n        expect(screen.getByText(/500/)).toBeDefined();   // Cofre\r\n    });\r\n\r\n    it(\"should render quick action cards\", () => {\r\n        render(<DashboardPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Mensalidade\")).toBeDefined();\r\n        expect(screen.getByText(\"Despesa Associa├º├úo\")).toBeDefined();\r\n        expect(screen.getByText(\"Gasto Estabelecimento\")).toBeDefined();\r\n    });\r\n\r\n    it(\"should render merchant balances\", () => {\r\n        render(<DashboardPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Merchant A\")).toBeDefined();\r\n        expect(screen.getByText(/150/)).toBeDefined();\r\n    });\r\n\r\n    it(\"should render resource balances\", () => {\r\n        render(<DashboardPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"UE Acc 1\")).toBeDefined();\r\n        expect(screen.getByText(\"CX Acc 1\")).toBeDefined();\r\n        expect(screen.getByText(/10\\.000/)).toBeDefined();\r\n        expect(screen.getByText(/5\\.000/)).toBeDefined();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\dashboard\\services\\dashboardService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\lib\\graduationPdf.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\lib\\graduationPdfUtils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1711,1714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1711,1714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import jsPDF from \"jspdf\";\r\nimport autoTable from \"jspdf-autotable\";\r\nimport { format } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\nimport { formatCurrencyBRL } from \"@/shared/lib/currency\";\r\nimport { GraduationInstallment, GraduationStudent, Graduation } from \"@/features/graduations/services/graduationService\";\r\n\r\nexport const graduationPdfUtils = {\r\n    generateStudentCarnet: (\r\n        graduation: Graduation,\r\n        student: GraduationStudent,\r\n        installments: GraduationInstallment[]\r\n    ) => {\r\n        const doc = new jsPDF();\r\n        const pageWidth = doc.internal.pageSize.getWidth();\r\n\r\n        // Header\r\n        doc.setFontSize(16);\r\n        doc.text(`CARN├è DE PAGAMENTO - ${graduation.name.toUpperCase()}`, pageWidth / 2, 20, { align: \"center\" });\r\n\r\n        doc.setFontSize(12);\r\n        doc.text(`Aluno: ${student.name}`, 20, 35);\r\n        doc.text(`Ano: ${graduation.year}`, pageWidth - 20, 35, { align: \"right\" });\r\n\r\n        // Table of Installments\r\n        const tableData = installments.map((ins) => [\r\n            ins.installment_number.toString(),\r\n            format(new Date(ins.due_date), \"dd/MM/yyyy\"),\r\n            formatCurrencyBRL(ins.value),\r\n            ins.status === \"PAGO\" ? \"PAGO\" : \"EM ABERTO\",\r\n            ins.paid_at ? format(new Date(ins.paid_at), \"dd/MM/yyyy\") : \"-\",\r\n        ]);\r\n\r\n        autoTable(doc, {\r\n            startY: 45,\r\n            head: [[\"Parcela\", \"Vencimento\", \"Valor\", \"Status\", \"Data Pagamento\"]],\r\n            body: tableData,\r\n            theme: \"grid\",\r\n            headStyles: { fillGray: 200, textColor: 0, fontStyle: \"bold\" },\r\n        });\r\n\r\n        // Manual Fields for Signature\r\n        const finalY = (doc as any).lastAutoTable.finalY + 20;\r\n        doc.setFontSize(10);\r\n        doc.line(20, finalY, 80, finalY);\r\n        doc.text(\"Assinatura / Recebido por\", 20, finalY + 5);\r\n\r\n        doc.line(pageWidth - 80, finalY, pageWidth - 20, finalY);\r\n        doc.text(\"Data do Recebimento\", pageWidth - 80, finalY + 5);\r\n\r\n        doc.save(`carne_${student.name.replace(/\\s+/g, \"_\").toLowerCase()}.pdf`);\r\n    },\r\n\r\n    generateTreasurerControl: (\r\n        graduation: Graduation,\r\n        className: string,\r\n        students: GraduationStudent[],\r\n        grid: Record<string, GraduationInstallment[]>\r\n    ) => {\r\n        const doc = new jsPDF({ orientation: \"landscape\" });\r\n        const pageWidth = doc.internal.pageSize.getWidth();\r\n\r\n        doc.setFontSize(16);\r\n        doc.text(`CONTROLE DO TESOUREIRO - ${graduation.name.toUpperCase()}`, pageWidth / 2, 15, { align: \"center\" });\r\n        doc.setFontSize(12);\r\n        doc.text(`Turma: ${className}`, 15, 25);\r\n\r\n        // Determine max installments\r\n        let maxInstallments = 0;\r\n        Object.values(grid).forEach(list => {\r\n            if (list.length > maxInstallments) maxInstallments = list.length;\r\n        });\r\n\r\n        // Headers: Name + P1, P2, P3...\r\n        const headers = [\"Aluno\"];\r\n        for (let i = 1; i <= maxInstallments; i++) {\r\n            headers.push(`P${i}`);\r\n        }\r\n\r\n        const tableData = students.map(student => {\r\n            const studentInstallments = grid[student.id] || [];\r\n            const row = [student.name];\r\n            for (let i = 1; i <= maxInstallments; i++) {\r\n                const ins = studentInstallments.find(inc => inc.installment_number === i);\r\n                if (!ins) row.push(\"-\");\r\n                else if (ins.status === \"PAGO\") row.push(\"X\");\r\n                else if (ins.status === \"ISENTO\") row.push(\"I\");\r\n                else row.push(\"\");\r\n            }\r\n            return row;\r\n        });\r\n\r\n        autoTable(doc, {\r\n            startY: 30,\r\n            head: [headers],\r\n            body: tableData,\r\n            theme: \"grid\",\r\n            styles: { fontSize: 8, cellPadding: 2 },\r\n            headStyles: { fillColor: [63, 81, 181], textColor: 255 },\r\n            columnStyles: { 0: { cellWidth: 50, fontStyle: \"bold\" } },\r\n        });\r\n\r\n        doc.setFontSize(8);\r\n        doc.text(\"Legenda: X = Pago, I = Isento, Vazio = Em Aberto\", 15, doc.internal.pageSize.getHeight() - 10);\r\n\r\n        doc.save(`controle_tesoureiro_${className.replace(/\\s+/g, \"_\").toLowerCase()}.pdf`);\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\pages\\ClassDetailPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4517,4520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4517,4520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5045,5048],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5045,5048],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6082,6085],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6082,6085],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6575,6578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6575,6578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":398,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":398,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22294,22297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22294,22297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":400,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":400,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22369,22372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22369,22372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":426,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":426,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23627,23630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23627,23630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":427,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":427,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23676,23679],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23676,23679],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":428,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":428,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23744,23747],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23744,23747],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":431,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":431,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23876,23879],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23876,23879],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":496,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":496,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27227,27230],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27227,27230],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":499,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":499,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27319,27322],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27319,27322],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DashboardLayout } from \"@/shared/components/DashboardLayout\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { useParams, Link } from \"react-router-dom\";\r\nimport { graduationService, GraduationStudent, GraduationInstallment, GraduationInstallmentStatus } from \"@/features/graduations/services/graduationService\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/shared/ui/card\";\r\nimport { Button } from \"@/shared/ui/button\";\r\nimport {\r\n    Users,\r\n    Plus,\r\n    Loader2,\r\n    ChevronLeft,\r\n    Download,\r\n    FileText,\r\n    UserPlus,\r\n    UserCheck,\r\n    UserMinus,\r\n    CheckCircle2,\r\n    XCircle,\r\n    Clock,\r\n    CircleOff,\r\n    Table as TableIcon,\r\n    Upload\r\n} from \"lucide-react\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/shared/ui/tabs\";\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow\r\n} from \"@/shared/ui/table\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogTrigger,\r\n    DialogFooter\r\n} from \"@/shared/ui/dialog\";\r\nimport { Input } from \"@/shared/ui/input\";\r\nimport { Label } from \"@/shared/ui/label\";\r\nimport { graduationPdfUtils } from \"@/features/graduations/lib/graduationPdfUtils\";\r\nimport { formatCurrencyBRL } from \"@/shared/lib/currency\";\r\nimport { Badge } from \"@/shared/ui/badge\";\r\nimport { cn } from \"@/shared/lib/utils\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/shared/ui/select\";\r\nimport { Textarea } from \"@/shared/ui/textarea\";\r\n\r\nexport default function ClassDetailPage() {\r\n    const { slug, classSlug } = useParams<{ slug: string, classSlug: string }>();\r\n    const queryClient = useQueryClient();\r\n    const [openAddStudent, setOpenAddStudent] = useState(false);\r\n    const [openImportExcel, setOpenImportExcel] = useState(false);\r\n    const [selectedStudentForPayment, setSelectedStudentForPayment] = useState<GraduationStudent | null>(null);\r\n    const [selectedInstallment, setSelectedInstallment] = useState<GraduationInstallment | null>(null);\r\n\r\n    // Queries\r\n    // Queries\r\n    const { data: graduation, isLoading: loadingGrad } = useQuery({\r\n        queryKey: [\"graduation\", slug],\r\n        queryFn: () => graduationService.getGraduationBySlug(slug!),\r\n        enabled: !!slug,\r\n    });\r\n\r\n    const { data: currentClass, isLoading: loadingClass } = useQuery({\r\n        queryKey: [\"class\", graduation?.id, classSlug],\r\n        queryFn: () => graduationService.getClassBySlug(graduation!.id, classSlug!),\r\n        enabled: !!graduation?.id && !!classSlug,\r\n    });\r\n\r\n    const classId = currentClass?.id;\r\n\r\n    const { data: students, isLoading: loadingStudents } = useQuery({\r\n        queryKey: [\"class-students\", classId],\r\n        queryFn: () => graduationService.getStudentsByClass(classId!),\r\n        enabled: !!classId,\r\n    });\r\n\r\n    const { data: installmentsGrid } = useQuery({\r\n        queryKey: [\"class-installments\", classId],\r\n        queryFn: async () => {\r\n            if (!students) return {};\r\n            const grid: Record<string, GraduationInstallment[]> = {};\r\n            await Promise.all(students.map(async (s) => {\r\n                grid[s.id] = await graduationService.getInstallments(s.id);\r\n            }));\r\n            return grid;\r\n        },\r\n        enabled: !!students && students.length > 0,\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (currentClass && graduation) {\r\n            document.title = `${graduation.name} - ${currentClass.name} | CMCB-XI`;\r\n        } else if (currentClass) {\r\n            document.title = `${currentClass.name} | CMCB-XI`;\r\n        } else {\r\n            document.title = \"Turma | CMCB-XI\";\r\n        }\r\n        return () => { document.title = \"CMCB-XI\"; };\r\n    }, [currentClass, graduation]);\r\n\r\n    // Mutations\r\n    const mutationCreateStudent = useMutation({\r\n        mutationFn: async (name: string) => {\r\n            const student = await graduationService.createStudent({ class_id: classId!, name });\r\n            await graduationService.generateCarnetForStudent(student.id);\r\n            return student;\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"class-students\", classId] });\r\n            toast.success(\"Aluno cadastrado e carn├¬ gerado!\");\r\n            setOpenAddStudent(false);\r\n        },\r\n        onError: (error: any) => toast.error(`Erro: ${error.message}`),\r\n    });\r\n\r\n    const mutationToggleStudent = useMutation({\r\n        mutationFn: ({ id, active }: { id: string, active: boolean }) => graduationService.toggleStudentActivation(id, active),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"class-students\", classId] });\r\n            toast.success(\"Status do aluno atualizado!\");\r\n        },\r\n    });\r\n\r\n    const mutationUpdatePayment = useMutation({\r\n        mutationFn: ({ id, status, params }: any) => graduationService.updateInstallmentStatus(id, status, params),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"class-installments\", classId] });\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-summary\", graduation?.id] });\r\n            // Remove selection only if it was a manual update from dialog\r\n            // No toast here to keep it fast, or a very subtle one\r\n        },\r\n    });\r\n\r\n    const mutationBulkPayment = useMutation({\r\n        mutationFn: ({ installmentNumber, status }: { installmentNumber: number, status: GraduationInstallmentStatus }) =>\r\n            graduationService.bulkUpdateInstallmentStatus(classId!, installmentNumber, status),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"class-installments\", classId] });\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-summary\", graduation?.id] });\r\n            toast.success(\"M├¬s atualizado com sucesso!\");\r\n        },\r\n        onError: (error: any) => toast.error(`Erro ao atualizar turma: ${error.message}`),\r\n    });\r\n\r\n    const mutationImportExcel = useMutation({\r\n        mutationFn: (file: File) => graduationService.importStudentsFromExcel(classId!, file),\r\n        onSuccess: (data) => {\r\n            queryClient.invalidateQueries({ queryKey: [\"class-students\", classId] });\r\n            toast.success(`${data.count} alunos importados com sucesso!`);\r\n            setOpenImportExcel(false);\r\n        },\r\n        onError: (error: any) => toast.error(`Erro na importa├º├úo: ${error.message}`),\r\n    });\r\n\r\n    if (loadingGrad || loadingClass || loadingStudents) {\r\n        return (\r\n            <DashboardLayout>\r\n                <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n                    <div className=\"flex flex-col items-center gap-4\">\r\n                        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n                        <p className=\"text-sm text-muted-foreground animate-pulse\">Carregando alunos e parcelas...</p>\r\n                    </div>\r\n                </div>\r\n            </DashboardLayout>\r\n        );\r\n    }\r\n\r\n    const handleExportTreasurer = () => {\r\n        if (!graduation || !currentClass || !students || !installmentsGrid) return;\r\n        graduationPdfUtils.generateTreasurerControl(\r\n            graduation,\r\n            currentClass.name,\r\n            students,\r\n            installmentsGrid\r\n        );\r\n    };\r\n\r\n    const handleExportCarnet = (student: GraduationStudent) => {\r\n        if (!graduation || !installmentsGrid) return;\r\n        const installments = installmentsGrid[student.id];\r\n        if (!installments || installments.length === 0) {\r\n            toast.error(\"Carn├¬ ainda n├úo gerado para este aluno.\");\r\n            return;\r\n        }\r\n        graduationPdfUtils.generateStudentCarnet(graduation, student, installments);\r\n    };\r\n\r\n    return (\r\n        <DashboardLayout>\r\n            <div className=\"space-y-6 animate-fade-in\">\r\n                <header className=\"flex flex-col gap-4\">\r\n                    <Link to={`/formaturas/${graduation?.slug}`} className=\"flex items-center text-sm text-muted-foreground hover:text-primary transition-colors\">\r\n                        <ChevronLeft className=\"h-4 w-4 mr-1\" /> Voltar para {graduation?.name}\r\n                    </Link>\r\n                    <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                        <div>\r\n                            <h1 className=\"text-3xl font-bold text-foreground\">{currentClass?.name}</h1>\r\n                            <p className=\"text-muted-foreground\">Gest├úo de alunos e carn├¬s da turma</p>\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                            <Button onClick={() => setOpenAddStudent(true)} className=\"gap-2\">\r\n                                <UserPlus className=\"h-4 w-4\" /> Novo Aluno\r\n                            </Button>\r\n                            <Button onClick={() => setOpenImportExcel(true)} variant=\"outline\" className=\"gap-2 border-primary/20 hover:bg-primary/5\">\r\n                                <Upload className=\"h-4 w-4\" /> Importar Excel\r\n                            </Button>\r\n                            <Button onClick={handleExportTreasurer} variant=\"outline\" className=\"gap-2 border-primary/20 hover:bg-primary/5\">\r\n                                <Download className=\"h-4 w-4\" /> Controle PDF\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </header>\r\n\r\n                <Tabs defaultValue=\"students\" className=\"w-full\">\r\n                    <TabsList className=\"mb-4 bg-muted/50 p-1\">\r\n                        <TabsTrigger value=\"students\" className=\"gap-2\">\r\n                            <Users className=\"h-4 w-4\" /> Alunos\r\n                        </TabsTrigger>\r\n                        <TabsTrigger value=\"grid\" className=\"gap-2\">\r\n                            <TableIcon className=\"h-4 w-4\" /> Grade do Tesoureiro\r\n                        </TabsTrigger>\r\n                    </TabsList>\r\n\r\n                    <TabsContent value=\"students\">\r\n                        <Card className=\"border-none glass-card\">\r\n                            <CardContent className=\"p-0\">\r\n                                <Table>\r\n                                    <TableHeader>\r\n                                        <TableRow>\r\n                                            <TableHead>Nome</TableHead>\r\n                                            <TableHead>Status</TableHead>\r\n                                            <TableHead className=\"text-right\">A├º├Áes</TableHead>\r\n                                        </TableRow>\r\n                                    </TableHeader>\r\n                                    <TableBody>\r\n                                        {students?.map((student) => (\r\n                                            <TableRow key={student.id}>\r\n                                                <TableCell className=\"font-medium\">{student.name}</TableCell>\r\n                                                <TableCell>\r\n                                                    <Badge variant={student.active ? \"default\" : \"secondary\"} className={student.active ? \"bg-emerald-500 hover:bg-emerald-600\" : \"\"}>\r\n                                                        {student.active ? \"Ativo\" : \"Inativo\"}\r\n                                                    </Badge>\r\n                                                </TableCell>\r\n                                                <TableCell className=\"text-right flex justify-end gap-2\">\r\n                                                    <Button\r\n                                                        variant=\"ghost\"\r\n                                                        size=\"sm\"\r\n                                                        className=\"text-primary hover:text-primary hover:bg-primary/5\"\r\n                                                        onClick={() => handleExportCarnet(student)}\r\n                                                    >\r\n                                                        <FileText className=\"h-4 w-4 mr-1\" /> Carn├¬\r\n                                                    </Button>\r\n                                                    <Button\r\n                                                        variant=\"ghost\"\r\n                                                        size=\"sm\"\r\n                                                        className={student.active ? \"text-amber-600 hover:text-amber-700 hover:bg-amber-50\" : \"text-emerald-600 hover:text-emerald-700 hover:bg-emerald-50\"}\r\n                                                        onClick={() => mutationToggleStudent.mutate({ id: student.id, active: !student.active })}\r\n                                                    >\r\n                                                        {student.active ? <UserMinus className=\"h-4 w-4\" /> : <UserCheck className=\"h-4 w-4\" />}\r\n                                                    </Button>\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        ))}\r\n                                    </TableBody>\r\n                                </Table>\r\n                                {students?.length === 0 && (\r\n                                    <div className=\"py-12 text-center text-muted-foreground\">\r\n                                        Nenhum aluno cadastrado nesta turma.\r\n                                    </div>\r\n                                )}\r\n                            </CardContent>\r\n                        </Card>\r\n                    </TabsContent>\r\n\r\n                    <TabsContent value=\"grid\">\r\n                        <Card className=\"border-none glass-card overflow-x-auto\">\r\n                            <CardContent className=\"p-0\">\r\n                                <Table>\r\n                                    <TableHeader>\r\n                                        <TableRow>\r\n                                            <TableHead className=\"sticky left-0 bg-card/80 backdrop-blur-sm z-10 min-w-[150px]\">Aluno</TableHead>\r\n                                            {Array.from({ length: 12 }, (_, i) => (\r\n                                                <TableHead key={i} className=\"text-center p-2\">\r\n                                                    <div className=\"flex flex-col items-center gap-1\">\r\n                                                        <span className=\"text-xs font-bold\">P{i + 1}</span>\r\n                                                        <Button\r\n                                                            variant=\"ghost\"\r\n                                                            size=\"icon\"\r\n                                                            className=\"h-6 w-6 text-[8px] hover:bg-primary/10 hover:text-primary transition-all\"\r\n                                                            title=\"Marcar todos como pago\"\r\n                                                            onClick={() => mutationBulkPayment.mutate({ installmentNumber: i + 1, status: 'PAGO' })}\r\n                                                        >\r\n                                                            <CheckCircle2 className=\"h-3 w-3\" />\r\n                                                        </Button>\r\n                                                    </div>\r\n                                                </TableHead>\r\n                                            ))}\r\n                                        </TableRow>\r\n                                    </TableHeader>\r\n                                    <TableBody>\r\n                                        {students?.map((student) => {\r\n                                            const studentInstallments = installmentsGrid?.[student.id] || [];\r\n                                            return (\r\n                                                <TableRow key={student.id}>\r\n                                                    <TableCell className=\"sticky left-0 bg-card/80 backdrop-blur-sm z-10 font-medium\">\r\n                                                        {student.name}\r\n                                                    </TableCell>\r\n                                                    {Array.from({ length: 12 }, (_, i) => {\r\n                                                        const ins = studentInstallments.find(inc => inc.installment_number === i + 1);\r\n                                                        if (!ins) return <TableCell key={i} className=\"text-center text-muted\">-</TableCell>;\r\n                                                        return (\r\n                                                            <TableCell key={i} className=\"text-center\">\r\n                                                                <button\r\n                                                                    onClick={() => {\r\n                                                                        const newStatus = ins.status === 'PAGO' ? 'EM_ABERTO' : 'PAGO';\r\n                                                                        mutationUpdatePayment.mutate({ id: ins.id, status: newStatus });\r\n                                                                    }}\r\n                                                                    onContextMenu={(e) => {\r\n                                                                        e.preventDefault();\r\n                                                                        setSelectedStudentForPayment(student);\r\n                                                                        setSelectedInstallment(ins);\r\n                                                                    }}\r\n                                                                    className={cn(\r\n                                                                        \"w-6 h-6 rounded-full flex items-center justify-center transition-all hover:scale-125 hover:shadow-md\",\r\n                                                                        ins.status === 'PAGO' ? \"bg-emerald-500 text-white shadow-sm\" :\r\n                                                                            ins.status === 'ISENTO' ? \"bg-blue-500 text-white\" :\r\n                                                                                ins.status === 'CANCELADO' ? \"bg-slate-300 text-white\" :\r\n                                                                                    \"bg-white text-slate-300 border-2 border-slate-100 hover:border-amber-200\"\r\n                                                                    )}\r\n                                                                >\r\n                                                                    {ins.status === 'PAGO' ? <CheckCircle2 className=\"h-4 w-4\" /> :\r\n                                                                        ins.status === 'ISENTO' ? <CircleOff className=\"h-3 w-3\" /> :\r\n                                                                            ins.status === 'CANCELADO' ? <XCircle className=\"h-4 w-4\" /> :\r\n                                                                                null}\r\n                                                                </button>\r\n                                                            </TableCell>\r\n                                                        );\r\n                                                    })}\r\n                                                </TableRow>\r\n                                            );\r\n                                        })}\r\n                                    </TableBody>\r\n                                </Table>\r\n                            </CardContent>\r\n                        </Card>\r\n                        <div className=\"mt-4 flex gap-4 text-xs text-muted-foreground justify-center\">\r\n                            <span className=\"flex items-center gap-1\"><CheckCircle2 className=\"h-3 w-3 text-emerald-500\" /> Pago</span>\r\n                            <span className=\"flex items-center gap-1\"><Clock className=\"h-3 w-3 text-amber-500\" /> Em Aberto</span>\r\n                            <span className=\"flex items-center gap-1\"><CircleOff className=\"h-3 w-3 text-blue-500\" /> Isento</span>\r\n                            <span className=\"flex items-center gap-1\"><XCircle className=\"h-3 w-3 text-slate-400\" /> Cancelado</span>\r\n                        </div>\r\n                    </TabsContent>\r\n                </Tabs>\r\n\r\n                {/* Add Student Dialog */}\r\n                <AddStudentDialog\r\n                    open={openAddStudent}\r\n                    onOpenChange={setOpenAddStudent}\r\n                    onSubmit={(name) => mutationCreateStudent.mutate(name)}\r\n                    isLoading={mutationCreateStudent.isPending}\r\n                />\r\n\r\n                {/* Import Excel Dialog */}\r\n                <ImportExcelDialog\r\n                    open={openImportExcel}\r\n                    onOpenChange={setOpenImportExcel}\r\n                    onImport={(file) => mutationImportExcel.mutate(file)}\r\n                    isLoading={mutationImportExcel.isPending}\r\n                />\r\n\r\n                {/* Payment Detail Dialog */}\r\n                {selectedInstallment && (\r\n                    <PaymentDialog\r\n                        open={!!selectedInstallment}\r\n                        onOpenChange={(open) => !open && setSelectedInstallment(null)}\r\n                        studentName={selectedStudentForPayment?.name || \"\"}\r\n                        installment={selectedInstallment}\r\n                        onSubmit={(status, params) => mutationUpdatePayment.mutate({ id: selectedInstallment.id, status, params })}\r\n                        isLoading={mutationUpdatePayment.isPending}\r\n                    />\r\n                )}\r\n            </div>\r\n        </DashboardLayout>\r\n    );\r\n}\r\n\r\nfunction AddStudentDialog({ open, onOpenChange, onSubmit, isLoading }: any) {\r\n    const [name, setName] = useState(\"\");\r\n    const handleS = (e: any) => {\r\n        e.preventDefault();\r\n        onSubmit(name);\r\n        setName(\"\");\r\n    };\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent>\r\n                <DialogHeader><DialogTitle>Cadastrar Novo Aluno</DialogTitle></DialogHeader>\r\n                <form onSubmit={handleS} className=\"space-y-4 pt-4\">\r\n                    <div className=\"grid gap-2\">\r\n                        <Label>Nome Completo</Label>\r\n                        <Input value={name} onChange={(e) => setName(e.target.value)} placeholder=\"Ex: Jo├úo Silva Santos\" required />\r\n                    </div>\r\n                    <p className=\"text-[10px] text-muted-foreground\">\r\n                        Nota: Ao cadastrar, o carn├¬ ser├í gerado automaticamente com base na configura├º├úo atual da formatura.\r\n                    </p>\r\n                    <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\r\n                        {isLoading ? <Loader2 className=\"animate-spin h-4 w-4\" /> : \"Cadastrar e Gerar Carn├¬\"}\r\n                    </Button>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n\r\nfunction PaymentDialog({ open, onOpenChange, studentName, installment, onSubmit, isLoading }: any) {\r\n    const [status, setStatus] = useState<any>(installment.status);\r\n    const [method, setMethod] = useState<any>(installment.pay_method || \"pix\");\r\n    const [notes, setNotes] = useState(installment.notes || \"\");\r\n\r\n    const handleS = (e: any) => {\r\n        e.preventDefault();\r\n        onSubmit(status, { pay_method: method, notes });\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent>\r\n                <DialogHeader>\r\n                    <DialogTitle>Parcela #{installment.installment_number} - {studentName}</DialogTitle>\r\n                </DialogHeader>\r\n                <div className=\"pt-4 flex flex-col gap-4\">\r\n                    <div className=\"flex justify-between items-center p-3 bg-muted/30 rounded-lg\">\r\n                        <span className=\"text-sm font-medium\">Vencimento: {new Date(installment.due_date).toLocaleDateString()}</span>\r\n                        <span className=\"text-lg font-bold text-primary\">{formatCurrencyBRL(installment.value)}</span>\r\n                    </div>\r\n\r\n                    <form onSubmit={handleS} className=\"space-y-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label>Status</Label>\r\n                            <Select value={status} onValueChange={setStatus}>\r\n                                <SelectTrigger><SelectValue /></SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"EM_ABERTO\">EM ABERTO</SelectItem>\r\n                                    <SelectItem value=\"PAGO\">PAGO</SelectItem>\r\n                                    <SelectItem value=\"ISENTO\">ISENTO</SelectItem>\r\n                                    <SelectItem value=\"CANCELADO\">CANCELADO</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        {status === 'PAGO' && (\r\n                            <div className=\"grid gap-2 animate-in fade-in slide-in-from-top-2\">\r\n                                <Label>Forma de Pagamento</Label>\r\n                                <Select value={method} onValueChange={setMethod}>\r\n                                    <SelectTrigger><SelectValue /></SelectTrigger>\r\n                                    <SelectContent>\r\n                                        <SelectItem value=\"pix\">PIX</SelectItem>\r\n                                        <SelectItem value=\"cash\">DINHEIRO</SelectItem>\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"grid gap-2\">\r\n                            <Label>Observa├º├Áes</Label>\r\n                            <Textarea\r\n                                value={notes}\r\n                                onChange={(e) => setNotes(e.target.value)}\r\n                                placeholder=\"Opcional...\"\r\n                            />\r\n                        </div>\r\n\r\n                        <DialogFooter>\r\n                            <Button type=\"submit\" disabled={isLoading} className=\"w-full\">\r\n                                {isLoading ? <Loader2 className=\"animate-spin h-4 w-4\" /> : \"Salvar Altera├º├Áes\"}\r\n                            </Button>\r\n                        </DialogFooter>\r\n                    </form>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n\r\nfunction ImportExcelDialog({ open, onOpenChange, onImport, isLoading }: any) {\r\n    const [file, setFile] = useState<File | null>(null);\r\n\r\n    const handleS = (e: any) => {\r\n        e.preventDefault();\r\n        if (file) onImport(file);\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent>\r\n                <DialogHeader>\r\n                    <DialogTitle>Importar Alunos via Excel</DialogTitle>\r\n                </DialogHeader>\r\n                <form onSubmit={handleS} className=\"space-y-4 pt-4\">\r\n                    <div className=\"grid gap-2\">\r\n                        <Label>Selecione o arquivo (.xlsx)</Label>\r\n                        <Input\r\n                            type=\"file\"\r\n                            accept=\".xlsx\"\r\n                            onChange={(e) => setFile(e.target.files?.[0] || null)}\r\n                            required\r\n                        />\r\n                        <p className=\"text-[10px] text-muted-foreground mt-1\">\r\n                            O arquivo deve conter os nomes dos alunos na **primeira coluna**.\r\n                            O sistema ir├í pular a primeira linha se ela contiver \"Nome\".\r\n                        </p>\r\n                    </div>\r\n                    <Button type=\"submit\" className=\"w-full\" disabled={isLoading || !file}>\r\n                        {isLoading ? <Loader2 className=\"animate-spin h-4 w-4\" /> : \"Iniciar Importa├º├úo\"}\r\n                    </Button>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\pages\\FormaturasPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\pages\\GraduationClassDetailPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3833,3836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3833,3836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4332,4335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4332,4335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4712,4715],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4712,4715],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5118,5121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5118,5121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DashboardLayout } from \"@/shared/components/DashboardLayout\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { useParams, Link } from \"react-router-dom\";\r\nimport { graduationModuleService } from \"@/features/graduations/services\";\r\nimport { Button } from \"@/shared/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/shared/ui/card\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/shared/ui/table\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from \"@/shared/ui/dialog\";\r\nimport { Input } from \"@/shared/ui/input\";\r\nimport { Label } from \"@/shared/ui/label\";\r\nimport { useState } from \"react\";\r\nimport { toast } from \"sonner\";\r\nimport { Loader2, Plus, ChevronLeft, User, FileText, BadgeDollarSign, Wallet, Download, UserX, Calculator, Search } from \"lucide-react\";\r\nimport { cn } from \"@/shared/lib/utils\";\r\nimport { StudentFinancialDialog } from \"./components/StudentFinancialDialog\";\r\nimport { PaymentBatchModal } from \"./components/PaymentBatchModal\";\r\nimport { StudentForm } from \"./components/StudentForm\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/shared/ui/avatar\";\r\nimport { Progress } from \"@/shared/ui/progress\";\r\nimport { Badge } from \"@/shared/ui/badge\";\r\nimport { generateCarnetsByInstallmentPDF, generateTreasurerControlPDF } from \"@/features/graduations/lib/graduationPdf\";\r\n\r\n\r\nexport default function GraduationClassDetailPage() {\r\n    const { slug, classSlug } = useParams();\r\n    const queryClient = useQueryClient();\r\n    const [openStudent, setOpenStudent] = useState(false);\r\n    const [openPaymentBatch, setOpenPaymentBatch] = useState(false);\r\n    const [selectedStudentId, setSelectedStudentId] = useState<string | null>(null);\r\n    const [importing, setImporting] = useState(false);\r\n\r\n    // 1. Get Graduation\r\n    const { data: graduation } = useQuery({\r\n        queryKey: [\"graduation-module\", slug],\r\n        queryFn: () => graduationModuleService.getGraduationBySlug(slug!),\r\n        enabled: !!slug,\r\n    });\r\n\r\n    // 2. Get Class\r\n    const { data: classData, isLoading: loadingClass } = useQuery({\r\n        queryKey: [\"graduation-class\", slug, classSlug],\r\n        queryFn: async () => {\r\n            if (!graduation) return null;\r\n            return graduationModuleService.getClassBySlug(graduation.id, classSlug!);\r\n        },\r\n        enabled: !!classSlug && !!graduation\r\n    });\r\n\r\n    const classId = classData?.id;\r\n\r\n    // 3. Get Students\r\n    const { data: students, isLoading: loadingStudents } = useQuery({\r\n        queryKey: [\"graduation-students\", classId],\r\n        queryFn: () => graduationModuleService.listStudents(classId!),\r\n        enabled: !!classId\r\n    });\r\n\r\n    // 4. Get Progress\r\n    const { data: progress } = useQuery({\r\n        queryKey: [\"graduation-students-progress\", classId],\r\n        queryFn: () => graduationModuleService.getStudentsProgress(classId!),\r\n        enabled: !!classId\r\n    });\r\n\r\n    // 5. Get Config\r\n    const { data: config } = useQuery({\r\n        queryKey: [\"graduation-config\", graduation?.id],\r\n        queryFn: () => graduationModuleService.getCurrentConfig(graduation!.id),\r\n        enabled: !!graduation?.id\r\n    });\r\n\r\n    const mutationImport = useMutation({\r\n        mutationFn: ({ classId, file }: { classId: string, file: File }) => graduationModuleService.importStudentsFromExcel(classId, file),\r\n        onSuccess: (data) => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-students\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-students-progress\"] });\r\n            if (data.count > 0) toast.success(`${data.count} alunos importados!`);\r\n            setImporting(false);\r\n        },\r\n        onError: (err: any) => {\r\n            toast.error(\"Erro na importa├º├úo: \" + err.message);\r\n            setImporting(false);\r\n        }\r\n    });\r\n\r\n    const mutationStudent = useMutation({\r\n        mutationFn: (name: string) => graduationModuleService.createStudent(classId!, name),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-students\"] });\r\n            toast.success(\"Aluno adicionado!\");\r\n            setOpenStudent(false);\r\n        },\r\n        onError: (err: any) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const mutationInactivate = useMutation({\r\n        mutationFn: (id: string) => graduationModuleService.inactivateStudent(id),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-students\"] });\r\n            toast.success(\"Aluno inativado!\");\r\n        },\r\n        onError: (err: any) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const mutationGenerate = useMutation({\r\n        mutationFn: () => graduationModuleService.generateInstallmentsBatch(classId!),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-students-progress\"] });\r\n            toast.success(\"Presta├º├Áes geradas com sucesso!\");\r\n        },\r\n        onError: (err: any) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const handleExportCarnets = () => {\r\n        if (!config || !students) return;\r\n        generateCarnetsByInstallmentPDF({\r\n            graduation: { name: graduation!.name, year: graduation!.year },\r\n            class: { name: classData!.name },\r\n            config: {\r\n                installment_value: config.installment_value,\r\n                installments_count: config.installments_count,\r\n                due_day: config.due_day,\r\n                start_month: config.start_month\r\n            },\r\n            students: students.map(s => ({ id: s.id, full_name: s.full_name, guardian_name: s.guardian_name }))\r\n        });\r\n    };\r\n\r\n    const handleExportTreasurer = () => {\r\n        if (!config || !students) return;\r\n        generateTreasurerControlPDF({\r\n            graduation: { name: graduation!.name, year: graduation!.year },\r\n            class: { name: classData!.name },\r\n            config: {\r\n                installment_value: config.installment_value,\r\n                installments_count: config.installments_count,\r\n                due_day: config.due_day,\r\n                start_month: config.start_month\r\n            },\r\n            students: students.map(s => ({ id: s.id, full_name: s.full_name, guardian_name: s.guardian_name }))\r\n        });\r\n    };\r\n\r\n    const [searchTerm, setSearchTerm] = useState(\"\");\r\n    const [statusFilter, setStatusFilter] = useState(\"TODOS\");\r\n\r\n    const filteredStudents = students?.filter(s => {\r\n        const matchesSearch = s.full_name.toLowerCase().includes(searchTerm.toLowerCase());\r\n        const matchesStatus = statusFilter === \"TODOS\" || (statusFilter === \"ACTIVE\" && s.active); // For now students are mostly active in this view\r\n        return matchesSearch && matchesStatus;\r\n    });\r\n\r\n    if (loadingClass || !graduation) {\r\n        return (\r\n            <DashboardLayout>\r\n                <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n                    <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n                </div>\r\n            </DashboardLayout>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <DashboardLayout>\r\n            <div className=\"space-y-6 animate-fade-in p-4 md:p-8 pt-6\">\r\n\r\n                {/* Header */}\r\n                <header className=\"flex flex-col gap-4\">\r\n                    <Button asChild variant=\"ghost\" className=\"w-fit p-0 h-auto hover:bg-transparent text-muted-foreground hover:text-primary transition-colors\">\r\n                        <Link to={`/formaturas/${slug}`} className=\"flex items-center text-sm\">\r\n                            <ChevronLeft className=\"h-4 w-4 mr-1\" /> Voltar para Formatura\r\n                        </Link>\r\n                    </Button>\r\n                    <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                        <div>\r\n                            <h1 className=\"text-3xl font-bold text-foreground\">\r\n                                {classData?.name || \"Turma\"}\r\n                            </h1>\r\n                            <p className=\"text-muted-foreground\">{graduation.name}</p>\r\n                        </div>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            <Button onClick={handleExportCarnets} variant=\"outline\" size=\"sm\" className=\"gap-2 border-emerald-200 text-emerald-700 hover:bg-emerald-50\">\r\n                                <Download className=\"h-4 w-4\" /> Exportar Carn├¬s (PDF)\r\n                            </Button>\r\n                            <Button onClick={handleExportTreasurer} variant=\"outline\" size=\"sm\" className=\"gap-2 border-blue-200 text-blue-700 hover:bg-blue-50\">\r\n                                <Download className=\"h-4 w-4\" /> Exportar Controle Tesoureiro\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </header>\r\n\r\n                <div className=\"flex flex-col md:flex-row gap-4 items-end justify-between mb-4\">\r\n                    <div className=\"grid gap-2 flex-1 w-full md:max-w-xs\">\r\n                        <Label htmlFor=\"student-search\">Buscar Aluno</Label>\r\n                        <div className=\"relative\">\r\n                            <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                            <Input\r\n                                id=\"student-search\"\r\n                                placeholder=\"Nome do aluno...\"\r\n                                value={searchTerm}\r\n                                onChange={(e) => setSearchTerm(e.target.value)}\r\n                                className=\"pl-8\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex flex-wrap gap-2 w-full md:w-auto justify-end\">\r\n                        <div className=\"relative\">\r\n                            <input\r\n                                id=\"import-excel-input\"\r\n                                title=\"Importar alunos do Excel\"\r\n                                type=\"file\"\r\n                                accept=\".xlsx, .xls\"\r\n                                className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\r\n                                onChange={(e) => {\r\n                                    const file = e.target.files?.[0];\r\n                                    if (file && classId) mutationImport.mutate({ classId, file });\r\n                                    e.target.value = \"\";\r\n                                }}\r\n                                disabled={importing}\r\n                            />\r\n                            <Button variant=\"outline\" size=\"sm\" className=\"gap-2\" disabled={importing}>\r\n                                {importing ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <FileText className=\"h-4 w-4\" />}\r\n                                Importar Excel\r\n                            </Button>\r\n                        </div>\r\n\r\n                        <Button onClick={() => setOpenPaymentBatch(true)} variant=\"default\" size=\"sm\" className=\"gap-2 bg-emerald-600 hover:bg-emerald-700\">\r\n                            <BadgeDollarSign className=\"h-4 w-4\" /> Baixa Lote\r\n                        </Button>\r\n                        <Button onClick={() => setOpenStudent(true)} size=\"sm\" className=\"gap-2\">\r\n                            <Plus className=\"h-4 w-4\" /> Novo Aluno\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n\r\n                <Card className=\"glass-card border-none overflow-hidden\">\r\n                    <CardHeader className=\"pb-4\">\r\n                        <CardTitle>Alunos e Financeiro</CardTitle>\r\n                        <CardDescription>Gerencie alunos e acompanhe mensalidades em uma ├║nica vis├úo.</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent className=\"p-0\">\r\n                        <Table>\r\n                            <TableHeader>\r\n                                <TableRow>\r\n                                    <TableHead className=\"pl-6\">Aluno</TableHead>\r\n                                    <TableHead>Status</TableHead>\r\n                                    <TableHead>Progresso Financeiro</TableHead>\r\n                                    <TableHead className=\"text-right pr-6\">A├º├Áes</TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                {filteredStudents?.map((student) => {\r\n                                    const studentProgress = progress?.[student.id];\r\n                                    const isComplete = studentProgress && studentProgress.paid >= studentProgress.total && studentProgress.total > 0;\r\n                                    return (\r\n                                        <TableRow key={student.id} className=\"hover:bg-muted/50 transition-colors\">\r\n                                            <TableCell className=\"font-medium pl-6\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    {student.full_name}\r\n                                                    {studentProgress?.hasOverdue && (\r\n                                                        <span className=\"text-[10px] px-1.5 py-0.5 rounded bg-rose-100 text-rose-700 font-bold uppercase tracking-tighter animate-pulse\">Atraso</span>\r\n                                                    )}\r\n                                                </div>\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                <Badge variant=\"outline\" className=\"bg-emerald-50 text-emerald-700 border-emerald-100 text-[10px] font-bold\">\r\n                                                    ATIVO\r\n                                                </Badge>\r\n                                            </TableCell>\r\n                                            <TableCell>\r\n                                                {studentProgress ? (\r\n                                                    <div className=\"flex flex-col gap-1.5 min-w-[120px]\">\r\n                                                        <div className=\"flex justify-between items-center text-[10px] uppercase font-bold\">\r\n                                                            <span className={isComplete ? \"text-emerald-600\" : \"text-amber-600\"}>\r\n                                                                {studentProgress.paid} / {studentProgress.total} pg\r\n                                                            </span>\r\n                                                            <span className=\"text-muted-foreground\">\r\n                                                                {Math.round((studentProgress.paid / studentProgress.total) * 100 || 0)}%\r\n                                                            </span>\r\n                                                        </div>\r\n                                                        <Progress\r\n                                                            value={(studentProgress.paid / studentProgress.total) * 100}\r\n                                                            className={cn(\r\n                                                                \"h-1.5\",\r\n                                                                isComplete ? \"bg-emerald-100 [&>div]:bg-emerald-500\" : \"bg-amber-100 [&>div]:bg-amber-500\"\r\n                                                            )}\r\n                                                        />\r\n                                                    </div>\r\n                                                ) : <span className=\"text-xs text-muted-foreground italic\">Sem parcelas</span>}\r\n                                            </TableCell>\r\n                                            <TableCell className=\"text-right pr-6\">\r\n                                                <div className=\"flex items-center justify-end gap-2\">\r\n                                                    <Button variant=\"outline\" size=\"sm\" onClick={() => setSelectedStudentId(student.id)} className=\"h-8 gap-2 border-primary/20 hover:bg-primary/5\">\r\n                                                        <Wallet className=\"h-3.5 w-3.5\" /> Detalhes\r\n                                                    </Button>\r\n                                                    <Button\r\n                                                        variant=\"ghost\"\r\n                                                        size=\"sm\"\r\n                                                        className=\"h-8 w-8 p-0 text-muted-foreground hover:text-destructive\"\r\n                                                        onClick={() => {\r\n                                                            if (confirm(`Deseja inativar o aluno ${student.full_name}?`)) {\r\n                                                                mutationInactivate.mutate(student.id);\r\n                                                            }\r\n                                                        }}\r\n                                                    >\r\n                                                        <UserX className=\"h-4 w-4\" />\r\n                                                    </Button>\r\n                                                </div>\r\n                                            </TableCell>\r\n                                        </TableRow>\r\n                                    );\r\n                                })}\r\n                                {filteredStudents?.length === 0 && (\r\n                                    <TableRow>\r\n                                        <TableCell colSpan={4} className=\"py-12 text-center text-muted-foreground\">\r\n                                            Nenhum aluno encontrado.\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                )}\r\n                            </TableBody>\r\n                        </Table>\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                <StudentFinancialDialog\r\n                    open={!!selectedStudentId}\r\n                    onOpenChange={(open) => !open && setSelectedStudentId(null)}\r\n                    studentId={selectedStudentId}\r\n                />\r\n\r\n\r\n\r\n                {classId && students && (\r\n                    <PaymentBatchModal\r\n                        open={openPaymentBatch}\r\n                        onOpenChange={setOpenPaymentBatch}\r\n                        classId={classId}\r\n                        students={students.map(s => ({ id: s.id, full_name: s.full_name }))}\r\n                    />\r\n                )}\r\n\r\n                <Dialog open={openStudent} onOpenChange={setOpenStudent}>\r\n                    <DialogContent>\r\n                        <DialogHeader><DialogTitle>Novo Aluno</DialogTitle></DialogHeader>\r\n                        <StudentForm onSubmit={mutationStudent.mutate} isLoading={mutationStudent.isPending} />\r\n                    </DialogContent>\r\n                </Dialog>\r\n            </div>\r\n        </DashboardLayout>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\pages\\GraduationDetailPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4112,4115],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4112,4115],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4818,4821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4818,4821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4944,4947],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4944,4947],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5541,5544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5541,5544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5668,5671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5668,5671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6313,6316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6313,6316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":176,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6447,6450],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6447,6450],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7396,7399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7396,7399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":203,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7821,7824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7821,7824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":375,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":375,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17837,17840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17837,17840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DashboardLayout } from \"@/shared/components/DashboardLayout\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { useParams, Link, useNavigate } from \"react-router-dom\";\r\nimport { graduationModuleService, GraduationPayMethod, GraduationEntryType, GraduationClass } from \"@/features/graduations/services\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/shared/ui/card\";\r\nimport { Button } from \"@/shared/ui/button\";\r\nimport {\r\n    Users,\r\n    TrendingDown,\r\n    Loader2,\r\n    Plus,\r\n    Settings,\r\n    ChevronLeft,\r\n    Banknote,\r\n    History,\r\n    ArrowUpRight,\r\n    ArrowDownLeft,\r\n    ArrowLeftRight,\r\n    ArrowRight,\r\n    MoreVertical,\r\n    Trash2,\r\n    Edit\r\n} from \"lucide-react\";\r\nimport { formatCurrencyBRL } from \"@/shared/lib/currency\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { EntryForm, ExpenseForm, TransferForm, ConfigForm, ClassForm } from \"./components/GraduationForms\";\r\nimport { GlobalChargeBatchModal } from \"./components/GlobalChargeBatchModal\";\r\nimport { toast } from \"sonner\";\r\nimport { useAuth } from \"@/features/auth/contexts/AuthContext\";\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from \"@/shared/ui/dialog\";\r\nimport { Input } from \"@/shared/ui/input\";\r\nimport { Label } from \"@/shared/ui/label\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/shared/ui/select\";\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuTrigger,\r\n} from \"@/shared/ui/dropdown-menu\";\r\nimport {\r\n    Tabs,\r\n    TabsContent,\r\n    TabsList,\r\n    TabsTrigger,\r\n} from \"@/shared/ui/tabs\";\r\nimport { cn } from \"@/shared/lib/utils\";\r\n\r\nexport default function GraduationDetailPage() {\r\n    const { slug } = useParams<{ slug: string }>();\r\n    const navigate = useNavigate();\r\n    const queryClient = useQueryClient();\r\n    const { isAdmin } = useAuth();\r\n\r\n    // Modals state\r\n    const [openEntry, setOpenEntry] = useState(false);\r\n    const [openExpense, setOpenExpense] = useState(false);\r\n    const [openTransfer, setOpenTransfer] = useState(false);\r\n    const [openConfig, setOpenConfig] = useState(false);\r\n    const [openClass, setOpenClass] = useState(false);\r\n    const [openGlobalCharge, setOpenGlobalCharge] = useState(false);\r\n\r\n    // 1. Get Graduation\r\n    const { data: graduation, isLoading: loadingGrad } = useQuery({\r\n        queryKey: [\"graduation-module\", slug],\r\n        queryFn: () => graduationModuleService.getGraduationBySlug(slug!),\r\n        enabled: !!slug,\r\n    });\r\n\r\n    const graduationId = graduation?.id;\r\n\r\n    // 2. Get Summary\r\n    const { data: summary, isLoading: loadingSummary } = useQuery({\r\n        queryKey: [\"graduation-summary-module\", graduationId],\r\n        queryFn: () => graduationModuleService.getFinancialSummary(graduationId!),\r\n        enabled: !!graduationId,\r\n    });\r\n\r\n    // 3. Get History\r\n    const { data: history, isLoading: loadingHistory } = useQuery({\r\n        queryKey: [\"graduation-history-module\", graduationId],\r\n        queryFn: () => graduationModuleService.getHistory(graduationId!),\r\n        enabled: !!graduationId,\r\n    });\r\n\r\n    // 4. Get Classes\r\n    const { data: classes, isLoading: loadingClasses } = useQuery({\r\n        queryKey: [\"graduation-classes-module\", graduationId],\r\n        queryFn: () => graduationModuleService.listClasses(graduationId!),\r\n        enabled: !!graduationId,\r\n    });\r\n\r\n    // 5. Get Config\r\n    const { data: config } = useQuery({\r\n        queryKey: [\"graduation-config\", graduationId],\r\n        queryFn: () => graduationModuleService.getCurrentConfig(graduationId!),\r\n        enabled: !!graduationId,\r\n    });\r\n\r\n\r\n    useEffect(() => {\r\n        if (graduation) {\r\n            document.title = `${graduation.name} | CMCB-XI`;\r\n        } else {\r\n            document.title = \"Formatura | CMCB-XI\";\r\n        }\r\n        return () => { document.title = \"CMCB-XI\"; };\r\n    }, [graduation]);\r\n\r\n    // --- Mutations ---\r\n\r\n    const mutationEntry = useMutation({\r\n        mutationFn: (data: any) => graduationModuleService.createEntry({\r\n            graduation_id: graduationId!,\r\n            date: new Date().toISOString(),\r\n            entry_type: data.entry_type,\r\n            pix_amount: data.payment_method === 'PIX' ? data.amount : 0,\r\n            cash_amount: data.payment_method === 'ESPECIE' ? data.amount : 0,\r\n            notes: data.description\r\n        }),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-summary-module\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-history-module\"] });\r\n            toast.success(\"Entrada registrada!\");\r\n            setOpenEntry(false);\r\n        },\r\n        onError: (err: any) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const mutationExpense = useMutation({\r\n        mutationFn: (data: any) => graduationModuleService.createExpense({\r\n            graduation_id: graduationId!,\r\n            date: new Date().toISOString(),\r\n            method: data.payment_method,\r\n            amount: data.amount,\r\n            description: data.description\r\n        }),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-summary-module\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-history-module\"] });\r\n            toast.success(\"Despesa registrada!\");\r\n            setOpenExpense(false);\r\n        },\r\n        onError: (err: any) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const mutationTransfer = useMutation({\r\n        mutationFn: (data: any) => graduationModuleService.createTransfer({\r\n            graduation_id: graduationId!,\r\n            date: new Date().toISOString(),\r\n            from_account: data.from_account,\r\n            to_account: data.to_account,\r\n            amount: data.amount,\r\n            notes: data.description\r\n        }),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-summary-module\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-history-module\"] });\r\n            toast.success(\"Transfer├¬ncia registrada!\");\r\n            setOpenTransfer(false);\r\n        },\r\n        onError: (err: any) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const mutationConfig = useMutation({\r\n        mutationFn: async (newData: any) => {\r\n            // Check if anything changed\r\n            await graduationModuleService.createNewConfigVersion(graduationId!, newData);\r\n            await graduationModuleService.generateInstallmentsForGraduation(graduationId!);\r\n            return true; // Always true now because we are always regenerating if they click the button\r\n        },\r\n        onSuccess: (hasChanged) => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-config\", graduationId] });\r\n            if (hasChanged) {\r\n                queryClient.invalidateQueries({ queryKey: [\"graduation-students-progress\"] });\r\n                queryClient.invalidateQueries({ queryKey: [\"graduation-summary-module\"] });\r\n                toast.success(\"Configura├º├úo salva e presta├º├Áes regeneradas!\");\r\n            } else {\r\n                toast.success(\"Configura├º├úo salva.\");\r\n            }\r\n            setOpenConfig(false);\r\n        },\r\n        onError: (err: any) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const mutationClass = useMutation({\r\n        mutationFn: (name: string) => graduationModuleService.createClass(graduationId!, name),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-classes-module\"] });\r\n            toast.success(\"Turma criada!\");\r\n            setOpenClass(false);\r\n        },\r\n        onError: (err: any) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const [editClass, setEditClass] = useState<GraduationClass | null>(null);\r\n    const [editClassName, setEditClassName] = useState(\"\");\r\n\r\n    const updateClassMutation = useMutation({\r\n        mutationFn: async () => {\r\n            if (!editClass || !editClassName) return;\r\n            await graduationModuleService.updateClass(editClass.id, editClassName);\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-classes-module\"] });\r\n            toast.success(\"Turma atualizada!\");\r\n            setEditClass(null);\r\n            setEditClassName(\"\");\r\n        },\r\n        onError: (err) => {\r\n            toast.error(`Erro ao atualizar: ${err.message}`);\r\n        }\r\n    });\r\n\r\n    const deleteClassMutation = useMutation({\r\n        mutationFn: async (id: string) => {\r\n            await graduationModuleService.softDeleteClass(id);\r\n        },\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-classes-module\"] });\r\n            toast.success(\"Turma removida.\");\r\n        },\r\n        onError: (err) => {\r\n            toast.error(`Erro ao remover: ${err.message}`);\r\n        }\r\n    });\r\n\r\n\r\n    if (loadingGrad) {\r\n        return (\r\n            <DashboardLayout>\r\n                <div className=\"flex items-center justify-center min-h-[60vh]\">\r\n                    <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n                </div>\r\n            </DashboardLayout>\r\n        );\r\n    }\r\n\r\n    if (!graduation) return null;\r\n\r\n    return (\r\n        <DashboardLayout>\r\n            <div className=\"space-y-6 animate-fade-in p-4 md:p-8 pt-6\">\r\n                {/* Header */}\r\n                <header className=\"flex flex-col gap-4\">\r\n                    <Button asChild variant=\"ghost\" className=\"w-fit p-0 h-auto hover:bg-transparent text-muted-foreground hover:text-primary transition-colors\">\r\n                        <Link to=\"/formaturas\" className=\"flex items-center text-sm\">\r\n                            <ChevronLeft className=\"h-4 w-4 mr-1\" /> Voltar\r\n                        </Link>\r\n                    </Button>\r\n                    <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n                        <div>\r\n                            <h1 className=\"text-3xl font-bold text-foreground\">{graduation.name}</h1>\r\n                            <p className=\"text-muted-foreground\">Ano de Refer├¬ncia: {graduation.year}</p>\r\n\r\n                        </div>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            <Button onClick={() => setOpenEntry(true)} variant=\"default\" size=\"sm\" className=\"gap-2 bg-emerald-600 hover:bg-emerald-700 text-white\">\r\n                                <Plus className=\"h-4 w-4\" /> Entrada/Aporte\r\n                            </Button>\r\n                            <Button onClick={() => setOpenExpense(true)} variant=\"destructive\" size=\"sm\" className=\"gap-2\">\r\n                                <TrendingDown className=\"h-4 w-4\" /> Despesa\r\n                            </Button>\r\n                            <Button onClick={() => setOpenTransfer(true)} variant=\"outline\" size=\"sm\" className=\"gap-2\">\r\n                                <ArrowLeftRight className=\"h-4 w-4\" /> Transfer├¬ncia\r\n                            </Button>\r\n                            <Button onClick={() => setOpenGlobalCharge(true)} variant=\"outline\" size=\"sm\" className=\"gap-2\">\r\n                                <Plus className=\"h-4 w-4\" /> Cobran├ºa Lote\r\n                            </Button>\r\n                            {isAdmin && (\r\n                                <Button onClick={() => setOpenConfig(true)} variant=\"secondary\" size=\"sm\" className=\"gap-2\">\r\n                                    <Settings className=\"h-4 w-4\" /> Config\r\n                                </Button>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </header>\r\n\r\n                <Tabs defaultValue=\"financeiro\" className=\"w-full\">\r\n                    <TabsList className=\"mb-4 bg-muted/50 p-1\">\r\n                        <TabsTrigger value=\"financeiro\" className=\"gap-2\">\r\n                            <Banknote className=\"h-4 w-4\" /> Financeiro\r\n                        </TabsTrigger>\r\n                        <TabsTrigger value=\"turmas\" className=\"gap-2\">\r\n                            <Users className=\"h-4 w-4\" /> Turmas\r\n                        </TabsTrigger>\r\n                    </TabsList>\r\n\r\n                    <TabsContent value=\"financeiro\" className=\"space-y-6\">\r\n                        {/* Cards Summary */}\r\n                        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-5\">\r\n                            <Card className=\"glass-card border-none bg-emerald-50/50 dark:bg-emerald-950/20\">\r\n                                <CardHeader className=\"pb-2\">\r\n                                    <CardTitle className=\"text-xs font-semibold uppercase text-emerald-600 dark:text-emerald-400\">Receita Total</CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <p className=\"text-xl font-bold text-emerald-700 dark:text-emerald-300\">\r\n                                        {formatCurrencyBRL(summary?.totalIncome || 0)}\r\n                                    </p>\r\n                                </CardContent>\r\n                            </Card>\r\n                            <Card className=\"glass-card border-none bg-rose-50/50 dark:bg-rose-950/20\">\r\n                                <CardHeader className=\"pb-2\">\r\n                                    <CardTitle className=\"text-xs font-semibold uppercase text-rose-600 dark:text-rose-400\">Despesas</CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <p className=\"text-xl font-bold text-rose-700 dark:text-rose-300\">\r\n                                        {formatCurrencyBRL(summary?.totalExpenses || 0)}\r\n                                    </p>\r\n                                </CardContent>\r\n                            </Card>\r\n                            <Card className=\"glass-card border-none bg-blue-50/50 dark:bg-blue-950/20\">\r\n                                <CardHeader className=\"pb-2\">\r\n                                    <CardTitle className=\"text-xs font-semibold uppercase text-blue-600 dark:text-blue-400\">Saldo Atual (Caixa)</CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <p className=\"text-xl font-bold text-blue-700 dark:text-blue-300\">\r\n                                        {formatCurrencyBRL(summary?.balanceTotal || 0)}\r\n                                    </p>\r\n                                    <p className=\"text-xs text-muted-foreground mt-1\">\r\n                                        Pix: {formatCurrencyBRL(summary?.balancePix || 0)} | Esp: {formatCurrencyBRL(summary?.balanceCash || 0)}\r\n                                    </p>\r\n                                </CardContent>\r\n                            </Card>\r\n                            <Card className=\"glass-card border-none bg-amber-50/50 dark:bg-amber-950/20\">\r\n                                <CardHeader className=\"pb-2\">\r\n                                    <CardTitle className=\"text-xs font-semibold uppercase text-amber-600 dark:text-amber-400\">Com Tesoureiro</CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <p className=\"text-xl font-bold text-amber-700 dark:text-amber-300\">\r\n                                        {formatCurrencyBRL(summary?.totalWithTreasurer || 0)}\r\n                                    </p>\r\n                                    <p className=\"text-xs text-muted-foreground mt-1 italic\">\r\n                                        Pendente de Dep├│sito\r\n                                    </p>\r\n                                </CardContent>\r\n                            </Card>\r\n                            <Card className=\"glass-card border-none bg-slate-100 dark:bg-slate-900\">\r\n\r\n                                <CardHeader className=\"pb-2\">\r\n                                    <CardTitle className=\"text-xs font-semibold uppercase text-muted-foreground\">Pendente (├Ç Receber)</CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <p className=\"text-xl font-bold text-muted-foreground\">\r\n                                        {formatCurrencyBRL(summary?.pendingIncome || 0)}\r\n                                    </p>\r\n                                </CardContent>\r\n                            </Card>\r\n                        </div>\r\n\r\n                        {/* History Table */}\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <History className=\"h-5 w-5 text-primary\" />\r\n                                <h2 className=\"text-xl font-semibold\">Hist├│rico de Movimenta├º├Áes</h2>\r\n                            </div>\r\n                            <Card className=\"border-none glass-card overflow-hidden\">\r\n                                <CardContent className=\"p-0\">\r\n                                    <div className=\"divide-y divide-border\">\r\n                                        {history?.length === 0 && (\r\n                                            <div className=\"p-8 text-center text-muted-foreground\">\r\n                                                Nenhuma movimenta├º├úo registrada.\r\n                                            </div>\r\n                                        )}\r\n                                        {history?.map((entry: any, i: number) => (\r\n                                            <div key={i} className=\"flex items-center justify-between p-4 hover:bg-muted/30 transition-colors\">\r\n                                                <div className=\"flex items-center gap-3\">\r\n                                                    <div className={cn(\r\n                                                        \"p-2 rounded-full\",\r\n                                                        (entry.type === 'ENTRADA' || entry.type === 'AJUSTE' && entry.amount >= 0) ? \"bg-emerald-100 text-emerald-600\" : \"bg-rose-100 text-rose-600\"\r\n                                                    )}>\r\n                                                        {(entry.type === 'ENTRADA' || entry.amount >= 0) ? <ArrowUpRight className=\"h-4 w-4\" /> : <ArrowDownLeft className=\"h-4 w-4\" />}\r\n                                                    </div>\r\n                                                    <div>\r\n                                                        <p className=\"font-semibold text-sm\">{entry.description || \"Sem descri├º├úo\"}</p>\r\n                                                        <p className=\"text-xs text-muted-foreground\">\r\n                                                            {new Date(entry.date).toLocaleDateString()} ÔÇó {entry.type}\r\n                                                        </p>\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div className={cn(\"font-bold\", (entry.type === 'ENTRADA' || entry.amount >= 0) ? \"text-emerald-600\" : \"text-rose-600\")}>\r\n                                                    {formatCurrencyBRL(entry.amount)}\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </CardContent>\r\n                            </Card>\r\n                        </div>\r\n                    </TabsContent>\r\n\r\n                    <TabsContent value=\"turmas\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Users className=\"h-5 w-5 text-primary\" />\r\n                                <h2 className=\"text-xl font-semibold\">Turmas</h2>\r\n                            </div>\r\n                            <Button size=\"sm\" onClick={() => setOpenClass(true)} className=\"gap-2\">\r\n                                <Plus className=\"h-4 w-4\" /> Nova Turma\r\n                            </Button>\r\n                        </div>\r\n                        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\r\n                            {classes?.map((cls) => (\r\n                                <Card\r\n                                    key={cls.id}\r\n                                    className=\"cursor-pointer hover:border-primary/50 transition-all group\"\r\n                                    onClick={() => navigate(`/formaturas/${graduation.slug}/${cls.slug || cls.id}`)}\r\n                                >\r\n                                    <CardHeader className=\"pb-2\">\r\n                                        <CardTitle className=\"flex justify-between items-center text-lg\">\r\n                                            {cls.name}\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <ArrowRight className=\"h-4 w-4 opacity-0 group-hover:opacity-100 transition-all text-primary\" />\r\n                                                {isAdmin && (\r\n                                                    <DropdownMenu>\r\n                                                        <DropdownMenuTrigger asChild>\r\n                                                            <Button variant=\"ghost\" className=\"h-8 w-8 p-0\" onClick={(e) => e.stopPropagation()} aria-label=\"A├º├Áes da turma\">\r\n                                                                <MoreVertical className=\"h-4 w-4\" />\r\n                                                            </Button>\r\n                                                        </DropdownMenuTrigger>\r\n                                                        <DropdownMenuContent align=\"end\">\r\n                                                            <DropdownMenuItem onClick={(e) => {\r\n                                                                e.stopPropagation();\r\n                                                                setEditClass(cls);\r\n                                                                setEditClassName(cls.name);\r\n                                                            }}>\r\n                                                                <Edit className=\"mr-2 h-4 w-4\" /> Editar\r\n                                                            </DropdownMenuItem>\r\n                                                            <DropdownMenuItem className=\"text-destructive focus:text-destructive\" onClick={(e) => {\r\n                                                                e.stopPropagation();\r\n                                                                if (confirm(\"Tem certeza que deseja inativar esta turma?\")) {\r\n                                                                    deleteClassMutation.mutate(cls.id);\r\n                                                                }\r\n                                                            }}>\r\n                                                                <Trash2 className=\"mr-2 h-4 w-4\" /> Excluir\r\n                                                            </DropdownMenuItem>\r\n                                                        </DropdownMenuContent>\r\n                                                    </DropdownMenu>\r\n                                                )}\r\n                                            </div>\r\n                                        </CardTitle>\r\n                                    </CardHeader>\r\n                                    <CardContent>\r\n                                        <p className=\"text-sm text-muted-foreground\">Clique para gerenciar alunos.</p>\r\n                                    </CardContent>\r\n                                </Card>\r\n                            ))}\r\n                            {classes?.length === 0 && (\r\n                                <div className=\"col-span-full py-12 text-center border-2 border-dashed border-muted rounded-xl bg-muted/50\">\r\n                                    <p className=\"text-muted-foreground\">Nenhuma turma cadastrada.</p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </TabsContent>\r\n                </Tabs>\r\n\r\n                {/* --- Dialogs --- */}\r\n\r\n                <Dialog open={openEntry} onOpenChange={setOpenEntry}>\r\n                    <DialogContent>\r\n                        <DialogHeader><DialogTitle>Nova Entrada</DialogTitle></DialogHeader>\r\n                        <EntryForm onSubmit={mutationEntry.mutate} isLoading={mutationEntry.isPending} />\r\n                    </DialogContent>\r\n                </Dialog>\r\n\r\n                <Dialog open={openExpense} onOpenChange={setOpenExpense}>\r\n                    <DialogContent>\r\n                        <DialogHeader><DialogTitle>Nova Despesa</DialogTitle></DialogHeader>\r\n                        <ExpenseForm onSubmit={mutationExpense.mutate} isLoading={mutationExpense.isPending} />\r\n                    </DialogContent>\r\n                </Dialog>\r\n\r\n                <Dialog open={openTransfer} onOpenChange={setOpenTransfer}>\r\n                    <DialogContent>\r\n                        <DialogHeader><DialogTitle>Transfer├¬ncia Interna</DialogTitle></DialogHeader>\r\n                        <TransferForm onSubmit={mutationTransfer.mutate} isLoading={mutationTransfer.isPending} />\r\n                    </DialogContent>\r\n                </Dialog>\r\n\r\n                <Dialog open={openConfig} onOpenChange={setOpenConfig}>\r\n                    <DialogContent>\r\n                        <DialogHeader><DialogTitle>Configura├º├úo Financeira</DialogTitle></DialogHeader>\r\n                        <ConfigForm\r\n                            current={config}\r\n                            onSubmit={mutationConfig.mutate}\r\n                            isLoading={mutationConfig.isPending}\r\n                        />\r\n                    </DialogContent>\r\n                </Dialog>\r\n\r\n                <Dialog open={openClass} onOpenChange={setOpenClass}>\r\n                    <DialogContent>\r\n                        <DialogHeader><DialogTitle>Nova Turma</DialogTitle></DialogHeader>\r\n                        <ClassForm onSubmit={mutationClass.mutate} isLoading={mutationClass.isPending} />\r\n                    </DialogContent>\r\n                </Dialog>\r\n\r\n            </div>\r\n            {graduation && (\r\n                <GlobalChargeBatchModal\r\n                    open={openGlobalCharge}\r\n                    onOpenChange={setOpenGlobalCharge}\r\n                    graduationId={graduation.id}\r\n                />\r\n            )}\r\n        </DashboardLayout>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\pages\\__tests__\\FormaturasPage.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\pages\\components\\GlobalChargeBatchModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1134,1137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1134,1137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1607,1610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1607,1610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3058,3061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3058,3061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/shared/ui/dialog\";\r\nimport { Button } from \"@/shared/ui/button\";\r\nimport { Input } from \"@/shared/ui/input\";\r\nimport { Label } from \"@/shared/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/shared/ui/select\";\r\nimport { ObligationKind, graduationModuleService } from \"@/features/graduations/services\";\r\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { toast } from \"sonner\";\r\nimport { Loader2, AlertTriangle } from \"lucide-react\";\r\n\r\ninterface GlobalChargeBatchModalProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    graduationId: string;\r\n}\r\n\r\nexport function GlobalChargeBatchModal({ open, onOpenChange, graduationId }: GlobalChargeBatchModalProps) {\r\n    const queryClient = useQueryClient();\r\n    const [kind, setKind] = useState<ObligationKind>(\"RIFA\");\r\n    const [label, setLabel] = useState(\"\");\r\n    const [amount, setAmount] = useState(\"\");\r\n\r\n    const mutation = useMutation({\r\n        mutationFn: (data: any) => graduationModuleService.createGlobalChargeBatch(data),\r\n        onSuccess: (count: number) => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-students-progress\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-summary-module\"] });\r\n            toast.success(`${count} cobran├ºas criadas com sucesso para todas as turmas!`);\r\n            onOpenChange(false);\r\n            resetForm();\r\n        },\r\n        onError: (err: any) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const resetForm = () => {\r\n        setKind(\"RIFA\");\r\n        setLabel(\"\");\r\n        setAmount(\"\");\r\n    };\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!label || !amount) {\r\n            toast.error(\"Preencha todos os campos obrigat├│rios\");\r\n            return;\r\n        }\r\n\r\n        mutation.mutate({\r\n            graduation_id: graduationId,\r\n            kind,\r\n            reference_label: label,\r\n            amount: parseFloat(amount),\r\n        });\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"max-w-md\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Criar Cobran├ºa Global (Todas as Turmas)</DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <div className=\"bg-amber-50 border border-amber-200 rounded-md p-3 flex gap-3 text-amber-800 text-sm mb-2\">\r\n                    <AlertTriangle className=\"h-5 w-5 shrink-0\" />\r\n                    <p>Esta cobran├ºa ser├í aplicada a <strong>todos os alunos ativos</strong> de todas as turmas desta formatura.</p>\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-4 py-4\">\r\n                    <div className=\"grid gap-2\">\r\n                        <Label>Tipo de Cobran├ºa</Label>\r\n                        <Select value={kind} onValueChange={(v: any) => setKind(v)}>\r\n                            <SelectTrigger>\r\n                                <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                <SelectItem value=\"RIFA\">Rifa</SelectItem>\r\n                                <SelectItem value=\"BINGO\">Bingo</SelectItem>\r\n                                <SelectItem value=\"OUTROS\">Outros</SelectItem>\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    <div className=\"grid gap-2\">\r\n                        <Label>Nome/Refer├¬ncia (ex: Rifa Agosto)</Label>\r\n                        <Input\r\n                            value={label}\r\n                            onChange={e => setLabel(e.target.value)}\r\n                            placeholder=\"Identifica├º├úo da cobran├ºa\"\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"grid gap-2\">\r\n                        <Label>Valor (R$)</Label>\r\n                        <Input\r\n                            type=\"number\"\r\n                            step=\"0.01\"\r\n                            value={amount}\r\n                            onChange={e => setAmount(e.target.value)}\r\n                            placeholder=\"0,00\"\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    <DialogFooter className=\"pt-4\">\r\n                        <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button type=\"submit\" disabled={mutation.isPending}>\r\n                            {mutation.isPending ? <Loader2 className=\"animate-spin mr-2 h-4 w-4\" /> : null}\r\n                            Gerar Cobran├ºa Global\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\pages\\components\\GraduationForms.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[534,537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[534,537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1912,1915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1912,1915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2500,2503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2500,2503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3430,3433],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3430,3433],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4686,4689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4686,4689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5387,5390],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5387,5390],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6582,6585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6582,6585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7169,7172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7169,7172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8093,8096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8093,8096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":9,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useEffect } from \"react\";\r\nimport { Button } from \"@/shared/ui/button\";\r\nimport { Input } from \"@/shared/ui/input\";\r\nimport { Label } from \"@/shared/ui/label\";\r\nimport { Loader2 } from \"lucide-react\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/shared/ui/select\";\r\nimport { GraduationPayMethod, GraduationEntryType, GraduationConfig } from \"@/features/graduations/services\";\r\n\r\nexport function EntryForm({ onSubmit, isLoading }: { onSubmit: (data: any) => void; isLoading: boolean }) {\r\n    const [amount, setAmount] = useState(\"\");\r\n    const [desc, setDesc] = useState(\"\");\r\n    const [method, setMethod] = useState<GraduationPayMethod>('PIX');\r\n    const [type, setType] = useState<GraduationEntryType>('OUTROS');\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        onSubmit({\r\n            amount: Number(amount),\r\n            description: desc,\r\n            payment_method: method,\r\n            entry_type: type\r\n        });\r\n    };\r\n    return (\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"entry-desc\">Descri├º├úo</Label>\r\n                <Input id=\"entry-desc\" value={desc} onChange={e => setDesc(e.target.value)} placeholder=\"Ex: Rifa de P├íscoa\" required />\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"grid gap-2\">\r\n                    <Label htmlFor=\"entry-amount\">Valor (R$)</Label>\r\n                    <Input id=\"entry-amount\" type=\"number\" step=\"0.01\" value={amount} onChange={e => setAmount(e.target.value)} required />\r\n                </div>\r\n                <div className=\"grid gap-2\">\r\n                    <Label htmlFor=\"entry-method\">M├®todo</Label>\r\n                    <Select value={method} onValueChange={(v: any) => setMethod(v)}>\r\n                        <SelectTrigger id=\"entry-method\"><SelectValue /></SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"PIX\">PIX</SelectItem>\r\n                            <SelectItem value=\"ESPECIE\">Dinheiro</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n            </div>\r\n            <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"entry-type\">Tipo de Entrada</Label>\r\n                <Select value={type} onValueChange={(v: any) => setType(v)}>\r\n                    <SelectTrigger id=\"entry-type\"><SelectValue /></SelectTrigger>\r\n                    <SelectContent>\r\n                        <SelectItem value=\"OUTROS\">Outros</SelectItem>\r\n                        <SelectItem value=\"RIFA\">Rifa</SelectItem>\r\n                        <SelectItem value=\"BINGO\">Bingo</SelectItem>\r\n                        <SelectItem value=\"VENDA\">Venda</SelectItem>\r\n                        <SelectItem value=\"DOACAO\">Doa├º├úo</SelectItem>\r\n                        <SelectItem value=\"MENSALIDADE\">Mensalidade (Avulsa)</SelectItem>\r\n                    </SelectContent>\r\n                </Select>\r\n            </div>\r\n            <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>{isLoading ? <Loader2 className=\"animate-spin\" /> : \"Registrar Entrada\"}</Button>\r\n        </form>\r\n    );\r\n}\r\n\r\nexport function ExpenseForm({ onSubmit, isLoading }: { onSubmit: (data: any) => void; isLoading: boolean }) {\r\n    const [amount, setAmount] = useState(\"\");\r\n    const [desc, setDesc] = useState(\"\");\r\n    const [method, setMethod] = useState<GraduationPayMethod>('PIX');\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        onSubmit({\r\n            amount: Number(amount),\r\n            description: desc,\r\n            payment_method: method,\r\n        });\r\n    };\r\n    return (\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"exp-desc\">Descri├º├úo da Despesa</Label>\r\n                <Input id=\"exp-desc\" value={desc} onChange={e => setDesc(e.target.value)} required />\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"grid gap-2\">\r\n                    <Label htmlFor=\"exp-amount\">Valor (R$)</Label>\r\n                    <Input id=\"exp-amount\" type=\"number\" step=\"0.01\" value={amount} onChange={e => setAmount(e.target.value)} required />\r\n                </div>\r\n                <div className=\"grid gap-2\">\r\n                    <Label htmlFor=\"exp-method\">M├®todo Pagamento</Label>\r\n                    <Select value={method} onValueChange={(v: any) => setMethod(v)}>\r\n                        <SelectTrigger id=\"exp-method\"><SelectValue /></SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"PIX\">PIX</SelectItem>\r\n                            <SelectItem value=\"ESPECIE\">Dinheiro</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n            </div>\r\n            <Button type=\"submit\" variant=\"destructive\" className=\"w-full\" disabled={isLoading}>{isLoading ? <Loader2 className=\"animate-spin\" /> : \"Registrar Despesa\"}</Button>\r\n        </form>\r\n    );\r\n}\r\n\r\nexport function TransferForm({ onSubmit, isLoading }: { onSubmit: (data: any) => void; isLoading: boolean }) {\r\n    const [amount, setAmount] = useState(\"\");\r\n    const [desc, setDesc] = useState(\"Transfer├¬ncia\");\r\n    const [from, setFrom] = useState<GraduationPayMethod>('ESPECIE');\r\n    const [to, setTo] = useState<GraduationPayMethod>('PIX');\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        onSubmit({\r\n            amount: Number(amount),\r\n            description: desc,\r\n            from_account: from,\r\n            to_account: to\r\n        });\r\n    };\r\n    return (\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <p className=\"text-sm text-muted-foreground\">Registrar transfer├¬ncia entre contas.</p>\r\n            <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"trans-amount\">Valor</Label>\r\n                <Input id=\"trans-amount\" type=\"number\" step=\"0.01\" value={amount} onChange={e => setAmount(e.target.value)} required />\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"grid gap-2\">\r\n                    <Label htmlFor=\"trans-from\">De (Origem)</Label>\r\n                    <Select value={from} onValueChange={(v: any) => setFrom(v)}>\r\n                        <SelectTrigger id=\"trans-from\"><SelectValue /></SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"PIX\">PIX / Banco</SelectItem>\r\n                            <SelectItem value=\"ESPECIE\">Dinheiro em M├úos</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n                <div className=\"grid gap-2\">\r\n                    <Label htmlFor=\"trans-to\">Para (Destino)</Label>\r\n                    <Select value={to} onValueChange={(v: any) => setTo(v)}>\r\n                        <SelectTrigger id=\"trans-to\"><SelectValue /></SelectTrigger>\r\n                        <SelectContent>\r\n                            <SelectItem value=\"PIX\">PIX / Banco</SelectItem>\r\n                            <SelectItem value=\"ESPECIE\">Dinheiro em M├úos</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n            </div>\r\n            <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"trans-desc\">Descri├º├úo</Label>\r\n                <Input id=\"trans-desc\" value={desc} onChange={e => setDesc(e.target.value)} />\r\n            </div>\r\n            <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>Registrar Transfer├¬ncia</Button>\r\n        </form>\r\n    );\r\n}\r\n\r\nexport function ConfigForm({ current, onSubmit, isLoading }: {\r\n    current: GraduationConfig | null | undefined;\r\n    onSubmit: (data: any) => void;\r\n    isLoading: boolean;\r\n}) {\r\n    const [val, setVal] = useState<string>(current?.installment_value?.toString() || \"\");\r\n    const [count, setCount] = useState<string>(current?.installments_count?.toString() || \"\");\r\n    const [day, setDay] = useState<string>(current?.due_day?.toString() || \"10\");\r\n    const [month, setMonth] = useState<string>(current?.start_month?.toString() || \"2\");\r\n\r\n    useEffect(() => {\r\n        if (current) {\r\n            setVal(current.installment_value.toString());\r\n            setCount(current.installments_count.toString());\r\n            setDay(current.due_day.toString());\r\n            setMonth(current.start_month.toString());\r\n        }\r\n    }, [current]);\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        onSubmit({\r\n            installment_value: Number(val),\r\n            installments_count: Number(count),\r\n            due_day: Number(day),\r\n            start_month: Number(month)\r\n        });\r\n    };\r\n\r\n    return (\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"cfg-val\">Valor da Mensalidade (R$)</Label>\r\n                <Input id=\"cfg-val\" type=\"number\" step=\"0.01\" value={val} onChange={e => setVal(e.target.value)} required />\r\n            </div>\r\n            <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"cfg-count\">Quantidade de Parcelas</Label>\r\n                <Input id=\"cfg-count\" type=\"number\" value={count} onChange={e => setCount(e.target.value)} required />\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"grid gap-2\">\r\n                    <Label htmlFor=\"cfg-day\">Dia Venc.</Label>\r\n                    <Input id=\"cfg-day\" type=\"number\" value={day} onChange={e => setDay(e.target.value)} required />\r\n                </div>\r\n                <div className=\"grid gap-2\">\r\n                    <Label htmlFor=\"cfg-month\">M├¬s In├¡cio</Label>\r\n                    <Input id=\"cfg-month\" type=\"number\" value={month} onChange={e => setMonth(e.target.value)} required />\r\n                </div>\r\n            </div>\r\n            <div className=\"pt-4 border-t border-dashed mt-4\">\r\n                <div className=\"bg-amber-50 dark:bg-amber-950/20 p-3 rounded-lg border border-amber-100 dark:border-amber-900/50 mb-3 text-[11px] text-amber-800 dark:text-amber-300\">\r\n                    <p className=\"font-bold flex items-center gap-1 mb-1\">\r\n                        ÔÜá´©Å ATEN├ç├âO: Ressalva de Gera├º├úo\r\n                    </p>\r\n                    <p>Ao salvar, <strong>TODAS as presta├º├Áes atuais (incluindo pagas)</strong> ser├úo <strong>APAGADAS</strong> e regeneradas com estes novos valores.</p>\r\n                </div>\r\n                <Button type=\"submit\" className=\"w-full bg-amber-600 hover:bg-amber-700\" disabled={isLoading}>\r\n                    {isLoading ? <Loader2 className=\"animate-spin mr-2 h-4 w-4\" /> : null}\r\n                    Salvar e Regenerar Presta├º├Áes\r\n                </Button>\r\n            </div>\r\n        </form>\r\n    );\r\n}\r\n\r\nexport function ClassForm({ onSubmit, isLoading }: { onSubmit: (name: string) => void; isLoading: boolean }) {\r\n    const [name, setName] = useState(\"\");\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        onSubmit(name);\r\n    };\r\n    return (\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n            <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"class-name\">Nome da Turma</Label>\r\n                <Input id=\"class-name\" value={name} onChange={e => setName(e.target.value)} placeholder=\"Ex: 3┬║ Ano A\" required />\r\n            </div>\r\n            <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>{isLoading ? <Loader2 className=\"animate-spin\" /> : \"Criar Turma\"}</Button>\r\n        </form>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\pages\\components\\PaymentBatchModal.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1611,1614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1611,1614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2058,2061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2058,2061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState } from \"react\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/shared/ui/dialog\";\r\nimport { Button } from \"@/shared/ui/button\";\r\nimport { Input } from \"@/shared/ui/input\";\r\nimport { Label } from \"@/shared/ui/label\";\r\nimport { Checkbox } from \"@/shared/ui/checkbox\";\r\nimport { graduationModuleService } from \"@/features/graduations/services\";\r\nimport { useMutation, useQueryClient, useQuery } from \"@tanstack/react-query\";\r\nimport { toast } from \"sonner\";\r\nimport { Loader2, Search } from \"lucide-react\";\r\nimport { useAuth } from \"@/features/auth/contexts/AuthContext\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/shared/ui/select\";\r\n\r\ninterface PaymentBatchModalProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    classId: string;\r\n    students: { id: string; full_name: string }[];\r\n}\r\n\r\nexport function PaymentBatchModal({ open, onOpenChange, classId, students }: PaymentBatchModalProps) {\r\n    const queryClient = useQueryClient();\r\n    const { user } = useAuth();\r\n    const [label, setLabel] = useState(\"\");\r\n    const [selectedStudents, setSelectedStudents] = useState<string[]>([]);\r\n    const [searchTerm, setSearchTerm] = useState(\"\");\r\n\r\n    const { data: labels, isLoading: isLoadingLabels } = useQuery({\r\n        queryKey: [\"open-obligation-labels\", classId],\r\n        queryFn: () => graduationModuleService.getOpenObligationLabels(classId),\r\n        enabled: open && !!classId\r\n    });\r\n\r\n    const mutation = useMutation({\r\n        mutationFn: (data: any) => graduationModuleService.batchMarkObligationsPaid(data),\r\n        onSuccess: (count) => {\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-students-progress\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"open-obligation-labels\"] });\r\n            toast.success(`${count} pagamentos registrados com sucesso!`);\r\n            onOpenChange(false);\r\n            resetForm();\r\n        },\r\n        onError: (err: any) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const resetForm = () => {\r\n        setLabel(\"\");\r\n        setSelectedStudents([]);\r\n        setSearchTerm(\"\");\r\n    };\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!label) {\r\n            toast.error(\"Selecione a refer├¬ncia do pagamento\");\r\n            return;\r\n        }\r\n\r\n        if (selectedStudents.length === 0) {\r\n            toast.error(\"Selecione pelo menos um aluno\");\r\n            return;\r\n        }\r\n\r\n        mutation.mutate({\r\n            class_id: classId,\r\n            student_ids: selectedStudents,\r\n            reference_label: label,\r\n            paid_at: new Date().toISOString(),\r\n            received_by: user?.email || \"Admin\",\r\n        });\r\n    };\r\n\r\n    const toggleStudent = (id: string) => {\r\n        setSelectedStudents(prev =>\r\n            prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]\r\n        );\r\n    };\r\n\r\n    const filteredStudents = students.filter(s =>\r\n        s.full_name.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n\r\n    const toggleAllVisible = () => {\r\n        const visibleIds = filteredStudents.map(s => s.id);\r\n        const allSelected = visibleIds.every(id => selectedStudents.includes(id));\r\n\r\n        if (allSelected) {\r\n            setSelectedStudents(prev => prev.filter(id => !visibleIds.includes(id)));\r\n        } else {\r\n            setSelectedStudents(prev => Array.from(new Set([...prev, ...visibleIds])));\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"max-w-md\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Baixa de Pagamento em Lote</DialogTitle>\r\n                </DialogHeader>\r\n                <form onSubmit={handleSubmit} className=\"space-y-4 py-4\">\r\n                    <div className=\"grid gap-2\">\r\n                        <Label>Selecione a Presta├º├úo em Aberto</Label>\r\n                        {isLoadingLabels ? (\r\n                            <div className=\"flex items-center gap-2 text-sm text-muted-foreground h-10 px-3 border rounded-md\">\r\n                                <Loader2 className=\"h-4 w-4 animate-spin\" /> Carregando parcelas...\r\n                            </div>\r\n                        ) : (\r\n                            <Select value={label} onValueChange={setLabel}>\r\n                                <SelectTrigger>\r\n                                    <SelectValue placeholder=\"Selecione uma parcela/refer├¬ncia\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    {labels?.map(l => (\r\n                                        <SelectItem key={l} value={l}>{l}</SelectItem>\r\n                                    ))}\r\n                                    {labels?.length === 0 && (\r\n                                        <div className=\"text-xs text-center py-4 text-muted-foreground\">\r\n                                            Nenhuma parcela em aberto encontrada para esta turma.\r\n                                        </div>\r\n                                    )}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        )}\r\n                        <p className=\"text-[10px] text-muted-foreground\">Apenas parcelas com status \"EM ABERTO\" ser├úo baixadas.</p>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-4 pt-2\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <Label>Selecionar Alunos ({selectedStudents.length})</Label>\r\n                            <div className=\"flex gap-2\">\r\n                                <Button type=\"button\" variant=\"link\" size=\"sm\" onClick={toggleAllVisible} className=\"h-auto p-0 text-xs\">\r\n                                    Vis├¡veis\r\n                                </Button>\r\n                                <Button type=\"button\" variant=\"link\" size=\"sm\" onClick={() => setSelectedStudents(students.map(s => s.id))} className=\"h-auto p-0 text-xs text-blue-600\">\r\n                                    Todos\r\n                                </Button>\r\n                                <Button type=\"button\" variant=\"link\" size=\"sm\" onClick={() => setSelectedStudents([])} className=\"h-auto p-0 text-xs text-muted-foreground\">\r\n                                    Nenhum\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"relative\">\r\n                            <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                            <Input\r\n                                placeholder=\"Filtrar alunos...\"\r\n                                value={searchTerm}\r\n                                onChange={e => setSearchTerm(e.target.value)}\r\n                                className=\"pl-8\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"border rounded-md p-2 max-h-60 overflow-y-auto space-y-2 bg-muted/20\">\r\n                            {filteredStudents.map(s => (\r\n                                <div key={s.id} className=\"flex items-center space-x-2 p-1 hover:bg-muted/50 rounded transition-colors\">\r\n                                    <Checkbox\r\n                                        id={`pay-st-${s.id}`}\r\n                                        checked={selectedStudents.includes(s.id)}\r\n                                        onCheckedChange={() => toggleStudent(s.id)}\r\n                                    />\r\n                                    <Label htmlFor={`pay-st-${s.id}`} className=\"text-sm font-normal flex-1 cursor-pointer py-1\">\r\n                                        {s.full_name}\r\n                                    </Label>\r\n                                </div>\r\n                            ))}\r\n                            {filteredStudents.length === 0 && (\r\n                                <p className=\"text-center text-xs text-muted-foreground py-4\">Nenhum aluno encontrado.</p>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <DialogFooter className=\"pt-4\">\r\n                        <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button\r\n                            type=\"submit\"\r\n                            disabled={mutation.isPending || !labels || labels.length === 0 || !label || selectedStudents.length === 0}\r\n                            className=\"bg-emerald-600 hover:bg-emerald-700\"\r\n                        >\r\n                            {mutation.isPending ? <Loader2 className=\"animate-spin mr-2 h-4 w-4\" /> : null}\r\n                            Confirmar Recebimento\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\pages\\components\\StudentFinancialDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1987,1990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1987,1990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter,\r\n} from \"@/shared/ui/dialog\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { graduationModuleService, StudentObligation } from \"@/features/graduations/services\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/shared/ui/table\";\r\nimport { Button } from \"@/shared/ui/button\";\r\nimport { Loader2, Check, Undo2, Calendar as CalendarIcon, User, PencilLine, AlertCircle, BadgeDollarSign, Wallet } from \"lucide-react\";\r\nimport { formatCurrencyBRL } from \"@/shared/lib/currency\";\r\nimport { toast } from \"sonner\";\r\nimport { cn } from \"@/shared/lib/utils\";\r\nimport { Badge } from \"@/shared/ui/badge\";\r\nimport { useAuth } from \"@/features/auth/contexts/AuthContext\";\r\nimport { useState } from \"react\";\r\nimport { Input } from \"@/shared/ui/input\";\r\nimport { Label } from \"@/shared/ui/label\";\r\nimport { Card, CardContent } from \"@/shared/ui/card\";\r\nimport { formatDateString, formatDateBR } from \"@/shared/lib/date-utils\";\r\n\r\n\r\ninterface Props {\r\n    studentId: string | null;\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nexport function StudentFinancialDialog({ studentId, open, onOpenChange }: Props) {\r\n    const queryClient = useQueryClient();\r\n    const { profile } = useAuth();\r\n    const [confirmingPayment, setConfirmingPayment] = useState<StudentObligation | null>(null);\r\n    const [paymentDetails, setPaymentDetails] = useState({\r\n        paid_at: formatDateString(new Date()),\r\n        received_by: profile?.name || \"\",\r\n        signature: \"\"\r\n    });\r\n\r\n\r\n    const { data: obligations, isLoading } = useQuery({\r\n        queryKey: [\"student-obligations\", studentId],\r\n        queryFn: () => graduationModuleService.getStudentObligations(studentId!),\r\n        enabled: !!studentId && open\r\n    });\r\n\r\n    const mutationPay = useMutation({\r\n        mutationFn: (data: { id: string, details: any }) =>\r\n            graduationModuleService.markObligationPaid(data.id, data.details),\r\n\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"student-obligations\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-students-progress\"] });\r\n            toast.success(\"Pagamento registrado!\");\r\n            setConfirmingPayment(null);\r\n        },\r\n        onError: (err) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const mutationRevert = useMutation({\r\n        mutationFn: (id: string) => graduationModuleService.revertObligationToOpen(id),\r\n        onSuccess: () => {\r\n            queryClient.invalidateQueries({ queryKey: [\"student-obligations\"] });\r\n            queryClient.invalidateQueries({ queryKey: [\"graduation-students-progress\"] });\r\n            toast.success(\"Pagamento estornado!\");\r\n        },\r\n        onError: (err) => toast.error(\"Erro: \" + err.message)\r\n    });\r\n\r\n    const handleConfirmPayment = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!confirmingPayment) return;\r\n        mutationPay.mutate({\r\n            id: confirmingPayment.id,\r\n            details: paymentDetails\r\n        });\r\n    };\r\n\r\n    const totalPaid = obligations?.filter(o => o.status === 'PAGO').reduce((acc, o) => acc + Number(o.amount), 0) || 0;\r\n    const totalOpen = obligations?.filter(o => o.status === 'EM_ABERTO').reduce((acc, o) => acc + Number(o.amount), 0) || 0;\r\n    const totalGeral = (obligations || []).reduce((acc, o) => acc + Number(o.amount), 0);\r\n    const hasOverdue = obligations?.some(o => o.status === 'EM_ABERTO' && o.due_date && new Date(o.due_date) < new Date());\r\n\r\n    return (\r\n        <>\r\n            <Dialog open={open} onOpenChange={onOpenChange}>\r\n                <DialogContent className=\"max-w-4xl\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"flex items-center gap-2\">\r\n                            <Wallet className=\"h-5 w-5 text-primary\" />\r\n                            Extrato Financeiro do Aluno\r\n                        </DialogTitle>\r\n                    </DialogHeader>\r\n\r\n                    {isLoading ? (\r\n                        <div className=\"flex justify-center py-8\"><Loader2 className=\"animate-spin\" /></div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            {/* Summary Cards */}\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\r\n                                <Card className=\"bg-emerald-50 dark:bg-emerald-950/20 border-emerald-100\">\r\n                                    <CardContent className=\"p-3\">\r\n                                        <p className=\"text-[10px] uppercase font-bold text-emerald-600 mb-1\">Total Pago</p>\r\n                                        <p className=\"text-lg font-bold text-emerald-700 dark:text-emerald-400\">{formatCurrencyBRL(totalPaid)}</p>\r\n                                    </CardContent>\r\n                                </Card>\r\n                                <Card className={cn(\"border-amber-100\", hasOverdue ? \"bg-rose-50 dark:bg-rose-950/20 border-rose-100\" : \"bg-amber-50 dark:bg-amber-950/20\")}>\r\n                                    <CardContent className=\"p-3\">\r\n                                        <p className={cn(\"text-[10px] uppercase font-bold mb-1\", hasOverdue ? \"text-rose-600\" : \"text-amber-600\")}>\r\n                                            Total em Aberto {hasOverdue && \"(Com Atraso)\"}\r\n                                        </p>\r\n                                        <p className={cn(\"text-lg font-bold\", hasOverdue ? \"text-rose-700 dark:text-rose-400\" : \"text-amber-700 dark:text-amber-400\")}>\r\n                                            {formatCurrencyBRL(totalOpen)}\r\n                                        </p>\r\n                                    </CardContent>\r\n                                </Card>\r\n                                <Card className=\"bg-slate-50 dark:bg-slate-900 border-slate-200\">\r\n                                    <CardContent className=\"p-3\">\r\n                                        <p className=\"text-[10px] uppercase font-bold text-slate-500 mb-1\">Total Geral</p>\r\n                                        <p className=\"text-lg font-bold text-slate-700 dark:text-slate-300\">{formatCurrencyBRL(totalGeral)}</p>\r\n                                    </CardContent>\r\n                                </Card>\r\n                            </div>\r\n\r\n                            <div className=\"border rounded-lg overflow-hidden\">\r\n                                <Table>\r\n                                    <TableHeader className=\"bg-muted/50\">\r\n                                        <TableRow>\r\n                                            <TableHead className=\"w-[40%]\">Parcela / Refer├¬ncia</TableHead>\r\n                                            <TableHead>Vencimento</TableHead>\r\n                                            <TableHead>Valor</TableHead>\r\n                                            <TableHead>Status</TableHead>\r\n                                            <TableHead className=\"text-right\">A├º├Áes</TableHead>\r\n                                        </TableRow>\r\n                                    </TableHeader>\r\n                                    <TableBody>\r\n                                        {obligations?.length === 0 && (\r\n                                            <TableRow><TableCell colSpan={5} className=\"text-center py-12 text-muted-foreground\">Nenhuma obriga├º├úo gerada para este aluno.</TableCell></TableRow>\r\n                                        )}\r\n                                        {obligations?.map(obs => {\r\n                                            const today = formatDateString(new Date());\r\n                                            const isOverdue = obs.status === 'EM_ABERTO' && obs.due_date && obs.due_date < today;\r\n                                            return (\r\n                                                <TableRow key={obs.id} className={cn(\r\n                                                    \"transition-colors\",\r\n                                                    obs.status === 'PAGO' ? \"bg-emerald-50/30 hover:bg-emerald-50/50\" : isOverdue ? \"bg-rose-50/30 hover:bg-rose-50/50\" : \"hover:bg-muted/30\"\r\n                                                )}>\r\n                                                    <TableCell className=\"font-medium\">\r\n                                                        <div className=\"flex items-center gap-2\">\r\n                                                            {obs.status === 'PAGO' ? (\r\n                                                                <div className=\"p-1 rounded-full bg-emerald-100 text-emerald-600\"><Check className=\"h-3 w-3\" /></div>\r\n                                                            ) : isOverdue ? (\r\n                                                                <div className=\"p-1 rounded-full bg-rose-100 text-rose-600\"><AlertCircle className=\"h-3 w-3\" /></div>\r\n                                                            ) : (\r\n                                                                <div className=\"p-1 rounded-full bg-amber-100 text-amber-600\"><BadgeDollarSign className=\"h-3 w-3\" /></div>\r\n                                                            )}\r\n                                                            {obs.reference_label}\r\n                                                        </div>\r\n                                                    </TableCell>\r\n                                                    <TableCell className={cn(isOverdue && \"text-rose-600 font-semibold\")}>\r\n                                                        {formatDateBR(obs.due_date)}\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"font-semibold\">{formatCurrencyBRL(obs.amount)}</TableCell>\r\n                                                    <TableCell>\r\n                                                        <Badge variant={obs.status === 'PAGO' ? 'default' : 'outline'} className={cn(\r\n                                                            \"font-bold text-[10px]\",\r\n                                                            obs.status === 'PAGO'\r\n                                                                ? \"bg-emerald-100 text-emerald-800 hover:bg-emerald-100 border-none px-2 py-0\"\r\n                                                                : isOverdue\r\n                                                                    ? \"bg-rose-100 text-rose-800 border-none px-2 py-0\"\r\n                                                                    : \"text-amber-600 border-amber-200 px-2 py-0\"\r\n                                                        )}>\r\n                                                            {obs.status === 'PAGO' ? \"PAGO\" : isOverdue ? \"ATRASADO\" : \"EM ABERTO\"}\r\n                                                        </Badge>\r\n                                                    </TableCell>\r\n                                                    <TableCell className=\"text-right\">\r\n                                                        {obs.status === 'EM_ABERTO' ? (\r\n                                                            <Button\r\n                                                                size=\"sm\"\r\n                                                                variant=\"outline\"\r\n                                                                className=\"h-8 text-emerald-600 border-emerald-200 hover:bg-emerald-50 text-xs font-bold\"\r\n                                                                onClick={() => {\r\n                                                                    setConfirmingPayment(obs);\r\n                                                                    setPaymentDetails(prev => ({ ...prev, received_by: profile?.name || \"\" }));\r\n                                                                }}\r\n                                                            >\r\n                                                                RECEBER\r\n                                                            </Button>\r\n                                                        ) : (\r\n                                                            <Button\r\n                                                                size=\"sm\"\r\n                                                                variant=\"ghost\"\r\n                                                                className=\"h-8 text-muted-foreground hover:text-destructive text-xs\"\r\n                                                                onClick={() => {\r\n                                                                    if (confirm(\"Deseja estornar esse pagamento?\")) {\r\n                                                                        mutationRevert.mutate(obs.id);\r\n                                                                    }\r\n                                                                }}\r\n                                                                disabled={mutationRevert.isPending}\r\n                                                            >\r\n                                                                {mutationRevert.isPending ? <Loader2 className=\"h-3 w-3 animate-spin\" /> : <Undo2 className=\"h-3 w-3 mr-1\" />} Estornar\r\n                                                            </Button>\r\n                                                        )}\r\n                                                    </TableCell>\r\n                                                </TableRow>\r\n                                            );\r\n                                        })}\r\n                                    </TableBody>\r\n                                </Table>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Modal de Confirma├º├úo de Pagamento */}\r\n            <Dialog open={!!confirmingPayment} onOpenChange={(o) => !o && setConfirmingPayment(null)}>\r\n                <DialogContent>\r\n                    <DialogHeader>\r\n                        <DialogTitle>Registrar Recebimento</DialogTitle>\r\n                    </DialogHeader>\r\n                    <form onSubmit={handleConfirmPayment} className=\"space-y-4 py-4\">\r\n                        <div className=\"bg-muted/50 p-3 rounded-md mb-4 text-sm\">\r\n                            <p><strong>Item:</strong> {confirmingPayment?.reference_label}</p>\r\n                            <p><strong>Valor:</strong> {confirmingPayment ? formatCurrencyBRL(confirmingPayment.amount) : \"\"}</p>\r\n                        </div>\r\n\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"paid_at\">Data de Pagamento</Label>\r\n                            <div className=\"relative\">\r\n                                <CalendarIcon className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    id=\"paid_at\"\r\n                                    type=\"date\"\r\n                                    className=\"pl-8\"\r\n                                    value={paymentDetails.paid_at}\r\n                                    onChange={e => setPaymentDetails(p => ({ ...p, paid_at: e.target.value }))}\r\n                                    required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"received_by\">Recebido por</Label>\r\n                            <div className=\"relative\">\r\n                                <User className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    id=\"received_by\"\r\n                                    className=\"pl-8\"\r\n                                    value={paymentDetails.received_by}\r\n                                    onChange={e => setPaymentDetails(p => ({ ...p, received_by: e.target.value }))}\r\n                                    placeholder=\"Nome do tesoureiro/respons├ível\"\r\n                                    required\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"signature\">Assinatura / Observa├º├úo</Label>\r\n                            <div className=\"relative\">\r\n                                <PencilLine className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    id=\"signature\"\r\n                                    className=\"pl-8\"\r\n                                    value={paymentDetails.signature}\r\n                                    onChange={e => setPaymentDetails(p => ({ ...p, signature: e.target.value }))}\r\n                                    placeholder=\"Texto livre ou observa├º├úo\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <DialogFooter className=\"pt-4\">\r\n                            <Button type=\"button\" variant=\"ghost\" onClick={() => setConfirmingPayment(null)}>Cancelar</Button>\r\n                            <Button type=\"submit\" disabled={mutationPay.isPending} className=\"bg-emerald-600 hover:bg-emerald-700\">\r\n                                {mutationPay.isPending ? <Loader2 className=\"animate-spin mr-2 h-4 w-4\" /> : <Check className=\"mr-2 h-4 w-4\" />}\r\n                                Confirmar Pagamento\r\n                            </Button>\r\n                        </DialogFooter>\r\n                    </form>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\pages\\components\\StudentForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\services\\__tests__\\graduationService.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1350,1353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1350,1353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2251,2254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2251,2254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3067,3070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3067,3070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3424,3427],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3424,3427],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4163,4166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4163,4166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4430,4433],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4430,4433],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4623,4626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4623,4626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4813,4816],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4813,4816],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { graduationService } from \"../graduationService\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\n\r\n// Mock supabase\r\nvi.mock(\"@/integrations/supabase/client\", () => ({\r\n    supabase: {\r\n        from: vi.fn(() => ({\r\n            select: vi.fn(),\r\n            insert: vi.fn(),\r\n            update: vi.fn(),\r\n            eq: vi.fn(),\r\n            order: vi.fn(),\r\n            single: vi.fn(),\r\n            maybeSingle: vi.fn(),\r\n            limit: vi.fn(),\r\n            in: vi.fn(),\r\n        })),\r\n        auth: {\r\n            getUser: vi.fn(() => ({ data: { user: { id: \"user-123\" } } })),\r\n        }\r\n    }\r\n}));\r\n\r\ndescribe(\"graduationService\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n    });\r\n\r\n    describe(\"createGraduation\", () => {\r\n        it(\"should generate a correct slug and call insert\", async () => {\r\n            const mockData = { id: \"1\", name: \"Formatura 2026\", year: 2026, slug: \"formatura-2026\" };\r\n            const fromSpy = vi.mocked(supabase.from);\r\n            const selectSpy = vi.fn().mockReturnValue({ single: vi.fn().mockResolvedValue({ data: mockData, error: null }) });\r\n            const insertSpy = vi.fn().mockReturnValue({ select: selectSpy });\r\n\r\n            fromSpy.mockReturnValue({ insert: insertSpy } as any);\r\n\r\n            const result = await graduationService.createGraduation(\"Formatura 2026\", 2026);\r\n\r\n            expect(result.slug).toBe(\"formatura-2026\");\r\n            expect(insertSpy).toHaveBeenCalledWith({\r\n                name: \"Formatura 2026\",\r\n                year: 2026,\r\n                active: true,\r\n                slug: \"formatura-2026\"\r\n            });\r\n        });\r\n\r\n        it(\"should normalize names for slugs (accents and special chars)\", async () => {\r\n            const mockData = { id: \"1\", name: \"A├º├óo & Teste\", year: 2026, slug: \"acao-teste\" };\r\n            const fromSpy = vi.mocked(supabase.from);\r\n            const selectSpy = vi.fn().mockReturnValue({ single: vi.fn().mockResolvedValue({ data: mockData, error: null }) });\r\n            const insertSpy = vi.fn().mockReturnValue({ select: selectSpy });\r\n\r\n            fromSpy.mockReturnValue({ insert: insertSpy } as any);\r\n\r\n            await graduationService.createGraduation(\"A├º├óo & Teste\", 2026);\r\n\r\n            expect(insertSpy).toHaveBeenCalledWith(expect.objectContaining({\r\n                slug: \"acao-teste\"\r\n            }));\r\n        });\r\n    });\r\n\r\n    describe(\"generateCarnetForStudent\", () => {\r\n        it(\"should generate correct number of installments with due dates\", async () => {\r\n            // Mock student find\r\n            const fromSpy = vi.mocked(supabase.from);\r\n\r\n            // 1. mock student\r\n            fromSpy.mockReturnValueOnce({\r\n                select: vi.fn().mockReturnValue({\r\n                    eq: vi.fn().mockReturnValue({\r\n                        single: vi.fn().mockResolvedValue({ data: { class_id: \"c1\" }, error: null })\r\n                    })\r\n                })\r\n            } as any);\r\n\r\n            // 2. mock class find\r\n            fromSpy.mockReturnValueOnce({\r\n                select: vi.fn().mockReturnValue({\r\n                    eq: vi.fn().mockReturnValue({\r\n                        single: vi.fn().mockResolvedValue({ data: { graduation_id: \"g1\" }, error: null })\r\n                    })\r\n                })\r\n            } as any);\r\n\r\n            // 3. mock config find (via getcurrentcarnetconfig)\r\n            fromSpy.mockReturnValueOnce({\r\n                select: vi.fn().mockReturnValue({\r\n                    eq: vi.fn().mockReturnValue({\r\n                        order: vi.fn().mockReturnValue({\r\n                            limit: vi.fn().mockReturnValue({\r\n                                maybeSingle: vi.fn().mockResolvedValue({\r\n                                    data: { id: \"conf1\", installments_count: 12, due_day: 10, installment_value: 50 },\r\n                                    error: null\r\n                                })\r\n                            })\r\n                        })\r\n                    })\r\n                })\r\n            } as any);\r\n\r\n            // 4. mock installments count check\r\n            fromSpy.mockReturnValueOnce({\r\n                select: vi.fn().mockReturnValue({\r\n                    eq: vi.fn().mockResolvedValue({ count: 0, error: null })\r\n                })\r\n            } as any);\r\n\r\n            // 5. mock insert installments\r\n            const insertSpy = vi.fn().mockResolvedValue({ error: null });\r\n            fromSpy.mockReturnValueOnce({ insert: insertSpy } as any);\r\n\r\n            await graduationService.generateCarnetForStudent(\"s1\");\r\n\r\n            expect(insertSpy).toHaveBeenCalled();\r\n            const inserted = insertSpy.mock.calls[0][0] as any[];\r\n            expect(inserted).toHaveLength(12);\r\n            expect(inserted[0].due_date).toBe(\"2026-01-10\");\r\n            expect(inserted[11].due_date).toBe(\"2026-12-10\");\r\n        });\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\services\\classService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[613,616],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[613,616],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1181,1184],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1181,1184],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1750,1753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1750,1753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2004,2007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2004,2007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2301,2304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2301,2304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2748,2751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2748,2751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3281,3284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3281,3284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3453,3456],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3453,3456],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3541,3544],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3541,3544],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3637,3640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3637,3640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3940,3943],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3940,3943],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4044,4047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4044,4047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4102,4105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4102,4105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4946,4949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4946,4949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6785,6788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6785,6788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":167,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":167,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6922,6925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6922,6925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7304,7307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7304,7307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7400,7403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7400,7403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7793,7796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7793,7796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7897,7900],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7897,7900],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":189,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7955,7958],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7955,7958],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":213,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":213,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8973,8976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8973,8976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":243,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9934,9937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9934,9937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":259,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10600,10603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10600,10603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":265,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10793,10796],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10793,10796],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":270,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":270,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11041,11044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11041,11044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":276,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":276,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11234,11237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11234,11237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":280,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11434,11437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11434,11437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":283,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11552,11555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11552,11555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":288,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":288,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11706,11709],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11706,11709],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":289,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11805,11808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11805,11808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":291,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":291,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11863,11866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11863,11866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":293,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11921,11924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11921,11924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":300,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":300,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12291,12294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12291,12294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":301,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":301,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12351,12354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12351,12354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":315,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":315,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12914,12917],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12914,12917],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":330,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13418,13421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13418,13421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":339,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13735,13738],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13735,13738],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":352,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":352,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14207,14210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14207,14210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":39,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport ExcelJS from \"exceljs\";\r\nimport { GraduationClass, ObligationKind } from \"@/features/graduations/services/types\";\r\nimport { graduationService } from \"@/features/graduations/services/graduationService\";\r\nimport { formatDateString } from \"@/shared/lib/date-utils\";\r\nimport { studentService } from \"@/features/graduations/services/studentService\";\r\n\r\nexport const classService = {\r\n    async listClasses(graduationId: string): Promise<GraduationClass[]> {\r\n        const { data, error } = await supabase\r\n            .from('graduation_classes' as any)\r\n            .select('*')\r\n            .eq('graduation_id', graduationId)\r\n            .eq('active', true)\r\n            .order('name');\r\n\r\n        if (error) throw error;\r\n        return data as unknown as GraduationClass[];\r\n    },\r\n\r\n    async createClass(graduationId: string, name: string): Promise<GraduationClass> {\r\n        const slug = `${name.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').replace(/[^a-z0-9]+/g, '-')}`.replace(/^-+|-+$/g, '');\r\n\r\n        const { data, error } = await supabase\r\n            .from('graduation_classes' as any)\r\n            .upsert({ graduation_id: graduationId, name, active: true, slug }, { onConflict: 'graduation_id, slug' })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return data as unknown as GraduationClass;\r\n    },\r\n\r\n    async updateClass(id: string, name: string): Promise<void> {\r\n        const slug = `${name.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').replace(/[^a-z0-9]+/g, '-')}`.replace(/^-+|-+$/g, '');\r\n\r\n        const { error } = await supabase\r\n            .from('graduation_classes' as any)\r\n            .update({ name, slug })\r\n            .eq('id', id);\r\n        if (error) throw error;\r\n    },\r\n\r\n    async softDeleteClass(id: string): Promise<void> {\r\n        const { error } = await supabase\r\n            .from('graduation_classes' as any)\r\n            .update({ active: false })\r\n            .eq('id', id);\r\n        if (error) throw error;\r\n    },\r\n\r\n    async getClassBySlug(graduationId: string, slug: string): Promise<GraduationClass> {\r\n        const { data, error } = await supabase\r\n            .from('graduation_classes' as any)\r\n            .select('*')\r\n            .eq('graduation_id', graduationId)\r\n            .eq('slug', slug)\r\n            .maybeSingle();\r\n\r\n        if (error) throw error;\r\n        if (data) return data as unknown as GraduationClass;\r\n\r\n        if (/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(slug)) {\r\n            const { data: dataId, error: errorId } = await supabase\r\n                .from('graduation_classes' as any)\r\n                .select('*')\r\n                .eq('graduation_id', graduationId)\r\n                .eq('id', slug)\r\n                .maybeSingle();\r\n\r\n            if (errorId) throw errorId;\r\n            if (dataId) return dataId as unknown as GraduationClass;\r\n        }\r\n\r\n        throw new Error(\"Turma n├úo encontrada\");\r\n    },\r\n\r\n    async generateInstallmentsForStudent(studentId: string): Promise<void> {\r\n        const { data: student, error: stError } = await supabase\r\n            .from('graduation_class_students' as any)\r\n            .select('class_id')\r\n            .eq('id', studentId)\r\n            .single();\r\n\r\n        if (stError) throw stError;\r\n        const classId = (student as any).class_id;\r\n\r\n        const resultCls = await supabase.from('graduation_classes' as any).select('graduation_id').eq('id', classId).single();\r\n        const cls = resultCls.data as any;\r\n\r\n        if (!cls) throw new Error(\"Turma n├úo encontrada\");\r\n\r\n        const config = await graduationService.getCurrentConfig(cls.graduation_id);\r\n        if (!config) throw new Error(\"Nenhuma configura├º├úo vigente encontrada\");\r\n\r\n        const resultGrad = await supabase.from('graduations' as any).select('year').eq('id', cls.graduation_id).single();\r\n        const baseYear = (resultGrad.data as any)?.year || 2026;\r\n\r\n        const obligationsToInsert: any[] = [];\r\n        for (let i = 1; i <= config.installments_count; i++) {\r\n            const monthIndex = (config.start_month - 1) + (i - 1);\r\n            const dueDate = new Date(baseYear, monthIndex, config.due_day);\r\n\r\n            obligationsToInsert.push({\r\n                graduation_id: cls.graduation_id,\r\n                class_id: classId,\r\n                student_id: studentId,\r\n                kind: 'MENSALIDADE',\r\n                reference_label: `Parcela ${i.toString().padStart(2, '0')}/${config.installments_count}`,\r\n                installment_number: i,\r\n                amount: config.installment_value,\r\n                due_date: formatDateString(dueDate),\r\n                status: 'EM_ABERTO'\r\n            });\r\n        }\r\n\r\n        const { error } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .upsert(obligationsToInsert, {\r\n                onConflict: 'student_id, kind, installment_number',\r\n                ignoreDuplicates: true\r\n            });\r\n\r\n        if (error) throw error;\r\n    },\r\n\r\n    async importStudentsFromExcel(classId: string, file: File): Promise<{ count: number, installmentsCount: number, errors: string[] }> {\r\n        const workbook = new ExcelJS.Workbook();\r\n        const arrayBuffer = await file.arrayBuffer();\r\n        await workbook.xlsx.load(arrayBuffer);\r\n\r\n        const worksheet = workbook.getWorksheet(1);\r\n        const rows: { name: string; guardian?: string }[] = [];\r\n\r\n        if (worksheet) {\r\n            worksheet.eachRow((row, rowNumber) => {\r\n                const col1 = row.getCell(1).value;\r\n                const col2 = row.getCell(2).value;\r\n                const name = typeof col1 === 'string' ? col1.trim() : '';\r\n                const guardian = typeof col2 === 'string' ? col2.trim() : undefined;\r\n\r\n                if (name && rowNumber > 1) {\r\n                    rows.push({ name, guardian });\r\n                } else if (name && rowNumber === 1 && !name.toLowerCase().includes('nome')) {\r\n                    rows.push({ name, guardian });\r\n                }\r\n            });\r\n        }\r\n\r\n        if (rows.length === 0) throw new Error(\"Nenhum nome encontrado na primeira coluna.\");\r\n\r\n        let count = 0;\r\n        let installmentsCount = 0;\r\n        const errors: string[] = [];\r\n\r\n        for (const { name, guardian } of rows) {\r\n            try {\r\n                const student = await studentService.createStudent(classId, name, guardian);\r\n                count++;\r\n                try {\r\n                    await this.generateInstallmentsForStudent(student.id);\r\n                    installmentsCount++;\r\n                } catch (installErr: any) {\r\n                    console.warn(`Erro ao gerar carn├¬ para ${name}:`, installErr);\r\n                }\r\n            } catch (err: any) {\r\n                console.error(`Erro ao importar ${name}:`, err);\r\n                errors.push(`Falha ao importar ${name}: ${err.message}`);\r\n            }\r\n        }\r\n\r\n        return { count, installmentsCount, errors };\r\n    },\r\n\r\n    async generateInstallmentsBatch(classId: string): Promise<void> {\r\n        const resultCls = await supabase.from('graduation_classes' as any).select('graduation_id').eq('id', classId).single();\r\n        const cls = resultCls.data as any;\r\n\r\n        if (!cls) throw new Error(\"Turma n├úo encontrada\");\r\n\r\n        const config = await graduationService.getCurrentConfig(cls.graduation_id);\r\n        if (!config) throw new Error(\"Nenhuma configura├º├úo vigente encontrada para esta formatura\");\r\n\r\n        const students = await studentService.listStudents(classId);\r\n        const resultGrad = await supabase.from('graduations' as any).select('year').eq('id', cls.graduation_id).single();\r\n        const baseYear = (resultGrad.data as any)?.year || 2026;\r\n\r\n        const obligationsToInsert: any[] = [];\r\n\r\n        for (const student of students) {\r\n            for (let i = 1; i <= config.installments_count; i++) {\r\n                const monthIndex = (config.start_month - 1) + (i - 1);\r\n                const dueDate = new Date(baseYear, monthIndex, config.due_day);\r\n\r\n                obligationsToInsert.push({\r\n                    graduation_id: cls.graduation_id,\r\n                    class_id: classId,\r\n                    student_id: student.id,\r\n                    kind: 'MENSALIDADE',\r\n                    reference_label: `Parcela ${i.toString().padStart(2, '0')}/${config.installments_count}`,\r\n                    installment_number: i,\r\n                    amount: config.installment_value,\r\n                    due_date: formatDateString(dueDate),\r\n                    status: 'EM_ABERTO'\r\n                });\r\n            }\r\n        }\r\n\r\n        if (obligationsToInsert.length === 0) return;\r\n\r\n        const { error } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .upsert(obligationsToInsert, {\r\n                onConflict: 'student_id,kind,installment_number',\r\n                ignoreDuplicates: true\r\n            });\r\n\r\n        if (error) throw error;\r\n    },\r\n\r\n    async createChargeBatch(data: {\r\n        graduation_id: string;\r\n        class_id: string;\r\n        student_ids: string[];\r\n        kind: ObligationKind;\r\n        reference_label: string;\r\n        amount: number;\r\n        due_date?: string;\r\n    }): Promise<void> {\r\n        const payload = data.student_ids.map(sid => ({\r\n            graduation_id: data.graduation_id,\r\n            class_id: data.class_id,\r\n            student_id: sid,\r\n            kind: data.kind,\r\n            reference_label: data.reference_label,\r\n            amount: data.amount,\r\n            due_date: data.due_date,\r\n            status: 'EM_ABERTO'\r\n        }));\r\n\r\n        const { error } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .upsert(payload, {\r\n                onConflict: 'student_id,kind,reference_label',\r\n                ignoreDuplicates: true\r\n            });\r\n\r\n        if (error) throw error;\r\n    },\r\n\r\n    async generateInstallmentsForGraduation(graduationId: string): Promise<void> {\r\n        // 1. Get current config\r\n        const config = await graduationService.getCurrentConfig(graduationId);\r\n        if (!config) throw new Error(\"Nenhuma configura├º├úo vigente encontrada para esta formatura\");\r\n\r\n        // 2. Get all classes for this graduation\r\n        const { data: classes, error: clsError } = await supabase\r\n            .from('graduation_classes' as any)\r\n            .select('id')\r\n            .eq('graduation_id', graduationId)\r\n            .eq('active', true);\r\n\r\n        if (clsError) throw clsError;\r\n        const classIds = (classes as any[] || []).map(c => c.id);\r\n        if (classIds.length === 0) return;\r\n\r\n        // 3. Get all active students in these classes\r\n        const { data: students, error: stError } = await supabase\r\n            .from('graduation_class_students' as any)\r\n            .select('id, class_id')\r\n            .eq('active', true)\r\n            .in('class_id', classIds);\r\n\r\n        if (stError) throw stError;\r\n        if (!students || (students as any[]).length === 0) return;\r\n\r\n        // 4. WIPE existing installments of type MENSALIDADE\r\n        const { error: delError } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .delete()\r\n            .eq('graduation_id', graduationId)\r\n            .eq('kind', 'MENSALIDADE' as any);\r\n\r\n        if (delError) throw delError;\r\n\r\n        // 5. Generate new instalments\r\n        const resultGrad = await supabase.from('graduations' as any).select('year').eq('id', graduationId).single();\r\n        const baseYear = (resultGrad.data as any)?.year || 2026;\r\n\r\n        const obligationsToInsert: any[] = [];\r\n\r\n        for (const student of (students as any[])) {\r\n            for (let i = 1; i <= config.installments_count; i++) {\r\n                const monthIndex = (config.start_month - 1) + (i - 1);\r\n                const dueDate = new Date(baseYear, monthIndex, config.due_day);\r\n\r\n                obligationsToInsert.push({\r\n                    graduation_id: graduationId,\r\n                    class_id: (student as any).class_id,\r\n                    student_id: (student as any).id,\r\n                    kind: 'MENSALIDADE',\r\n                    reference_label: `Parcela ${i.toString().padStart(2, '0')}/${config.installments_count}`,\r\n                    installment_number: i,\r\n                    amount: config.installment_value,\r\n                    due_date: formatDateString(dueDate),\r\n                    status: 'EM_ABERTO'\r\n                });\r\n            }\r\n        }\r\n\r\n        if (obligationsToInsert.length === 0) return;\r\n\r\n        const { error } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .insert(obligationsToInsert);\r\n\r\n        if (error) throw error;\r\n    },\r\n\r\n    async createGlobalChargeBatch(data: {\r\n        graduation_id: string;\r\n        kind: ObligationKind;\r\n        reference_label: string;\r\n        amount: number;\r\n        due_date?: string;\r\n    }): Promise<number> {\r\n        // 1. Get all students from all classes of this graduation\r\n        const { data: students, error: studentsError } = await supabase\r\n            .from('graduation_class_students' as any)\r\n            .select('id, class_id')\r\n            .eq('graduation_id', data.graduation_id)\r\n            .eq('status', 'ATIVO');\r\n\r\n        if (studentsError) throw studentsError;\r\n        if (!students || students.length === 0) return 0;\r\n\r\n        // 2. Map to obligations\r\n        const payload = (students as any[]).map(s => ({\r\n            graduation_id: data.graduation_id,\r\n            class_id: s.class_id,\r\n            student_id: s.id,\r\n            kind: data.kind,\r\n            reference_label: data.reference_label,\r\n            amount: data.amount,\r\n            due_date: data.due_date,\r\n            status: 'EM_ABERTO'\r\n        }));\r\n\r\n        // 3. Insert and return count\r\n        const { error } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .upsert(payload, {\r\n                onConflict: 'student_id,kind,reference_label',\r\n                ignoreDuplicates: true\r\n            });\r\n\r\n        if (error) throw error;\r\n        return payload.length;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\services\\financeService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[641,644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[641,644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1041,1044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1041,1044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1458,1461],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1458,1461],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1867,1870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1867,1870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2168,2171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2168,2171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2276,2279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2276,2279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2385,2388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2385,2388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2496,2499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2496,2499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2917,2920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2917,2920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3167,3170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3167,3170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3389,3392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3389,3392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3675,3678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3675,3678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4086,4089],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4086,4089],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4315,4318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4315,4318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4326,4329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4326,4329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4450,4453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4450,4453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4531,4534],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4531,4534],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4790,4793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4790,4793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4977,4980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4977,4980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4988,4991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4988,4991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5567,5570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5567,5570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5675,5678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5675,5678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":159,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":159,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5784,5787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5784,5787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5895,5898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5895,5898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6058,6061],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6058,6061],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6496,6499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6496,6499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":184,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6769,6772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6769,6772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7049,7052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7049,7052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":206,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7599,7602],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7599,7602],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":222,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8128,8131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8128,8131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8464,8467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8464,8467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":255,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9186,9189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9186,9189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":273,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9781,9784],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9781,9784],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":281,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10063,10066],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10063,10066],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":34,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport {\r\n    GraduationEntryType,\r\n    GraduationPayMethod,\r\n    GraduationFinancialCard,\r\n    FinancialTransaction,\r\n    StudentObligation\r\n} from \"@/features/graduations/services/types\";\r\n\r\nexport const financeService = {\r\n    async createEntry(data: {\r\n        graduation_id: string;\r\n        class_id?: string;\r\n        date: string;\r\n        entry_type: GraduationEntryType;\r\n        cash_amount: number;\r\n        pix_amount: number;\r\n        notes?: string;\r\n    }): Promise<void> {\r\n        const { error } = await supabase\r\n            .from('graduation_fin_entries' as any)\r\n            .insert(data);\r\n        if (error) throw error;\r\n    },\r\n\r\n    async createExpense(data: {\r\n        graduation_id: string;\r\n        class_id?: string;\r\n        date: string;\r\n        method: GraduationPayMethod;\r\n        amount: number;\r\n        description: string;\r\n    }): Promise<void> {\r\n        const { error } = await supabase\r\n            .from('graduation_fin_expenses' as any)\r\n            .insert(data);\r\n        if (error) throw error;\r\n    },\r\n\r\n    async createTransfer(data: {\r\n        graduation_id: string;\r\n        date: string;\r\n        from_account: GraduationPayMethod;\r\n        to_account: GraduationPayMethod;\r\n        amount: number;\r\n        notes?: string;\r\n    }): Promise<void> {\r\n        const { error } = await supabase\r\n            .from('graduation_fin_transfers' as any)\r\n            .insert(data);\r\n        if (error) throw error;\r\n    },\r\n\r\n    async createAdjustment(data: {\r\n        graduation_id: string;\r\n        date: string;\r\n        account: GraduationPayMethod;\r\n        direction: 'POS' | 'NEG';\r\n        amount: number;\r\n        notes?: string;\r\n    }): Promise<void> {\r\n        const { error } = await supabase\r\n            .from('graduation_fin_adjustments' as any)\r\n            .insert(data);\r\n        if (error) throw error;\r\n    },\r\n\r\n    async getFinancialSummary(graduationId: string): Promise<GraduationFinancialCard> {\r\n        const [entries, expenses, transfers, adjustments] = await Promise.all([\r\n            supabase.from('graduation_fin_entries' as any).select('*').eq('graduation_id', graduationId),\r\n            supabase.from('graduation_fin_expenses' as any).select('*').eq('graduation_id', graduationId),\r\n            supabase.from('graduation_fin_transfers' as any).select('*').eq('graduation_id', graduationId),\r\n            supabase.from('graduation_fin_adjustments' as any).select('*').eq('graduation_id', graduationId)\r\n        ]);\r\n\r\n        if (entries.error) throw entries.error;\r\n        if (expenses.error) throw expenses.error;\r\n        if (transfers.error) throw transfers.error;\r\n        if (adjustments.error) throw adjustments.error;\r\n\r\n        let pix = 0;\r\n        let cash = 0;\r\n        let totalExp = 0;\r\n        let totalInc = 0;\r\n\r\n        (entries.data || []).forEach((e: any) => {\r\n            const p = Number(e.pix_amount || 0);\r\n            const c = Number(e.cash_amount || 0);\r\n            pix += p;\r\n            cash += c;\r\n            totalInc += (p + c);\r\n        });\r\n\r\n        (expenses.data || []).forEach((e: any) => {\r\n            const val = Number(e.amount);\r\n            totalExp += val;\r\n            if (e.method === 'PIX') pix -= val;\r\n            else cash -= val;\r\n        });\r\n\r\n        (transfers.data || []).forEach((t: any) => {\r\n            const val = Number(t.amount);\r\n            if (t.from_account === 'PIX') pix -= val;\r\n            else cash -= val;\r\n\r\n            if (t.to_account === 'PIX') pix += val;\r\n            else cash += val;\r\n        });\r\n\r\n        (adjustments.data || []).forEach((a: any) => {\r\n            const val = Number(a.amount);\r\n            const isPos = a.direction === 'POS';\r\n            if (a.account === 'PIX') {\r\n                pix = isPos ? pix + val : pix - val;\r\n            } else {\r\n                cash = isPos ? cash + val : cash - val;\r\n            }\r\n        });\r\n\r\n        const { data: paidObs } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .select('amount')\r\n            .eq('graduation_id', graduationId)\r\n            .eq('kind', 'MENSALIDADE')\r\n            .eq('status', 'PAGO');\r\n\r\n        const totalPaidObligations = (paidObs || []).reduce((acc: any, curr: any) => acc + Number(curr.amount), 0);\r\n\r\n        const totalEntriesTuition = (entries.data || [])\r\n            .filter((e: any) => e.entry_type === 'MENSALIDADE')\r\n            .reduce((acc: number, curr: any) => acc + Number(curr.pix_amount) + Number(curr.cash_amount), 0);\r\n\r\n        const totalWithTreasurer = totalPaidObligations - totalEntriesTuition;\r\n\r\n        const { data: openObs } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .select('amount')\r\n            .eq('graduation_id', graduationId)\r\n            .eq('status', 'EM_ABERTO');\r\n\r\n        const pendingIncome = (openObs || []).reduce((acc: any, curr: any) => acc + Number(curr.amount), 0);\r\n\r\n        return {\r\n            totalIncome: totalInc,\r\n            totalExpenses: totalExp,\r\n            balanceTotal: pix + cash,\r\n            balancePix: pix,\r\n            balanceCash: cash,\r\n            pendingIncome: pendingIncome,\r\n            totalWithTreasurer: Math.max(0, totalWithTreasurer)\r\n        };\r\n    },\r\n\r\n    async getHistory(graduationId: string): Promise<FinancialTransaction[]> {\r\n        const [entries, expenses, transfers, adjustments] = await Promise.all([\r\n            supabase.from('graduation_fin_entries' as any).select('*').eq('graduation_id', graduationId),\r\n            supabase.from('graduation_fin_expenses' as any).select('*').eq('graduation_id', graduationId),\r\n            supabase.from('graduation_fin_transfers' as any).select('*').eq('graduation_id', graduationId),\r\n            supabase.from('graduation_fin_adjustments' as any).select('*').eq('graduation_id', graduationId)\r\n        ]);\r\n\r\n        const history: FinancialTransaction[] = [];\r\n\r\n        (entries.data || []).forEach((e: any) => history.push({\r\n            id: e.id,\r\n            date: e.date,\r\n            type: 'ENTRADA',\r\n            category: e.entry_type,\r\n            description: e.notes || `Entrada ${e.entry_type}`,\r\n            amount: Number(e.pix_amount) + Number(e.cash_amount),\r\n            method: e.pix_amount > 0 && e.cash_amount > 0 ? 'MISTO' : e.pix_amount > 0 ? 'PIX' : 'ESPECIE'\r\n        }));\r\n\r\n        (expenses.data || []).forEach((e: any) => history.push({\r\n            id: e.id,\r\n            date: e.date,\r\n            type: 'DESPESA',\r\n            description: e.description,\r\n            amount: Number(e.amount),\r\n            method: e.method\r\n        }));\r\n\r\n        (transfers.data || []).forEach((e: any) => history.push({\r\n            id: e.id,\r\n            date: e.date,\r\n            type: 'TRANSFERENCIA',\r\n            description: `De ${e.from_account} para ${e.to_account}`,\r\n            amount: Number(e.amount)\r\n        }));\r\n\r\n        (adjustments.data || []).forEach((e: any) => history.push({\r\n            id: e.id,\r\n            date: e.date,\r\n            type: 'AJUSTE',\r\n            description: `Ajuste ${e.direction} em ${e.account}`,\r\n            amount: Number(e.amount),\r\n            account: e.account\r\n        }));\r\n\r\n        return history.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n    },\r\n\r\n    async getStudentObligations(studentId: string): Promise<StudentObligation[]> {\r\n        const { data, error } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .select('*')\r\n            .eq('student_id', studentId)\r\n            .order('due_date', { ascending: true });\r\n\r\n        if (error) throw error;\r\n        return data as unknown as StudentObligation[];\r\n    },\r\n\r\n    async markObligationPaid(id: string, details: {\r\n        paid_at: string;\r\n        received_by: string;\r\n        financial_responsible?: string;\r\n        signature?: string;\r\n    }): Promise<void> {\r\n        const { error } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .update({\r\n                status: 'PAGO',\r\n                ...details\r\n            })\r\n            .eq('id', id);\r\n        if (error) throw error;\r\n    },\r\n\r\n    async revertObligationToOpen(id: string): Promise<void> {\r\n        const { error } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .update({\r\n                status: 'EM_ABERTO',\r\n                paid_at: null,\r\n                received_by: null,\r\n                financial_responsible: null,\r\n                signature: null\r\n            })\r\n            .eq('id', id);\r\n        if (error) throw error;\r\n    },\r\n\r\n    async batchMarkObligationsPaid(data: {\r\n        student_ids: string[];\r\n        class_id: string;\r\n        reference_label: string;\r\n        paid_at: string;\r\n        received_by: string;\r\n    }): Promise<number> {\r\n        const { student_ids, class_id, reference_label, paid_at, received_by } = data;\r\n\r\n        const { data: updated, error } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .update({\r\n                status: 'PAGO',\r\n                paid_at,\r\n                received_by\r\n            })\r\n            .in('student_id', student_ids)\r\n            .eq('class_id', class_id)\r\n            .eq('reference_label', reference_label)\r\n            .eq('status', 'EM_ABERTO')\r\n            .select('id');\r\n\r\n        if (error) throw error;\r\n        return updated?.length || 0;\r\n    },\r\n\r\n    async getOpenObligationLabels(classId: string): Promise<string[]> {\r\n        const { data, error } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .select('reference_label')\r\n            .eq('class_id', classId)\r\n            .eq('status', 'EM_ABERTO');\r\n\r\n        if (error) throw error;\r\n\r\n        // Extract unique labels and filter nulls/empty\r\n        const labels = Array.from(new Set((data || []).map((d: any) => d.reference_label)))\r\n            .filter(Boolean) as string[];\r\n\r\n        return labels.sort();\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\services\\graduationService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2906,2909],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2906,2909],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3505,3508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3505,3508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":125,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":125,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4075,4078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4075,4078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4320,4323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4320,4323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4588,4591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4588,4591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4929,4932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4929,4932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":161,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5315,5318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5315,5318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5738,5741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5738,5741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":183,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6133,6136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6133,6136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6492,6495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6492,6495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":202,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":202,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6826,6829],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6826,6829],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":223,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7715,7718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7715,7718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":231,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7988,7991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7988,7991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":240,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":240,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8293,8296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8293,8296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":247,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":247,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8627,8630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8627,8630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":258,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9067,9070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9067,9070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":266,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":266,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9368,9371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9368,9371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":268,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":268,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9446,9449],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9446,9449],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":272,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9574,9577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9574,9577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":278,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":278,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9921,9924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9921,9924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":301,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":301,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10852,10855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10852,10855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":311,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11196,11199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11196,11199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":322,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":322,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11673,11676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11673,11676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":339,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":339,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12209,12212],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12209,12212],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":349,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":349,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12570,12573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12570,12573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":363,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":363,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13136,13139],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13136,13139],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":371,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":371,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13592,13595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13592,13595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":380,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":380,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13980,13983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13980,13983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":385,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14148,14151],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14148,14151],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":396,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":396,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14620,14623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14620,14623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":401,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":401,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14784,14787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14784,14787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":412,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":412,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15273,15276],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15273,15276],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":418,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":418,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15490,15493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15490,15493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":422,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15700,15703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15700,15703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":427,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":427,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15884,15887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15884,15887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":431,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":431,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16129,16132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16129,16132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":437,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":437,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16342,16345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16342,16345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":443,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":443,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16586,16589],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16586,16589],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":453,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":453,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16875,16878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16875,16878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":479,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":479,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17932,17935],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17932,17935],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":486,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":486,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18228,18231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18228,18231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":41,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { supabase } from \"@/integrations/supabase/client\";\r\nimport { Database } from \"@/integrations/supabase/types\";\r\nimport { format, addMonths, setDate } from \"date-fns\";\r\nimport ExcelJS from \"exceljs\";\r\n\r\nexport type GraduationInstallmentStatus = 'EM_ABERTO' | 'PAGO' | 'ISENTO' | 'CANCELADO';\r\nexport type GraduationExtraType = 'RIFA' | 'BINGO' | 'ALIMENTOS' | 'EVENTO' | 'DOACAO' | 'OUTROS';\r\nexport type PaymentMethod = Database[\"public\"][\"Enums\"][\"payment_method\"];\r\nexport type GraduationTreasuryType = 'RECEBIMENTO_TURMA' | 'DESPESA' | 'REPASSE_ASSOCIACAO' | 'MOVIMENTACAO_INTERNA' | 'AJUSTE';\r\nexport type GraduationMoneyLocation = 'CONTA' | 'ESPECIE';\r\n\r\nexport interface GraduationTreasuryEntry {\r\n    id: string;\r\n    graduation_id: string;\r\n    class_id?: string;\r\n    type: GraduationTreasuryType;\r\n    location: GraduationMoneyLocation;\r\n    date: string;\r\n    value: number;\r\n    notes?: string;\r\n    created_by?: string;\r\n    created_at: string;\r\n}\r\n\r\nexport interface Graduation {\r\n    id: string;\r\n    name: string;\r\n    year: number;\r\n    active: boolean;\r\n    slug: string;\r\n    created_at: string;\r\n}\r\n\r\nexport interface GraduationClass {\r\n    id: string;\r\n    graduation_id: string;\r\n    name: string;\r\n    active: boolean;\r\n    slug: string;\r\n    created_at: string;\r\n}\r\n\r\nexport interface GraduationStudent {\r\n    id: string;\r\n    class_id: string;\r\n    name: string;\r\n    active: boolean;\r\n    created_at: string;\r\n}\r\n\r\nexport interface GraduationCarnetConfig {\r\n    id: string;\r\n    graduation_id: string;\r\n    installment_value: number;\r\n    installments_count: number;\r\n    due_day: number;\r\n    start_month: number;\r\n    version: number;\r\n    is_current: boolean;\r\n    created_by?: string;\r\n    created_at: string;\r\n}\r\n\r\nexport interface GraduationInstallment {\r\n    id: string;\r\n    student_id: string;\r\n    carnet_config_id: string;\r\n    installment_number: number;\r\n    value: number;\r\n    due_date: string;\r\n    status: GraduationInstallmentStatus;\r\n    paid_at?: string;\r\n    pay_method?: PaymentMethod;\r\n    notes?: string;\r\n    created_at: string;\r\n}\r\n\r\nexport interface GraduationFinancialSummary {\r\n    totalPaid: number;      // Total arrecadado pelos alunos (com tesoureiros de turma)\r\n    totalExtras: number;    // Arrecada├º├Áes extras\r\n    totalExpenses: number;  // Despesas pagas\r\n    balanceInHand: number;  // Saldo Total Estimado\r\n\r\n    // Vis├úo do Custodiante (Tesouraria Central)\r\n    treasuryBalance: number;    // Total em posse do custodiante\r\n    treasuryBank: number;       // Saldo em Conta/Pix\r\n    treasuryCash: number;       // Saldo em Dinheiro f├¡sico\r\n    pendingFromClasses: number; // Saldo que ainda est├í com os tesoureiros de turma\r\n}\r\n\r\nexport const graduationService = {\r\n    // Graduation & Classes\r\n    async getGraduations(): Promise<Graduation[]> {\r\n        const { data, error } = await supabase\r\n            .from(\"graduations\" as any)\r\n            .select(\"*\")\r\n            .eq('active', true)\r\n            .order(\"name\");\r\n        if (error) throw error;\r\n        return data as unknown as Graduation[];\r\n    },\r\n\r\n    async listGraduations(): Promise<Graduation[]> {\r\n        return this.getGraduations();\r\n    },\r\n\r\n    async createGraduation(name: string, year: number): Promise<Graduation> {\r\n        const slug = `${name.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').replace(/[^a-z0-9]+/g, '-')}`.replace(/^-+|-+$/g, '');\r\n        const { data, error } = await supabase\r\n            .from('graduations' as any)\r\n            .insert({ name, year, active: true, slug })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return data as unknown as Graduation;\r\n    },\r\n\r\n    async updateGraduation(id: string, updates: Partial<Graduation>): Promise<void> {\r\n        if (updates.name) {\r\n            updates.slug = `${updates.name.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').replace(/[^a-z0-9]+/g, '-')}`.replace(/^-+|-+$/g, '');\r\n        }\r\n\r\n        const { error } = await supabase\r\n            .from('graduations' as any)\r\n            .update(updates)\r\n            .eq('id', id);\r\n        if (error) throw error;\r\n    },\r\n\r\n    async softDeleteGraduation(id: string): Promise<void> {\r\n        const { error } = await supabase\r\n            .from('graduations' as any)\r\n            .update({ active: false })\r\n            .eq('id', id);\r\n        if (error) throw error;\r\n    },\r\n\r\n    async getGraduationBySlug(slug: string): Promise<Graduation> {\r\n        const { data, error } = await supabase\r\n            .from(\"graduations\" as any)\r\n            .select(\"*\")\r\n            .eq(\"slug\", slug)\r\n            .single();\r\n        if (error) throw error;\r\n        return data as unknown as Graduation;\r\n    },\r\n\r\n    async getClasses(graduationId: string): Promise<GraduationClass[]> {\r\n        const { data, error } = await supabase\r\n            .from(\"graduation_classes\" as any)\r\n            .select(\"*\")\r\n            .eq(\"graduation_id\", graduationId)\r\n            .order(\"name\");\r\n        if (error) throw error;\r\n        return data as unknown as GraduationClass[];\r\n    },\r\n\r\n    async getClassBySlug(graduationId: string, slug: string): Promise<GraduationClass> {\r\n        const { data, error } = await supabase\r\n            .from(\"graduation_classes\" as any)\r\n            .select(\"*\")\r\n            .eq(\"graduation_id\", graduationId)\r\n            .eq(\"slug\", slug)\r\n            .single();\r\n        if (error) throw error;\r\n        return data as unknown as GraduationClass;\r\n    },\r\n\r\n    // Students\r\n    async getStudentsByClass(classId: string): Promise<GraduationStudent[]> {\r\n        const { data, error } = await supabase\r\n            .from(\"graduation_class_students\" as any)\r\n            .select(\"*\")\r\n            .eq(\"class_id\", classId)\r\n            .order(\"name\");\r\n        if (error) throw error;\r\n        return data as unknown as GraduationStudent[];\r\n    },\r\n\r\n    async createStudent(student: { class_id: string; name: string }): Promise<GraduationStudent> {\r\n        const { data, error } = await supabase\r\n            .from(\"graduation_class_students\" as any)\r\n            .insert(student)\r\n            .select()\r\n            .single();\r\n        if (error) throw error;\r\n        return data as unknown as GraduationStudent;\r\n    },\r\n\r\n    async toggleStudentActivation(studentId: string, active: boolean): Promise<void> {\r\n        const { error } = await supabase\r\n            .from(\"graduation_class_students\" as any)\r\n            .update({ active })\r\n            .eq(\"id\", studentId);\r\n        if (error) throw error;\r\n    },\r\n\r\n    // Carnet Config\r\n    async getCurrentCarnetConfig(graduationId: string): Promise<GraduationCarnetConfig | null> {\r\n        const { data, error } = await supabase\r\n            .from(\"graduation_carnet_configs\" as any)\r\n            .select(\"*\")\r\n            .eq(\"graduation_id\", graduationId)\r\n            .order(\"version\", { ascending: false })\r\n            .limit(1)\r\n            .maybeSingle();\r\n        if (error) throw error;\r\n        return data as unknown as GraduationCarnetConfig;\r\n    },\r\n\r\n    async getCurrentConfig(graduationId: string): Promise<GraduationCarnetConfig | null> {\r\n        return this.getCurrentCarnetConfig(graduationId);\r\n    },\r\n\r\n    async createCarnetConfig(config: Omit<GraduationCarnetConfig, 'id' | 'version' | 'created_at' | 'is_current'>): Promise<GraduationCarnetConfig> {\r\n        const current = await this.getCurrentCarnetConfig(config.graduation_id);\r\n        const version = current ? current.version + 1 : 1;\r\n\r\n        // Inactivate current if exists\r\n        if (current) {\r\n            await supabase\r\n                .from(\"graduation_carnet_configs\" as any)\r\n                .update({ is_current: false })\r\n                .eq(\"id\", current.id);\r\n        }\r\n\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n\r\n        const { data, error } = await supabase\r\n            .from(\"graduation_carnet_configs\" as any)\r\n            .insert({ ...config, version, is_current: true, created_by: user?.id })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return data as unknown as GraduationCarnetConfig;\r\n    },\r\n\r\n    async createNewConfigVersion(graduationId: string, config: any): Promise<GraduationCarnetConfig> {\r\n        return this.createCarnetConfig({ ...config, graduation_id: graduationId });\r\n    },\r\n\r\n    // Installments\r\n    async getInstallments(studentId: string): Promise<GraduationInstallment[]> {\r\n        const { data, error } = await supabase\r\n            .from(\"graduation_installments\" as any)\r\n            .select(\"*\")\r\n            .eq(\"student_id\", studentId)\r\n            .order(\"installment_number\");\r\n        if (error) throw error;\r\n        return data as unknown as GraduationInstallment[];\r\n    },\r\n\r\n    async generateCarnetForStudent(studentId: string): Promise<void> {\r\n        // 1. Find student\r\n        const { data: student, error: studentError } = await supabase\r\n            .from(\"graduation_class_students\" as any)\r\n            .select(\"class_id\")\r\n            .eq(\"id\", studentId)\r\n            .single();\r\n        if (studentError) throw studentError;\r\n\r\n        // 2. Find graduation from class\r\n        const { data: classData, error: classError } = await supabase\r\n            .from(\"graduation_classes\" as any)\r\n            .select(\"graduation_id\")\r\n            .eq(\"id\", (student as any).class_id)\r\n            .single();\r\n        if (classError) throw classError;\r\n\r\n        const graduationId = (classData as any).graduation_id;\r\n        const config = await this.getCurrentCarnetConfig(graduationId);\r\n        if (!config) throw new Error(\"Configura├º├úo de carn├¬ n├úo encontrada para esta formatura.\");\r\n\r\n        // Check if carnet already exists\r\n        const { count, error: countError } = await supabase\r\n            .from(\"graduation_installments\" as any)\r\n            .select(\"*\", { count: \"exact\", head: true })\r\n            .eq(\"student_id\", studentId);\r\n        if (countError) throw countError;\r\n        if (count && count > 0) return; // Already generated\r\n\r\n        // Generate installments\r\n        const installments = [];\r\n        const baseDate = new Date(2026, 0, 1); // Start of 2026\r\n\r\n        for (let i = 1; i <= config.installments_count; i++) {\r\n            const dueDate = setDate(addMonths(baseDate, i - 1), config.due_day);\r\n            installments.push({\r\n                student_id: studentId,\r\n                carnet_config_id: config.id,\r\n                installment_number: i,\r\n                value: config.installment_value,\r\n                due_date: format(dueDate, 'yyyy-MM-dd'),\r\n                status: 'EM_ABERTO'\r\n            });\r\n        }\r\n\r\n        const { error: insertError } = await supabase\r\n            .from(\"graduation_installments\" as any)\r\n            .insert(installments);\r\n        if (insertError) throw insertError;\r\n    },\r\n\r\n    async updateInstallmentStatus(\r\n        installmentId: string,\r\n        status: GraduationInstallmentStatus,\r\n        params?: { paid_at?: string; pay_method?: PaymentMethod; notes?: string }\r\n    ): Promise<void> {\r\n        const updateData: any = { status };\r\n        if (status === 'PAGO') {\r\n            updateData.paid_at = params?.paid_at || new Date().toISOString();\r\n            updateData.pay_method = params?.pay_method || 'cash';\r\n        } else {\r\n            updateData.paid_at = null;\r\n            updateData.pay_method = null;\r\n        }\r\n        if (params?.notes !== undefined) updateData.notes = params.notes;\r\n\r\n        const { error } = await supabase\r\n            .from(\"graduation_installments\" as any)\r\n            .update(updateData)\r\n            .eq(\"id\", installmentId);\r\n        if (error) throw error;\r\n    },\r\n\r\n    async bulkUpdateInstallmentStatus(\r\n        classId: string,\r\n        installmentNumber: number,\r\n        status: GraduationInstallmentStatus\r\n    ): Promise<void> {\r\n        // 1. Get all student IDs for the class\r\n        const students = await this.getStudentsByClass(classId);\r\n        const studentIds = students.map(s => s.id);\r\n\r\n        if (studentIds.length === 0) return;\r\n\r\n        const updateData: any = { status };\r\n        if (status === 'PAGO') {\r\n            updateData.paid_at = new Date().toISOString();\r\n            updateData.pay_method = 'cash';\r\n        } else {\r\n            updateData.paid_at = null;\r\n            updateData.pay_method = null;\r\n        }\r\n\r\n        const { error } = await supabase\r\n            .from(\"graduation_installments\" as any)\r\n            .update(updateData)\r\n            .in(\"student_id\", studentIds)\r\n            .eq(\"installment_number\", installmentNumber);\r\n\r\n        if (error) throw error;\r\n    },\r\n\r\n    // Extras & Expenses & Transfers\r\n\r\n\r\n    async registerExtraIncome(income: { graduation_id: string; class_id?: string; type: GraduationExtraType; gross_value: number; costs: number; notes?: string }): Promise<void> {\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        const { error } = await supabase\r\n            .from(\"graduation_extra_incomes\" as any)\r\n            .insert({ ...income, created_by: user?.id });\r\n        if (error) throw error;\r\n    },\r\n\r\n    async registerExpense(expense: { graduation_id: string; class_id?: string; description: string; value: number; pay_method: PaymentMethod; is_paid: boolean; notes?: string }): Promise<void> {\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        const { error } = await supabase\r\n            .from(\"graduation_expenses\" as any)\r\n            .insert({ ...expense, created_by: user?.id });\r\n        if (error) throw error;\r\n    },\r\n\r\n    // Consolidated\r\n    async getFinancialSummary(graduationId: string): Promise<GraduationFinancialSummary> {\r\n        // 1. Get all class IDs for this graduation\r\n        const { data: classes, error: classesError } = await supabase\r\n            .from(\"graduation_classes\" as any)\r\n            .select(\"id\")\r\n            .eq(\"graduation_id\", graduationId);\r\n\r\n        if (classesError) throw classesError;\r\n        const classIds = (classes as any[] || []).map(c => c.id);\r\n\r\n        if (classIds.length === 0) {\r\n            return {\r\n                totalPaid: 0, totalExtras: 0, totalExpenses: 0, balanceInHand: 0,\r\n                treasuryBalance: 0, treasuryBank: 0, treasuryCash: 0, pendingFromClasses: 0\r\n            };\r\n        }\r\n\r\n        // 2. Get all student IDs for these classes\r\n        const { data: students, error: studentsError } = await supabase\r\n            .from(\"graduation_class_students\" as any)\r\n            .select(\"id\")\r\n            .in(\"class_id\", classIds);\r\n\r\n        if (studentsError) throw studentsError;\r\n        const studentIds = (students as any[] || []).map(s => s.id);\r\n\r\n        if (studentIds.length === 0) {\r\n            return {\r\n                totalPaid: 0, totalExtras: 0, totalExpenses: 0, balanceInHand: 0,\r\n                treasuryBalance: 0, treasuryBank: 0, treasuryCash: 0, pendingFromClasses: 0\r\n            };\r\n        }\r\n\r\n        // 3. Get total paid installments for these students\r\n        const { data: installments, error: installmentsError } = await supabase\r\n            .from(\"graduation_installments\" as any)\r\n            .select(\"value\")\r\n            .eq(\"status\", \"PAGO\")\r\n            .in(\"student_id\", studentIds);\r\n\r\n        if (installmentsError) throw installmentsError;\r\n        const totalPaid = (installments as any[] || []).reduce((acc, curr) => acc + Number(curr.value), 0);\r\n\r\n        // Total Extras\r\n        const { data: extras, error: extrasError } = await supabase\r\n            .from(\"graduation_extra_incomes\" as any)\r\n            .select(\"gross_value, costs\")\r\n            .eq(\"graduation_id\", graduationId);\r\n\r\n        if (extrasError) throw extrasError;\r\n        const totalExtras = (extras as any[] || []).reduce((acc, curr) => acc + (Number(curr.gross_value) - Number(curr.costs)), 0);\r\n\r\n        // Total Expenses Paid\r\n        const { data: expenses, error: expensesError } = await supabase\r\n            .from(\"graduation_expenses\" as any)\r\n            .select(\"value\")\r\n            .eq(\"graduation_id\", graduationId)\r\n            .eq(\"is_paid\", true);\r\n\r\n        if (expensesError) throw expensesError;\r\n        const totalExpenses = (expenses as any[] || []).reduce((acc, curr) => acc + Number(curr.value), 0);\r\n\r\n\r\n\r\n        // Treasury Summary (Custodian)\r\n        const { data: treasuryEntries, error: treasuryError } = await supabase\r\n            .from(\"graduation_treasury_entries\" as any)\r\n            .select(\"type, location, value\")\r\n            .eq(\"graduation_id\", graduationId);\r\n\r\n        if (treasuryError) throw treasuryError;\r\n\r\n        let treasuryBank = 0;\r\n        let treasuryCash = 0;\r\n        let totalReceivedByCustodian = 0;\r\n\r\n        (treasuryEntries as any[] || []).forEach(entry => {\r\n            const val = Number(entry.value);\r\n            if (entry.location === 'CONTA') treasuryBank += val;\r\n            if (entry.location === 'ESPECIE') treasuryCash += val;\r\n            if (entry.type === 'RECEBIMENTO_TURMA') totalReceivedByCustodian += val;\r\n        });\r\n\r\n        const treasuryBalance = treasuryBank + treasuryCash;\r\n        const pendingFromClasses = totalPaid - totalReceivedByCustodian;\r\n        const balanceInHand = (totalPaid + totalExtras) - totalExpenses;\r\n\r\n        return {\r\n            totalPaid,\r\n            totalExtras,\r\n            totalExpenses,\r\n            balanceInHand,\r\n            treasuryBalance,\r\n            treasuryBank,\r\n            treasuryCash,\r\n            pendingFromClasses\r\n        };\r\n    },\r\n\r\n    async registerTreasuryEntry(entry: Omit<GraduationTreasuryEntry, 'id' | 'created_at'>): Promise<void> {\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        const { error } = await supabase\r\n            .from(\"graduation_treasury_entries\" as any)\r\n            .insert({ ...entry, created_by: user?.id });\r\n        if (error) throw error;\r\n    },\r\n\r\n    async getTreasuryEntries(graduationId: string): Promise<GraduationTreasuryEntry[]> {\r\n        const { data, error } = await supabase\r\n            .from(\"graduation_treasury_entries\" as any)\r\n            .select(\"*\")\r\n            .eq(\"graduation_id\", graduationId)\r\n            .order(\"date\", { ascending: false });\r\n        if (error) throw error;\r\n        return data as unknown as GraduationTreasuryEntry[];\r\n    },\r\n\r\n    async importStudentsFromExcel(classId: string, file: File): Promise<{ count: number }> {\r\n        const workbook = new ExcelJS.Workbook();\r\n        const arrayBuffer = await file.arrayBuffer();\r\n        await workbook.xlsx.load(arrayBuffer);\r\n\r\n        const worksheet = workbook.getWorksheet(1);\r\n        const names: string[] = [];\r\n\r\n        if (worksheet) {\r\n            worksheet.eachRow((row, rowNumber) => {\r\n                // Skip header if it looks like one (optional, but let's assume names are in column 1)\r\n                const value = row.getCell(1).value;\r\n                if (value && typeof value === 'string' && rowNumber > 1) {\r\n                    names.push(value.trim());\r\n                } else if (value && typeof value === 'string' && rowNumber === 1 && !value.toLowerCase().includes('nome')) {\r\n                    // If row 1 is not a header \"Nome\", include it\r\n                    names.push(value.trim());\r\n                }\r\n            });\r\n        }\r\n\r\n        if (names.length === 0) throw new Error(\"Nenhum nome de aluno encontrado na primeira coluna do Excel.\");\r\n\r\n        let count = 0;\r\n        for (const name of names) {\r\n            try {\r\n                const student = await this.createStudent({ class_id: classId, name });\r\n                await this.generateCarnetForStudent(student.id);\r\n                count++;\r\n            } catch (err) {\r\n                console.error(`Erro ao importar ${name}:`, err);\r\n            }\r\n        }\r\n\r\n        return { count };\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\services\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\services\\studentService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[404,407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[404,407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[645,648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[645,648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1103,1106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1103,1106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1434,1437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1434,1437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2223,2226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2223,2226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2450,2453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2450,2453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2614,2617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2614,2617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2655,2658],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2655,2658],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2703,2706],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2703,2706],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2751,2754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2751,2754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2814,2817],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2814,2817],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3005,3008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3005,3008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { GraduationStudent } from \"@/features/graduations/services/types\";\r\nimport { formatDateString } from \"@/shared/lib/date-utils\";\r\n\r\nexport const studentService = {\r\n    async listStudents(classId: string): Promise<GraduationStudent[]> {\r\n        const { data, error } = await supabase\r\n            .from('graduation_class_students' as any)\r\n            .select('id, class_id, full_name:name, guardian_name, active')\r\n            .eq('class_id', classId)\r\n            .eq('active', true)\r\n            .order('name');\r\n\r\n        if (error) throw error;\r\n        return (data as any[]).map(d => ({\r\n            id: d.id,\r\n            class_id: d.class_id,\r\n            full_name: d.full_name,\r\n            guardian_name: d.guardian_name || undefined,\r\n            active: d.active\r\n        }));\r\n    },\r\n\r\n    async getStudentsProgress(classId: string): Promise<Record<string, { paid: number; total: number; hasOverdue: boolean }>> {\r\n        const { data, error } = await supabase\r\n            .from('graduation_student_obligations' as any)\r\n            .select('student_id, status, due_date, kind')\r\n            .eq('class_id', classId);\r\n\r\n        if (error) throw error;\r\n\r\n        const progress: Record<string, { paid: number; total: number; hasOverdue: boolean }> = {};\r\n        const today = formatDateString(new Date());\r\n\r\n        (data || []).forEach((obs: any) => {\r\n            if (!progress[obs.student_id]) {\r\n                progress[obs.student_id] = { paid: 0, total: 0, hasOverdue: false };\r\n            }\r\n\r\n            if (obs.kind === 'MENSALIDADE') {\r\n                progress[obs.student_id].total++;\r\n                if (obs.status === 'PAGO') {\r\n                    progress[obs.student_id].paid++;\r\n                }\r\n            }\r\n\r\n            // Check for overdue (any kind)\r\n            if (obs.status === 'PENDENTE' && obs.due_date && obs.due_date < today) {\r\n                progress[obs.student_id].hasOverdue = true;\r\n            }\r\n        });\r\n        return progress;\r\n    },\r\n\r\n    async createStudent(classId: string, fullName: string, guardianName?: string): Promise<GraduationStudent> {\r\n        const insertData: any = { class_id: classId, name: fullName, active: true };\r\n        if (guardianName) insertData.guardian_name = guardianName;\r\n\r\n        const { data, error } = await supabase\r\n            .from('graduation_class_students' as any)\r\n            .insert(insertData)\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        return {\r\n            id: (data as any).id,\r\n            class_id: (data as any).class_id,\r\n            full_name: (data as any).name,\r\n            guardian_name: (data as any).guardian_name || undefined,\r\n            active: (data as any).active\r\n        };\r\n    },\r\n\r\n    async inactivateStudent(studentId: string): Promise<void> {\r\n        const { error } = await supabase\r\n            .from('graduation_class_students' as any)\r\n            .update({ active: false })\r\n            .eq('id', studentId);\r\n        if (error) throw error;\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\graduations\\services\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\merchants\\hooks\\__tests__\\use-merchants.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":49,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":49,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1451,1454],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1451,1454],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1526,1529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1526,1529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2902,2905],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2902,2905],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3574,3577],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3574,3577],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3664,3667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3664,3667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { renderHook } from \"@testing-library/react\";\r\nimport { waitFor } from \"@testing-library/dom\";\r\nimport { useMerchants } from \"@/features/merchants/hooks/use-merchants\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/features/auth/contexts/AuthContext\";\r\nimport { useDemoData } from \"@/demo/useDemoData\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\nimport React from \"react\";\r\n\r\n// Mock dependencies\r\nvi.mock(\"@/integrations/supabase/client\", () => ({\r\n    supabase: {\r\n        from: vi.fn()\r\n    }\r\n}));\r\n\r\nvi.mock(\"@/features/auth/contexts/AuthContext\", () => ({\r\n    useAuth: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/demo/useDemoData\", () => ({\r\n    useDemoData: vi.fn()\r\n}));\r\n\r\nvi.mock(\"sonner\", () => ({\r\n    toast: {\r\n        success: vi.fn(),\r\n        error: vi.fn()\r\n    }\r\n}));\r\n\r\nconst createWrapper = () => {\r\n    const queryClient = new QueryClient({\r\n        defaultOptions: {\r\n            queries: {\r\n                retry: false,\r\n            },\r\n        },\r\n    });\r\n    return function Wrapper({ children }: { children: React.ReactNode }) {\r\n        return <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>;\r\n    }\r\n};\r\n\r\ndescribe(\"useMerchants hook\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n        vi.mocked(useAuth).mockReturnValue({ isDemo: false } as any);\r\n        vi.mocked(useDemoData).mockReturnValue({ merchants: [] } as any);\r\n    });\r\n\r\n    it(\"should fetch merchants and merge with ledger balances\", async () => {\r\n        const mockMerchants = [\r\n            { id: \"m1\", name: \"Merchant 1\", balance: 10, active: true },\r\n            { id: \"m2\", name: \"Merchant 2\", balance: 20, active: true },\r\n        ];\r\n        const mockBalances = [\r\n            { account_id: \"m1\", balance_cents: 10000 },\r\n        ];\r\n\r\n        // Mock first call: Fetch Merchants\r\n        const mockMerchantsQuery = {\r\n            select: vi.fn().mockReturnThis(),\r\n            order: vi.fn().mockReturnThis(),\r\n            eq: vi.fn().mockReturnThis(),\r\n            then: vi.fn((resolve) => resolve({ data: mockMerchants, error: null }))\r\n        };\r\n\r\n        // Mock second call: Fetch Balances\r\n        const mockBalancesQuery = {\r\n            select: vi.fn().mockReturnThis(),\r\n            in: vi.fn().mockReturnThis(),\r\n            then: vi.fn((resolve) => resolve({ data: mockBalances, error: null }))\r\n        };\r\n\r\n        vi.mocked(supabase.from).mockImplementation(((table: string) => {\r\n            if (table === \"merchants\") return mockMerchantsQuery as unknown as ReturnType<typeof supabase.from>;\r\n            if (table === \"ledger_balances\") return mockBalancesQuery as unknown as ReturnType<typeof supabase.from>;\r\n            return null as unknown as ReturnType<typeof supabase.from>;\r\n        }) as any);\r\n\r\n        const { result } = renderHook(() => useMerchants(), {\r\n            wrapper: createWrapper(),\r\n        });\r\n\r\n        await waitFor(() => expect(result.current.isSuccess).toBe(true));\r\n\r\n        expect(result.current.data).toHaveLength(2);\r\n        expect(result.current.data![0].balance).toBe(100); // Merged from ledger: 10000 / 100 = 100\r\n        expect(result.current.data![1].balance).toBe(20);  // Fallback to table balance\r\n    });\r\n\r\n    it(\"should return demo data when isDemo is true\", () => {\r\n        const mockDemoMerchants = [{ id: \"d1\", name: \"Demo Merchant\", active: true }];\r\n        vi.mocked(useAuth).mockReturnValue({ isDemo: true } as any);\r\n        vi.mocked(useDemoData).mockReturnValue({ merchants: mockDemoMerchants } as any);\r\n\r\n        const { result } = renderHook(() => useMerchants(), {\r\n            wrapper: createWrapper(),\r\n        });\r\n\r\n        expect(result.current.data).toEqual(mockDemoMerchants);\r\n        expect(supabase.from).not.toHaveBeenCalled();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\merchants\\hooks\\use-merchants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\merchants\\services\\merchantService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\components\\AjustarSaldoDialog.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'state.valor'. Either include it or remove the dependency array.","line":90,"column":8,"nodeType":"ArrayExpression","endLine":90,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [state.accountId, currentBalance, setValor, state.valor]","fix":{"range":[2844,2887],"text":"[state.accountId, currentBalance, setValor, state.valor]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from \"@/shared/ui/dialog\";\r\nimport {\r\n    AlertDialog,\r\n    AlertDialogAction,\r\n    AlertDialogCancel,\r\n    AlertDialogContent,\r\n    AlertDialogDescription,\r\n    AlertDialogFooter,\r\n    AlertDialogHeader,\r\n    AlertDialogTitle,\r\n    AlertDialogTrigger,\r\n} from \"@/shared/ui/alert-dialog\";\r\nimport { Button } from \"@/shared/ui/button\";\r\nimport { Label } from \"@/shared/ui/label\";\r\nimport { Input } from \"@/shared/ui/input\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/shared/ui/select\";\r\nimport { CurrencyInput } from \"@/shared/components/forms/CurrencyInput\";\r\nimport { DateInput } from \"@/shared/components/forms/DateInput\";\r\nimport { cleanAccountDisplayName } from \"@/shared/lib/account-display\";\r\nimport { sortByAccountOrder } from \"@/shared/lib/constants\";\r\nimport { formatCurrencyBRL } from \"@/shared/lib/currency\";\r\nimport { Account } from \"@/types\";\r\nimport { useState, useEffect } from \"react\";\r\n\r\n\r\ninterface AjustarSaldoDialogProps {\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    state: {\r\n        date: string;\r\n        accountId: string;\r\n        valor: number;\r\n        motivo: string;\r\n        obs: string;\r\n    };\r\n    setters: {\r\n        setDate: (v: string) => void;\r\n        setAccountId: (v: string) => void;\r\n        setValor: (v: number) => void;\r\n        setMotivo: (v: string) => void;\r\n        setObs: (v: string) => void;\r\n    };\r\n    accounts: Account[];\r\n    onSubmit: () => Promise<boolean>;\r\n    isLoading: boolean;\r\n}\r\n\r\nexport function AjustarSaldoDialog({\r\n    open,\r\n    onOpenChange,\r\n    state,\r\n    setters,\r\n    accounts,\r\n    onSubmit,\r\n    isLoading,\r\n}: AjustarSaldoDialogProps) {\r\n    const { setDate, setAccountId, setValor, setMotivo, setObs } = setters;\r\n    const selectedAccount = accounts.find(a => a.id === state.accountId);\r\n    const currentBalance = selectedAccount?.balance || 0;\r\n    const [confirmOpen, setConfirmOpen] = useState(false);\r\n\r\n    /**\r\n     * Fonte de verdade local para evitar disputa entre:\r\n     * - state.valor (controlado pelo pai)\r\n     * - valor digitado/c├ílculo instant├óneo no di├ílogo\r\n     *\r\n     * Isso ajuda a evitar ÔÇ£voltar valorÔÇØ enquanto o usu├írio digita e reduz flakiness de teste.\r\n     */\r\n    const [mode, setMode] = useState<\"adjustment\" | \"finalBalance\" | null>(null);\r\n    const [adjustment, setAdjustment] = useState<number>(state.valor || 0);\r\n    const [finalBalance, setFinalBalance] = useState<number>(currentBalance + (state.valor || 0));\r\n\r\n    // Quando trocar a conta, reseta o di├ílogo de forma previs├¡vel\r\n    useEffect(() => {\r\n        setMode(null);\r\n        setAdjustment(0);\r\n        setFinalBalance(currentBalance);\r\n        if (state.valor !== 0) setValor(0);\r\n    }, [state.accountId, currentBalance, setValor]);\r\n\r\n    // Se o pai resetar valor enquanto n├úo h├í campo ativo, refletir aqui\r\n    useEffect(() => {\r\n        if (mode === null) {\r\n            const v = state.valor || 0;\r\n            setAdjustment(v);\r\n            setFinalBalance(currentBalance + v);\r\n        }\r\n    }, [state.valor, currentBalance, mode]);\r\n\r\n    const handleAdjustmentChange = (val: number) => {\r\n        setMode(val === 0 ? null : \"adjustment\");\r\n        setAdjustment(val);\r\n        setFinalBalance(currentBalance + val);\r\n        setValor(val);\r\n    };\r\n\r\n    const handleFinalBalanceChange = (val: number) => {\r\n        const delta = val - currentBalance;\r\n        setMode(delta === 0 ? null : \"finalBalance\");\r\n        setFinalBalance(val);\r\n        setAdjustment(delta);\r\n        setValor(delta);\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent\r\n                className=\"max-w-md w-[95vw]\"\r\n                onOpenAutoFocus={(e) => e.preventDefault()}\r\n            >\r\n                <DialogHeader>\r\n                    <DialogTitle>Ajustar Saldo da Conta</DialogTitle>\r\n                </DialogHeader>\r\n                <div className=\"space-y-4 pt-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"adj-date\">Data *</Label>\r\n                        <DateInput id=\"adj-date\" value={state.date} onChange={setDate} />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"adj-account\">Conta a Ajustar *</Label>\r\n                        <Select value={state.accountId} onValueChange={setAccountId}>\r\n                            <SelectTrigger id=\"adj-account\">\r\n                                <SelectValue placeholder=\"Selecione a conta\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                                {sortByAccountOrder(accounts).map((acc) => (\r\n                                    <SelectItem key={acc.id} value={acc.id}>\r\n                                        {cleanAccountDisplayName(acc.name)}\r\n                                    </SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                        {selectedAccount && (\r\n                            <p className=\"text-xs text-muted-foreground px-1\">\r\n                                Saldo Atual: <span className=\"font-semibold\">{formatCurrencyBRL(currentBalance)}</span>\r\n                            </p>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <Label className=\"text-sm font-medium\">Valores</Label>\r\n                        </div>\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"adj-amount\" className=\"text-xs text-muted-foreground\">Valor do Ajuste (R$)</Label>\r\n                                <CurrencyInput\r\n                                    id=\"adj-amount\"\r\n                                    value={adjustment}\r\n                                    onChange={handleAdjustmentChange}\r\n                                    placeholder=\"Ex: +10 ou -5\"\r\n                                    disabled={mode === \"finalBalance\"}\r\n                                />\r\n                                <p className=\"text-[10px] text-muted-foreground leading-tight\">\r\n                                    {mode === \"finalBalance\" ? \"Calculado\" : \"Somar ou subtrair\"}\r\n                                </p>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <Label htmlFor=\"adj-final\" className=\"text-xs text-muted-foreground\">Novo Saldo (R$)</Label>\r\n                                <CurrencyInput\r\n                                    id=\"adj-final\"\r\n                                    value={finalBalance}\r\n                                    onChange={handleFinalBalanceChange}\r\n                                    placeholder=\"Saldo desejado\"\r\n                                    disabled={mode === \"adjustment\"}\r\n                                />\r\n                                <p className=\"text-[10px] text-muted-foreground leading-tight\">\r\n                                    {mode === \"adjustment\" ? \"Calculado\" : \"Qual ser├í o saldo\"}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"adj-reason\">Motivo *</Label>\r\n                        <Input\r\n                            id=\"adj-reason\"\r\n                            value={state.motivo}\r\n                            onChange={(e) => setMotivo(e.target.value)}\r\n                            placeholder=\"Ex: Saldo inicial, corre├º├úo, etc\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label htmlFor=\"adj-obs\">Observa├º├úo</Label>\r\n                        <Input\r\n                            id=\"adj-obs\"\r\n                            value={state.obs}\r\n                            onChange={(e) => setObs(e.target.value)}\r\n                            placeholder=\"Informa├º├Áes adicionais\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"bg-amber-50 border border-amber-200 p-3 rounded-md\">\r\n                        <p className=\"text-xs text-amber-800\">\r\n                            <strong>Aten├º├úo:</strong> Ajustes de saldo s├úo lan├ºados como transa├º├Áes de corre├º├úo e afetam o saldo imediatamente.\r\n                        </p>\r\n                    </div>\r\n\r\n                    <AlertDialog open={confirmOpen} onOpenChange={setConfirmOpen}>\r\n                        <AlertDialogTrigger asChild>\r\n                            <Button\r\n                                className=\"w-full\"\r\n                                disabled={isLoading || !state.accountId || !state.motivo || state.motivo.length < 5 || adjustment === 0}\r\n                            >\r\n                                {isLoading ? \"Salvando...\" : \"Registrar Ajuste\"}\r\n                            </Button>\r\n                        </AlertDialogTrigger>\r\n                        <AlertDialogContent className=\"w-[95vw] max-w-md\">\r\n                            <AlertDialogHeader>\r\n                                <AlertDialogTitle>Confirmar Ajuste de Saldo?</AlertDialogTitle>\r\n                                <AlertDialogDescription>\r\n                                    Esta a├º├úo alterar├í o saldo de <strong>{selectedAccount ? cleanAccountDisplayName(selectedAccount.name) : \"\"}</strong> de {formatCurrencyBRL(currentBalance)} para <strong>{formatCurrencyBRL(finalBalance)}</strong>.\r\n                                    Esta opera├º├úo ser├í registrada na trilha de auditoria.\r\n                                </AlertDialogDescription>\r\n                            </AlertDialogHeader>\r\n                            <AlertDialogFooter>\r\n                                <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n                                <AlertDialogAction\r\n                                    onClick={async () => {\r\n                                        const success = await onSubmit();\r\n                                        if (success) onOpenChange(false);\r\n                                    }}\r\n                                    className=\"bg-warning text-warning-foreground hover:bg-warning/90\"\r\n                                >\r\n                                    Confirmar Ajuste\r\n                                </AlertDialogAction>\r\n                            </AlertDialogFooter>\r\n                        </AlertDialogContent>\r\n                    </AlertDialog>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\components\\AporteSaldoDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\components\\ConsumoSaldoDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\components\\EntradaRecursoDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\components\\GastoRecursoDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\components\\__tests__\\AjustarSaldoDialog.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\components\\__tests__\\AporteSaldoDialog.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[904,907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[904,907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2665,2668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2665,2668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2713,2716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2713,2716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2763,2766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2763,2766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3523,3526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3523,3526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3571,3574],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3571,3574],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3621,3624],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3621,3624],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4588,4591],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4588,4591],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4636,4639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4636,4639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4686,4689],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4686,4689],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":10,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { render, screen, fireEvent, waitFor } from \"@testing-library/react\";\r\nimport { AporteSaldoDialog } from \"@/features/recursos/components/AporteSaldoDialog\";\r\nimport React from \"react\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\nimport { transactionService } from \"@/features/transactions/services/transactionService\";\r\nimport { toast } from \"sonner\";\r\nimport { Account, Entity, Merchant } from \"@/types\";\r\n\r\n// Mock dependencies\r\nvi.mock(\"@/features/transactions/services/transactionService\", () => ({\r\n    transactionService: {\r\n        createLedgerTransaction: vi.fn(),\r\n    }\r\n}));\r\n\r\nvi.mock(\"sonner\", () => ({\r\n    toast: {\r\n        success: vi.fn(),\r\n        error: vi.fn(),\r\n    },\r\n}));\r\n\r\nvi.mock(\"@tanstack/react-query\", async (importOriginal) => {\r\n    const actual = await importOriginal<any>();\r\n    return {\r\n        ...actual,\r\n        useQueryClient: vi.fn(() => ({\r\n            invalidateQueries: vi.fn(),\r\n        })),\r\n    };\r\n});\r\n\r\nconst mockState = {\r\n    date: \"2024-01-01\",\r\n    origem: \"ASSOC\",\r\n    conta: \"acc1\",\r\n    merchant: \"m1\",\r\n    valor: 100,\r\n    descricao: \"Dep├│sito Teste\",\r\n    obs: \"Obs Teste\",\r\n    capitalCusteio: \"custeio\",\r\n};\r\n\r\nconst mockSetters = {\r\n    setDate: vi.fn(),\r\n    setOrigem: vi.fn(),\r\n    setAccount: vi.fn(),\r\n    setMerchant: vi.fn(),\r\n    setValor: vi.fn(),\r\n    setDescricao: vi.fn(),\r\n    setObs: vi.fn(),\r\n    setCapitalCusteio: vi.fn(),\r\n};\r\n\r\nconst mockEntities: Entity[] = [{ id: \"ent1\", name: \"Associa├º├úo\", type: \"associacao\", cnpj: \"\" }];\r\nconst mockAccounts: Account[] = [\r\n    {\r\n        id: \"acc1\",\r\n        name: \"Esp├®cie\",\r\n        entity_id: \"ent1\",\r\n        balance: 1000,\r\n        active: true,\r\n        type: \"cash\",\r\n        agency: \"\",\r\n        bank: \"\",\r\n        account_number: \"\"\r\n    }\r\n];\r\nconst mockMerchants: Merchant[] = [{ id: \"m1\", name: \"Mercado A\", balance: 50, active: true }];\r\n\r\nconst createWrapper = () => {\r\n    const queryClient = new QueryClient({ defaultOptions: { queries: { retry: false } } });\r\n    return ({ children }: { children: React.ReactNode }) => (\r\n        <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n    );\r\n};\r\n\r\ndescribe(\"AporteSaldoDialog component\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n    });\r\n\r\n    it(\"should render correctly when open\", () => {\r\n        render(\r\n            <AporteSaldoDialog\r\n                open={true}\r\n                onOpenChange={vi.fn()}\r\n                state={mockState}\r\n                setters={mockSetters}\r\n                entities={mockEntities as any}\r\n                accounts={mockAccounts as any}\r\n                merchants={mockMerchants as any}\r\n                onSubmit={vi.fn()}\r\n                isLoading={false}\r\n            />,\r\n            { wrapper: createWrapper() }\r\n        );\r\n\r\n        expect(screen.getByText(\"Aportar Saldo\")).toBeDefined();\r\n        expect(screen.getByText(\"Origem do Recurso *\")).toBeDefined();\r\n        expect(screen.getByDisplayValue(\"Dep├│sito Teste\")).toBeDefined();\r\n    });\r\n\r\n    it(\"should call createLedgerTransaction on submit\", async () => {\r\n        const onSubmit = vi.fn();\r\n        const onOpenChange = vi.fn();\r\n\r\n        render(\r\n            <AporteSaldoDialog\r\n                open={true}\r\n                onOpenChange={onOpenChange}\r\n                state={mockState}\r\n                setters={mockSetters}\r\n                entities={mockEntities as any}\r\n                accounts={mockAccounts as any}\r\n                merchants={mockMerchants as any}\r\n                onSubmit={onSubmit}\r\n                isLoading={false}\r\n            />,\r\n            { wrapper: createWrapper() }\r\n        );\r\n\r\n        const submitButton = screen.getByText(\"Registrar Aporte\");\r\n        fireEvent.click(submitButton);\r\n\r\n        await waitFor(() => {\r\n            expect(transactionService.createLedgerTransaction).toHaveBeenCalled();\r\n            expect(toast.success).toHaveBeenCalledWith(\"Aporte registrado.\");\r\n            expect(onSubmit).toHaveBeenCalled();\r\n            expect(onOpenChange).toHaveBeenCalledWith(false);\r\n        });\r\n    });\r\n\r\n    it(\"should disable submit button if description is too short\", () => {\r\n        const shortState = { ...mockState, descricao: \"abc\" };\r\n        render(\r\n            <AporteSaldoDialog\r\n                open={true}\r\n                onOpenChange={vi.fn()}\r\n                state={shortState}\r\n                setters={mockSetters}\r\n                entities={mockEntities as any}\r\n                accounts={mockAccounts as any}\r\n                merchants={mockMerchants as any}\r\n                onSubmit={vi.fn()}\r\n                isLoading={false}\r\n            />,\r\n            { wrapper: createWrapper() }\r\n        );\r\n\r\n        const submitButton = screen.getByText(\"Registrar Aporte\") as HTMLButtonElement;\r\n        expect(submitButton.disabled).toBe(true);\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\components\\__tests__\\ConsumoSaldoDialog.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1185,1188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1185,1188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { render, screen, fireEvent, waitFor } from \"@testing-library/react\";\r\nimport { ConsumoSaldoDialog } from \"@/features/recursos/components/ConsumoSaldoDialog\";\r\nimport React from \"react\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\nimport { transactionService } from \"@/features/transactions/services/transactionService\";\r\nimport { toast } from \"sonner\";\r\nimport { useEntities } from \"@/shared/hooks/use-accounts\";\r\nimport { Merchant } from \"@/types\";\r\n\r\n// Mock dependencies\r\nvi.mock(\"@/features/transactions/services/transactionService\", () => ({\r\n    transactionService: {\r\n        createLedgerTransaction: vi.fn(),\r\n    }\r\n}));\r\n\r\nvi.mock(\"sonner\", () => ({\r\n    toast: {\r\n        success: vi.fn(),\r\n        error: vi.fn(),\r\n        warning: vi.fn(),\r\n    },\r\n}));\r\n\r\nvi.mock(\"@/shared/hooks/use-accounts\", () => ({\r\n    useEntities: vi.fn(() => ({\r\n        data: [{ id: \"ent1\", name: \"Associa├º├úo\", type: \"associacao\", cnpj: \"\" }],\r\n        isLoading: false\r\n    })),\r\n}));\r\n\r\nvi.mock(\"@tanstack/react-query\", async (importOriginal) => {\r\n    const actual = await importOriginal<any>();\r\n    return {\r\n        ...actual,\r\n        useQueryClient: vi.fn(() => ({\r\n            invalidateQueries: vi.fn(),\r\n        })),\r\n    };\r\n});\r\n\r\nconst mockState = {\r\n    date: \"2024-01-01\",\r\n    merchant: \"m1\",\r\n    valor: 0,\r\n    descricao: \"\",\r\n    obs: \"Obs Teste\",\r\n};\r\n\r\nconst mockSetters = {\r\n    setDate: vi.fn(),\r\n    setMerchant: vi.fn(),\r\n    setValor: vi.fn(),\r\n    setDescricao: vi.fn(),\r\n    setObs: vi.fn(),\r\n};\r\n\r\nconst mockMerchants: Merchant[] = [{ id: \"m1\", name: \"Mercado A\", balance: 50, active: true }];\r\n\r\nconst createWrapper = () => {\r\n    const queryClient = new QueryClient({ defaultOptions: { queries: { retry: false } } });\r\n    return ({ children }: { children: React.ReactNode }) => (\r\n        <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n    );\r\n};\r\n\r\ndescribe(\"ConsumoSaldoDialog component\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n    });\r\n\r\n    it(\"should render correctly when open\", () => {\r\n        render(\r\n            <ConsumoSaldoDialog\r\n                open={true}\r\n                onOpenChange={vi.fn()}\r\n                state={mockState}\r\n                setters={mockSetters}\r\n                merchants={mockMerchants}\r\n                onSubmit={vi.fn()}\r\n                isLoading={false}\r\n            />,\r\n            { wrapper: createWrapper() }\r\n        );\r\n\r\n        expect(screen.getByText(\"Registrar Gastos\")).toBeDefined();\r\n        expect(screen.getByText(\"Estabelecimento *\")).toBeDefined();\r\n    });\r\n\r\n    it(\"should handle adding and removing batch items\", async () => {\r\n        render(\r\n            <ConsumoSaldoDialog\r\n                open={true}\r\n                onOpenChange={vi.fn()}\r\n                state={mockState}\r\n                setters={mockSetters}\r\n                merchants={mockMerchants}\r\n                onSubmit={vi.fn()}\r\n                isLoading={false}\r\n            />,\r\n            { wrapper: createWrapper() }\r\n        );\r\n\r\n        const addItemButton = screen.getByText(\"Item\");\r\n        fireEvent.click(addItemButton);\r\n\r\n        // Should have 2 items now (1 initial + 1 added)\r\n        expect(screen.getAllByLabelText(/Descri├º├úo \\*/i)).toHaveLength(2);\r\n\r\n        // Remove one\r\n        const removeButtons = screen.getAllByRole(\"button\").filter(b => b.className.includes(\"text-destructive\"));\r\n        fireEvent.click(removeButtons[0]);\r\n\r\n        expect(screen.getAllByLabelText(/Descri├º├úo \\*/i)).toHaveLength(1);\r\n    });\r\n\r\n    it(\"should call createLedgerTransaction for valid items on submit\", async () => {\r\n        const onOpenChange = vi.fn();\r\n\r\n        render(\r\n            <ConsumoSaldoDialog\r\n                open={true}\r\n                onOpenChange={onOpenChange}\r\n                state={{ ...mockState, merchant: \"m1\" }}\r\n                setters={mockSetters}\r\n                merchants={mockMerchants}\r\n                onSubmit={vi.fn()}\r\n                isLoading={false}\r\n            />,\r\n            { wrapper: createWrapper() }\r\n        );\r\n\r\n        // Fill one item\r\n        const descInputs = screen.getAllByPlaceholderText(\"Ex: Produto X\");\r\n        const amountInputs = screen.getAllByPlaceholderText(\"0,00\"); // CurrencyInput placeholder\r\n\r\n        fireEvent.change(descInputs[0], { target: { value: \"Item 1\" } });\r\n        // CurrencyInput handling is indirect. \r\n        // In the mock state of the component, it uses batchItems.\r\n        // Since we are mocking the whole component, we need to check if fireEvent works on inputs.\r\n\r\n        // Actually, the component uses internal state for batchItems.\r\n        // To test it, we need to interact with the real inputs.\r\n        fireEvent.change(amountInputs[0], { target: { value: \"10\" } }); // Should update to 10 via CurrencyInput\r\n\r\n        const submitButton = screen.getByText(\"Lan├ºar Gastos\");\r\n        fireEvent.click(submitButton);\r\n\r\n        await waitFor(() => {\r\n            expect(transactionService.createLedgerTransaction).toHaveBeenCalled();\r\n            expect(toast.success).toHaveBeenCalledWith(expect.stringContaining(\"consumos registrados\"));\r\n            expect(onOpenChange).toHaveBeenCalledWith(false);\r\n        });\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\components\\__tests__\\EntradaRecursoDialog.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":134,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4239,4242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4239,4242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4287,4290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4287,4290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { render, screen, fireEvent, waitFor } from \"@testing-library/react\";\r\nimport { EntradaRecursoDialog } from \"@/features/recursos/components/EntradaRecursoDialog\";\r\nimport React from \"react\";\r\nimport { Account, Entity } from \"@/types\";\r\n\r\nconst mockEntities: Entity[] = [\r\n    { id: \"e1\", name: \"UE Test\", type: \"ue\", cnpj: \"\" },\r\n    { id: \"e2\", name: \"Associa├º├úo\", type: \"associacao\", cnpj: \"\" }\r\n];\r\n\r\nconst mockAccounts: Account[] = [\r\n    {\r\n        id: \"a1\",\r\n        name: \"Conta 1\",\r\n        entity_id: \"e1\",\r\n        active: true,\r\n        balance: 1000,\r\n        type: \"bank\",\r\n        agency: \"\",\r\n        bank: \"\",\r\n        account_number: \"\"\r\n    },\r\n];\r\n\r\nconst mockState = {\r\n    date: \"2024-01-01\",\r\n    entityId: \"e1\",\r\n    accountId: \"a1\",\r\n    amount: 100,\r\n    description: \"Repasse PDDE Teste\",\r\n    notes: \"Notes Test\",\r\n};\r\n\r\nconst mockSetters = {\r\n    setDate: vi.fn(),\r\n    setEntityId: vi.fn(),\r\n    setAccountId: vi.fn(),\r\n    setAmount: vi.fn(),\r\n    setDescription: vi.fn(),\r\n    setNotes: vi.fn(),\r\n};\r\n\r\ndescribe(\"EntradaRecursoDialog component\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n    });\r\n\r\n    it(\"should render correctly when open\", () => {\r\n        render(\r\n            <EntradaRecursoDialog\r\n                open={true}\r\n                onOpenChange={vi.fn()}\r\n                state={mockState}\r\n                setters={mockSetters}\r\n                entities={mockEntities}\r\n                accounts={mockAccounts}\r\n                onSubmit={vi.fn().mockResolvedValue(true)}\r\n                isLoading={false}\r\n            />\r\n        );\r\n\r\n        expect(screen.getByText(\"Nova Entrada de Recurso\")).toBeDefined();\r\n        expect(screen.getByText(\"Entidade *\")).toBeDefined();\r\n        expect(screen.getByText(\"Conta *\")).toBeDefined();\r\n    });\r\n\r\n    it(\"should call onSubmit when clicking 'Registrar Entrada'\", async () => {\r\n        const onSubmit = vi.fn().mockResolvedValue(true);\r\n        const onOpenChange = vi.fn();\r\n\r\n        render(\r\n            <EntradaRecursoDialog\r\n                open={true}\r\n                onOpenChange={onOpenChange}\r\n                state={mockState}\r\n                setters={mockSetters}\r\n                entities={mockEntities}\r\n                accounts={mockAccounts}\r\n                onSubmit={onSubmit}\r\n                isLoading={false}\r\n            />\r\n        );\r\n\r\n        const submitButton = screen.getByText(\"Registrar Entrada\");\r\n        fireEvent.click(submitButton);\r\n\r\n        await waitFor(() => {\r\n            expect(onSubmit).toHaveBeenCalled();\r\n            expect(onOpenChange).toHaveBeenCalledWith(false);\r\n        });\r\n    });\r\n\r\n    it(\"should disable submit button if description is too short\", () => {\r\n        render(\r\n            <EntradaRecursoDialog\r\n                open={true}\r\n                onOpenChange={vi.fn()}\r\n                state={{ ...mockState, description: \"PDDE\" }} // 4 chars, needs 5\r\n                setters={mockSetters}\r\n                entities={mockEntities}\r\n                accounts={mockAccounts}\r\n                onSubmit={vi.fn().mockResolvedValue(true)}\r\n                isLoading={false}\r\n            />\r\n        );\r\n\r\n        const submitButton = screen.getByText(\"Registrar Entrada\");\r\n        expect(submitButton).toBeDisabled();\r\n    });\r\n\r\n    it(\"should disable submit button if entity or account is missing\", () => {\r\n        const { rerender } = render(\r\n            <EntradaRecursoDialog\r\n                open={true}\r\n                onOpenChange={vi.fn()}\r\n                state={{ ...mockState, entityId: \"\" }}\r\n                setters={mockSetters}\r\n                entities={mockEntities}\r\n                accounts={mockAccounts}\r\n                onSubmit={vi.fn().mockResolvedValue(true)}\r\n                isLoading={false}\r\n            />\r\n        );\r\n\r\n        expect(screen.getByText(\"Registrar Entrada\")).toBeDisabled();\r\n\r\n        rerender(\r\n            <EntradaRecursoDialog\r\n                open={true}\r\n                onOpenChange={vi.fn()}\r\n                state={{ ...mockState, accountId: \"\" }}\r\n                setters={mockSetters}\r\n                entities={mockEntities as any}\r\n                accounts={mockAccounts as any}\r\n                onSubmit={vi.fn().mockResolvedValue(true)}\r\n                isLoading={false}\r\n            />\r\n        );\r\n\r\n        expect(screen.getByText(\"Registrar Entrada\")).toBeDisabled();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\components\\__tests__\\GastoRecursoDialog.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[879,882],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[879,882],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1134,1137],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1134,1137],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2864,2867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2864,2867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3678,3681],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3678,3681],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3726,3729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3726,3729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3776,3779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3776,3779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4639,4642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4639,4642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4974,4977],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4974,4977],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":184,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6426,6429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6426,6429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":185,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6474,6477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6474,6477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6524,6527],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6524,6527],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { render, screen, fireEvent, waitFor } from \"@testing-library/react\";\r\nimport { GastoRecursoDialog } from \"@/features/recursos/components/GastoRecursoDialog\";\r\nimport React from \"react\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\nimport { transactionService } from \"@/features/transactions/services/transactionService\";\r\nimport { toast } from \"sonner\";\r\n\r\n// Mock dependencies\r\nvi.mock(\"@/features/transactions/services/transactionService\", () => ({\r\n    transactionService: {\r\n        createLedgerTransaction: vi.fn(),\r\n    }\r\n}));\r\n\r\nvi.mock(\"sonner\", () => ({\r\n    toast: {\r\n        success: vi.fn(),\r\n        error: vi.fn(),\r\n        warning: vi.fn(),\r\n    },\r\n}));\r\n\r\nvi.mock(\"@tanstack/react-query\", async (importOriginal) => {\r\n    const actual = await importOriginal<any>();\r\n    return {\r\n        ...actual,\r\n        useQueryClient: vi.fn(() => ({\r\n            invalidateQueries: vi.fn(),\r\n        })),\r\n    };\r\n});\r\n\r\n// Mock crypto for randomUUID\r\nif (typeof window !== 'undefined' && !window.crypto) {\r\n    (window as any).crypto = {\r\n        randomUUID: () => 'test-uuid-' + Math.random(),\r\n    };\r\n}\r\n\r\nconst mockState = {\r\n    date: \"2024-01-01\",\r\n    entityId: \"e1\",\r\n    accountId: \"a1\",\r\n    merchantId: \"m1\",\r\n    notes: \"Notes Test\",\r\n    capitalCusteio: \"capital\",\r\n};\r\n\r\nconst mockSetters = {\r\n    setDate: vi.fn(),\r\n    setEntityId: vi.fn(),\r\n    setAccountId: vi.fn(),\r\n    setMerchantId: vi.fn(),\r\n    setNotes: vi.fn(),\r\n    setCapitalCusteio: vi.fn(),\r\n};\r\n\r\nconst mockEntities = [\r\n    { id: \"e1\", name: \"UE Test\", type: \"ue\", cnpj: \"\" },\r\n    { id: \"e2\", name: \"Associa├º├úo\", type: \"associacao\", cnpj: \"\" }\r\n];\r\n\r\nconst mockAccounts = [\r\n    { id: \"a1\", name: \"Conta 1\", entity_id: \"e1\", active: true, balance: 1000, type: \"bank\", agency: \"\", bank: \"\", account_number: \"\" },\r\n    { id: \"a2\", name: \"Conta 2\", entity_id: \"e1\", active: true, balance: 500, type: \"bank\", agency: \"\", bank: \"\", account_number: \"\" }\r\n];\r\n\r\nconst mockMerchants = [{ id: \"m1\", name: \"Mercado A\", active: true, balance: 0 }];\r\n\r\nconst createWrapper = () => {\r\n    const queryClient = new QueryClient({ defaultOptions: { queries: { retry: false } } });\r\n    return ({ children }: { children: React.ReactNode }) => (\r\n        <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n    );\r\n};\r\n\r\ndescribe(\"GastoRecursoDialog component\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n    });\r\n\r\n    it(\"should render correctly when open\", () => {\r\n        render(\r\n            <GastoRecursoDialog\r\n                open={true}\r\n                onOpenChange={vi.fn()}\r\n                state={mockState}\r\n                setters={mockSetters}\r\n                entities={mockEntities}\r\n                accounts={mockAccounts as any}\r\n                merchants={mockMerchants}\r\n                onSubmit={vi.fn().mockResolvedValue(true)}\r\n                isLoading={false}\r\n            />,\r\n            { wrapper: createWrapper() }\r\n        );\r\n\r\n        expect(screen.getByText(\"Registrar Gastos de Recurso\")).toBeDefined();\r\n        expect(screen.getByText(\"Entidade *\")).toBeDefined();\r\n        expect(screen.getByText(\"Conta *\")).toBeDefined();\r\n        expect(screen.getByText(\"Estabelecimento (Para) *\")).toBeDefined();\r\n    });\r\n\r\n    it(\"should handle adding and removing batch items\", async () => {\r\n        render(\r\n            <GastoRecursoDialog\r\n                open={true}\r\n                onOpenChange={vi.fn()}\r\n                state={mockState}\r\n                setters={mockSetters}\r\n                entities={mockEntities as any}\r\n                accounts={mockAccounts as any}\r\n                merchants={mockMerchants as any}\r\n                onSubmit={vi.fn().mockResolvedValue(true)}\r\n                isLoading={false}\r\n            />,\r\n            { wrapper: createWrapper() }\r\n        );\r\n\r\n        const addItemButton = screen.getByText(\"Item\");\r\n        fireEvent.click(addItemButton);\r\n\r\n        // Should have 2 items now (1 initial + 1 added)\r\n        expect(screen.getAllByLabelText(/Descri├º├úo \\*/i)).toHaveLength(2);\r\n\r\n        // Remove one\r\n        const removeButtons = screen.getAllByRole(\"button\").filter(b => b.className.includes(\"text-destructive\"));\r\n        fireEvent.click(removeButtons[0]);\r\n\r\n        expect(screen.getAllByLabelText(/Descri├º├úo \\*/i)).toHaveLength(1);\r\n    });\r\n\r\n    it(\"should call createLedgerTransaction for valid items on submit\", async () => {\r\n        const onOpenChange = vi.fn();\r\n        (transactionService.createLedgerTransaction as any).mockResolvedValue({ data: {}, error: null });\r\n\r\n        render(\r\n            <GastoRecursoDialog\r\n                open={true}\r\n                onOpenChange={onOpenChange}\r\n                state={mockState}\r\n                setters={mockSetters}\r\n                entities={mockEntities}\r\n                accounts={mockAccounts as any}\r\n                merchants={mockMerchants}\r\n                onSubmit={vi.fn().mockResolvedValue(true)}\r\n                isLoading={false}\r\n            />,\r\n            { wrapper: createWrapper() }\r\n        );\r\n\r\n        // Fill one item\r\n        const descInputs = screen.getAllByPlaceholderText(\"Ex: Produto X\");\r\n        const amountInputs = screen.getAllByPlaceholderText(\"0,00\");\r\n\r\n        fireEvent.change(descInputs[0], { target: { value: \"Item Teste\" } });\r\n        fireEvent.change(amountInputs[0], { target: { value: \"100,00\" } });\r\n\r\n        const submitButton = screen.getByText(\"Lan├ºar Gastos\");\r\n\r\n        // Ensure not disabled\r\n        expect(submitButton).not.toBeDisabled();\r\n\r\n        fireEvent.click(submitButton);\r\n\r\n        await waitFor(() => {\r\n            expect(transactionService.createLedgerTransaction).toHaveBeenCalled();\r\n        }, { timeout: 3000 });\r\n\r\n        await waitFor(() => {\r\n            expect(toast.success).toHaveBeenCalledWith(expect.stringContaining(\"gastos de recursos registrados\"));\r\n            expect(onOpenChange).toHaveBeenCalledWith(false);\r\n        });\r\n    });\r\n\r\n    it(\"should show alert when balance will be negative\", () => {\r\n        render(\r\n            <GastoRecursoDialog\r\n                open={true}\r\n                onOpenChange={vi.fn()}\r\n                state={{ ...mockState, accountId: \"a2\" }}\r\n                setters={mockSetters}\r\n                entities={mockEntities as any}\r\n                accounts={mockAccounts as any}\r\n                merchants={mockMerchants as any}\r\n                onSubmit={vi.fn().mockResolvedValue(true)}\r\n                isLoading={false}\r\n            />,\r\n            { wrapper: createWrapper() }\r\n        );\r\n\r\n        const amountInput = screen.getByPlaceholderText(\"0,00\");\r\n        fireEvent.change(amountInput, { target: { value: \"600,00\" } }); // Balance is 500\r\n\r\n        expect(screen.getByText(\"Esta opera├º├úo deixar├í o saldo da conta negativo.\")).toBeDefined();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\hooks\\__tests__\\use-saldos-actions.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\hooks\\use-saldos-actions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\pages\\ContadorDinheiroPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\pages\\RecursosPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\pages\\SaldosPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\pages\\__tests__\\RecursosPage.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1888,1891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1888,1891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { createMockQueryResult } from \"@/test/test-utils\";\r\nimport { render, screen } from \"@testing-library/react\";\r\nimport RecursosPage from \"@/features/recursos/pages/RecursosPage\";\r\nimport React from \"react\";\r\nimport { useEntitiesWithAccounts } from \"@/shared/hooks/use-accounts\";\r\nimport { useMerchants } from \"@/features/merchants/hooks/use-merchants\";\r\nimport { useRecursosTransactions } from \"@/features/transactions/hooks/use-entity-transactions\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\n\r\n// Mock hooks\r\nvi.mock(\"@/shared/hooks/use-accounts\", () => ({\r\n    useEntitiesWithAccounts: vi.fn(),\r\n    useCreateAccount: vi.fn(() => ({ mutateAsync: vi.fn() })),\r\n    useUpdateAccount: vi.fn(() => ({ mutateAsync: vi.fn() })),\r\n    useDeactivateAccount: vi.fn(() => ({ mutateAsync: vi.fn() })),\r\n    useActivateAccount: vi.fn(() => ({ mutateAsync: vi.fn() }))\r\n}));\r\n\r\nvi.mock(\"@/features/merchants/hooks/use-merchants\", () => ({\r\n    useMerchants: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/hooks/use-entity-transactions\", () => ({\r\n    useRecursosTransactions: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/hooks/use-transactions\", () => ({\r\n    useCreateTransaction: vi.fn(() => ({ mutateAsync: vi.fn() })),\r\n    useCreateResourceTransaction: vi.fn(() => ({ mutateAsync: vi.fn() })),\r\n    useVoidTransaction: vi.fn(() => ({\r\n        mutateAsync: vi.fn(),\r\n        isPending: false\r\n    }))\r\n}));\r\n\r\n// Mock Ledger\r\nvi.mock(\"@/domain/ledger\", () => ({\r\n    createLedgerTransaction: vi.fn()\r\n}));\r\n\r\n// Mock layout/components\r\nvi.mock(\"@/shared/components/DashboardLayout\", () => ({\r\n    DashboardLayout: ({ children }: { children: React.ReactNode }) => <div>{children}</div>\r\n}));\r\n\r\nvi.mock(\"@/shared/components/ActionCard\", () => ({\r\n    ActionCard: ({ title, onClick }: any) => <div onClick={onClick} data-testid=\"action-card\">{title}</div>\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/components/TransactionTable\", () => ({\r\n    TransactionTable: () => <div data-testid=\"transaction-table\">Mock Table</div>\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/components/TransactionExportActions\", () => ({\r\n    TransactionExportActions: () => <div>Mock Export</div>\r\n}));\r\n\r\n// Mock Dialogs\r\nvi.mock(\"@/features/recursos/components/EntradaRecursoDialog\", () => ({ EntradaRecursoDialog: () => <div>Mock Entrada</div> }));\r\nvi.mock(\"@/features/recursos/components/GastoRecursoDialog\", () => ({ GastoRecursoDialog: () => <div>Mock Gasto</div> }));\r\nvi.mock(\"@/shared/components/dialogs/AccountDialog\", () => ({ AccountDialog: () => <div>Mock Account Dialog</div> }));\r\n\r\nconst createWrapper = () => {\r\n    const queryClient = new QueryClient({\r\n        defaultOptions: { queries: { retry: false } },\r\n    });\r\n    return ({ children }: { children: React.ReactNode }) => (\r\n        <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n    );\r\n};\r\n\r\ndescribe(\"RecursosPage integration\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n\r\n        // Setup default mocks\r\n        vi.mocked(useEntitiesWithAccounts).mockReturnValue(createMockQueryResult({\r\n            entities: [\r\n                { id: \"ent-ue\", name: \"UE Test\", type: \"ue\", cnpj: \"000\" },\r\n                { id: \"ent-cx\", name: \"CX Test\", type: \"cx\", cnpj: \"000\" }\r\n            ],\r\n            accounts: [\r\n                { id: \"acc-pdde\", name: \"PDDE\", balance: 5000, entity_id: \"ent-ue\", active: true, type: \"bank\", agency: \"0001\", bank: \"BB\", account_number: \"111\" },\r\n                { id: \"acc-pnae\", name: \"PNAE\", balance: 3000, entity_id: \"ent-cx\", active: true, type: \"bank\", agency: \"0001\", bank: \"BB\", account_number: \"222\" }\r\n            ]\r\n        }));\r\n\r\n        vi.mocked(useMerchants).mockReturnValue(createMockQueryResult([]));\r\n\r\n        vi.mocked(useRecursosTransactions).mockReturnValue(createMockQueryResult([{\r\n            id: \"t1\", amount: 200, description: \"Recurso Teste\", created_at: new Date().toISOString(),\r\n            creator_name: \"User\", source_account_name: \"Source\", destination_account_name: \"Dest\",\r\n            merchant_name: \"Merch\", payment_method: \"cash\", shift: \"matutino\", created_by: \"user-id\",\r\n            transaction_date: \"2024-01-01\", type: \"income\", status: \"completed\",\r\n            account_id: \"acc-1\", entity_id: \"ent-ue\", category_id: \"cat-1\",\r\n            module: \"financeiro\", direction: \"in\", notes: \"\", source_account_id: \"acc-source\",\r\n            destination_account_id: \"acc-dest\", merchant_id: \"merch-1\", origin_fund: \"fund\",\r\n            parent_transaction_id: null\r\n        }]));\r\n    });\r\n\r\n    it(\"should render page header and entity columns\", async () => {\r\n        render(<RecursosPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Recursos (UE e CX)\")).toBeDefined();\r\n        expect(screen.getByText(\"Unidade Executora\")).toBeDefined();\r\n        expect(screen.getByText(\"Caixa Escolar\")).toBeDefined();\r\n    });\r\n\r\n    it(\"should render accounts with balances\", () => {\r\n        render(<RecursosPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"PDDE\")).toBeDefined();\r\n        expect(screen.getByText(\"PNAE\")).toBeDefined();\r\n        expect(screen.getByText(/5\\.000/)).toBeDefined();\r\n        expect(screen.getByText(/3\\.000/)).toBeDefined();\r\n    });\r\n\r\n    it(\"should render action cards for entry and expense\", () => {\r\n        render(<RecursosPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Entrada de Recurso\")).toBeDefined();\r\n        expect(screen.getByText(\"Gasto de Recurso\")).toBeDefined();\r\n    });\r\n\r\n    it(\"should render the transactions history table\", () => {\r\n        render(<RecursosPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Hist├│rico dos Recursos\")).toBeDefined();\r\n        expect(screen.getByTestId(\"transaction-table\")).toBeDefined();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\recursos\\pages\\__tests__\\SaldosPage.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":117,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":120,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4043,4046],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4043,4046],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4216,4219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4216,4219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { createMockQueryResult } from \"@/test/test-utils\";\r\nimport { render, screen } from \"@testing-library/react\";\r\nimport SaldosPage from \"@/features/recursos/pages/SaldosPage\";\r\nimport React from \"react\";\r\nimport { useMerchants } from \"@/features/merchants/hooks/use-merchants\";\r\nimport { useEntitiesWithAccounts, useEntities } from \"@/shared/hooks/use-accounts\";\r\nimport { useSaldosTransactions } from \"@/features/transactions/hooks/use-entity-transactions\";\r\nimport { useSaldosActions } from \"@/features/recursos/hooks/use-saldos-actions\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\n\r\n// Mock hooks\r\nvi.mock(\"@/features/merchants/hooks/use-merchants\", () => ({\r\n    useMerchants: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/shared/hooks/use-accounts\", () => ({\r\n    useEntitiesWithAccounts: vi.fn(),\r\n    useEntities: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/hooks/use-entity-transactions\", () => ({\r\n    useSaldosTransactions: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/hooks/use-transactions\", () => ({\r\n    useVoidTransaction: vi.fn(() => ({\r\n        mutateAsync: vi.fn()\r\n    }))\r\n}));\r\n\r\nvi.mock(\"@/features/recursos/hooks/use-saldos-actions\", () => ({\r\n    useSaldosActions: vi.fn()\r\n}));\r\n\r\n// Mock layout/components that might be complex\r\nvi.mock(\"@/shared/components/DashboardLayout\", () => ({\r\n    DashboardLayout: ({ children }: { children: React.ReactNode }) => <div>{children}</div>\r\n}));\r\n\r\nvi.mock(\"@/features/recursos/components/AporteSaldoDialog\", () => ({\r\n    AporteSaldoDialog: () => <div>Mock Aporte</div>\r\n}));\r\n\r\nvi.mock(\"@/features/recursos/components/ConsumoSaldoDialog\", () => ({\r\n    ConsumoSaldoDialog: () => <div>Mock Consumo</div>\r\n}));\r\n\r\nvi.mock(\"@/shared/components/ActionCard\", () => ({\r\n    ActionCard: () => <div>Mock Action Card</div>\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/components/TransactionExportActions\", () => ({\r\n    TransactionExportActions: () => <div>Mock Export</div>\r\n}));\r\n\r\n// Mock components that use complex libs (like Recharts which often breaks in JSDOM)\r\nvi.mock(\"@/features/transactions/components/TransactionTable\", () => ({\r\n    TransactionTable: () => <div data-testid=\"transaction-table\">Mock Table</div>\r\n}));\r\n\r\nconst createWrapper = () => {\r\n    const queryClient = new QueryClient({\r\n        defaultOptions: { queries: { retry: false } },\r\n    });\r\n    return ({ children }: { children: React.ReactNode }) => (\r\n        <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n    );\r\n};\r\n\r\ndescribe(\"SaldosPage integration\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n\r\n        // Setup default mocks\r\n        vi.mocked(useMerchants).mockReturnValue(createMockQueryResult([\r\n            { id: \"m1\", name: \"Merchant Test\", balance: 500, active: true }\r\n        ]));\r\n\r\n        vi.mocked(useEntitiesWithAccounts).mockReturnValue(createMockQueryResult({ entities: [], accounts: [] }));\r\n\r\n        vi.mocked(useEntities).mockReturnValue(createMockQueryResult([]));\r\n\r\n        vi.mocked(useSaldosTransactions).mockReturnValue(createMockQueryResult([{\r\n            id: \"t1\", amount: 100, description: \"Test Transaction\", created_at: new Date().toISOString(),\r\n            creator_name: \"User\", source_account_name: \"Source\", destination_account_name: \"Dest\",\r\n            merchant_name: \"Merch\", payment_method: \"cash\", shift: \"matutino\", created_by: \"user-id\",\r\n            transaction_date: \"2024-01-01\", type: \"expense\", status: \"completed\", account_id: \"acc-1\", entity_id: \"ent-1\",\r\n            category_id: \"cat-1\",\r\n            module: \"gasto\", direction: \"out\", notes: \"\", source_account_id: \"acc-source\",\r\n            destination_account_id: \"acc-dest\", merchant_id: \"merch-1\", origin_fund: \"fund\",\r\n            parent_transaction_id: null\r\n        }]));\r\n\r\n        vi.mocked(useSaldosActions).mockReturnValue({\r\n            state: { aporte: {}, gasto: {}, newMerchantName: \"\", editingMerchant: null, deletingMerchant: null } as any,\r\n            setters: {\r\n                setAporteDate: vi.fn(),\r\n                setGastoDate: vi.fn(),\r\n                setNewMerchantName: vi.fn()\r\n            } as any,\r\n            handlers: {\r\n                resetGasto: vi.fn(),\r\n                handleAporteSubmit: vi.fn(),\r\n                handleAddMerchant: vi.fn(),\r\n                handleEditMerchant: vi.fn(),\r\n                handleDeleteMerchant: vi.fn(),\r\n                handleActivateMerchant: vi.fn(),\r\n                resetAporte: vi.fn()\r\n            },\r\n            isLoading: false\r\n        });\r\n    });\r\n\r\n    it(\"should render page header and merchant balance cards\", async () => {\r\n        render(<SaldosPage />, { wrapper: createWrapper() });\r\n\r\n        expect(await screen.findByText(/Saldos nos Estabelecimentos/i)).toBeDefined();\r\n        expect(await screen.findByText(/Merchant Test/i)).toBeDefined();\r\n        expect(await screen.findByText(/500/)).toBeDefined();\r\n    });\r\n\r\n    it(\"should render the transaction history section\", async () => {\r\n        render(<SaldosPage />, { wrapper: createWrapper() });\r\n\r\n        expect(await screen.findByText(/Hist├│rico de Saldos nos Estabelecimentos/i)).toBeDefined();\r\n        expect(screen.getByTestId(\"transaction-table\")).toBeDefined();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\components\\TransactionExportActions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\components\\TransactionFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\components\\TransactionItemsDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\components\\TransactionTable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\components\\__tests__\\TransactionTable.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\hooks\\__tests__\\use-entity-transactions.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5543,5546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5543,5546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5596,5599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5596,5599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5616,5619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5616,5619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { renderHook } from \"@testing-library/react\";\r\nimport { waitFor } from \"@testing-library/dom\";\r\nimport { useSaldosTransactions } from \"@/features/transactions/hooks/use-entity-transactions\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/features/auth/contexts/AuthContext\";\r\nimport { useTransactionMetadata } from \"@/features/transactions/hooks/use-transaction-metadata\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\nimport React from \"react\";\r\n\r\n// Mock dependencies\r\nvi.mock(\"@/integrations/supabase/client\", () => ({\r\n    supabase: {\r\n        from: vi.fn()\r\n    }\r\n}));\r\n\r\nvi.mock(\"@/features/auth/contexts/AuthContext\", () => ({\r\n    useAuth: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/hooks/use-transaction-metadata\", () => ({\r\n    useTransactionMetadata: vi.fn()\r\n}));\r\n\r\nconst createWrapper = () => {\r\n    const queryClient = new QueryClient({\r\n        defaultOptions: {\r\n            queries: {\r\n                retry: false,\r\n            },\r\n        },\r\n    });\r\n    return function Wrapper({ children }: { children: React.ReactNode }) {\r\n        return <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>;\r\n    }\r\n};\r\n\r\ndescribe(\"useSaldosTransactions hook\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n        vi.mocked(useAuth).mockReturnValue({ ...vi.mocked(useAuth)(), isDemo: false });\r\n        vi.mocked(useTransactionMetadata).mockReturnValue({\r\n            data: {\r\n                profiles: [],\r\n                accounts: [],\r\n                merchants: [],\r\n                profileNameMap: new Map(),\r\n                accountNameMap: new Map(),\r\n                merchantNameMap: new Map(),\r\n                accountEntityMap: new Map(),\r\n                entityTypeMap: new Map(),\r\n                entityNameMap: new Map(),\r\n                entities: [],\r\n            },\r\n            isLoading: false,\r\n            refetch: vi.fn(),\r\n            error: null\r\n        });\r\n    });\r\n\r\n    it(\"should filter and map ledger transactions correctly (including migrated ones)\", async () => {\r\n        const mockLedgerData = [\r\n            {\r\n                id: \"l1\",\r\n                type: \"transfer\",\r\n                amount_cents: 10000,\r\n                metadata: { modulo: \"aporte_saldo\" },\r\n                created_at: \"2026-02-08T00:00:00Z\",\r\n                created_by: \"u1\",\r\n                source_account: \"acc1\",\r\n                destination_account: \"m1\"\r\n            },\r\n            {\r\n                id: \"l2\",\r\n                type: \"expense\",\r\n                amount_cents: 5000,\r\n                metadata: { original_module: \"consumo_saldo\" }, // Migrated transaction\r\n                created_at: \"2026-02-07T00:00:00Z\",\r\n                created_by: \"u1\",\r\n                source_account: \"m1\",\r\n                destination_account: null\r\n            },\r\n            {\r\n                id: \"l3\",\r\n                type: \"income\",\r\n                amount_cents: 2000,\r\n                metadata: { modulo: \"other\" }, // Should be filtered out\r\n                created_at: \"2026-02-06T00:00:00Z\",\r\n                created_by: \"u1\",\r\n                source_account: \"ext\",\r\n                destination_account: \"acc1\"\r\n            }\r\n        ];\r\n\r\n        const mockQuery = {\r\n            select: vi.fn().mockReturnThis(),\r\n            or: vi.fn().mockReturnThis(),\r\n            in: vi.fn().mockReturnThis(),\r\n            order: vi.fn().mockReturnThis(),\r\n            limit: vi.fn().mockReturnThis(),\r\n            then: vi.fn((resolve) => resolve({ data: mockLedgerData, error: null })),\r\n            range: vi.fn().mockReturnThis(),\r\n            single: vi.fn().mockReturnThis(),\r\n            maybeSingle: vi.fn().mockReturnThis(),\r\n            csv: vi.fn().mockReturnThis(),\r\n            abortSignal: vi.fn().mockReturnThis(),\r\n            filter: vi.fn().mockReturnThis(),\r\n            match: vi.fn().mockReturnThis(),\r\n            neq: vi.fn().mockReturnThis(),\r\n            gt: vi.fn().mockReturnThis(),\r\n            lt: vi.fn().mockReturnThis(),\r\n            gte: vi.fn().mockReturnThis(),\r\n            lte: vi.fn().mockReturnThis(),\r\n            like: vi.fn().mockReturnThis(),\r\n            ilike: vi.fn().mockReturnThis(),\r\n            is: vi.fn().mockReturnThis(),\r\n            contains: vi.fn().mockReturnThis(),\r\n            containedBy: vi.fn().mockReturnThis(),\r\n            rangeGt: vi.fn().mockReturnThis(),\r\n            rangeGte: vi.fn().mockReturnThis(),\r\n            rangeLt: vi.fn().mockReturnThis(),\r\n            rangeLte: vi.fn().mockReturnThis(),\r\n            rangeAdjacent: vi.fn().mockReturnThis(),\r\n            overlaps: vi.fn().mockReturnThis(),\r\n            textSearch: vi.fn().mockReturnThis(),\r\n            insert: vi.fn().mockReturnThis(),\r\n            upsert: vi.fn().mockReturnThis(),\r\n            update: vi.fn().mockReturnThis(),\r\n            delete: vi.fn().mockReturnThis(),\r\n            rpc: vi.fn().mockReturnThis(),\r\n            returns: vi.fn().mockReturnThis(),\r\n            explain: vi.fn().mockReturnThis(),\r\n            throwOnError: vi.fn().mockReturnThis(),\r\n        };\r\n\r\n        vi.mocked(supabase.from).mockImplementation(((table: string) => {\r\n            if (table === \"transactions\") {\r\n                // Return empty for legacy to focus on ledger mapping in this test\r\n                return { ...mockQuery, then: vi.fn((resolve) => resolve({ data: [], error: null })) } as any;\r\n            }\r\n            return mockQuery as any;\r\n        }) as any);\r\n\r\n        const { result } = renderHook(() => useSaldosTransactions(), {\r\n            wrapper: createWrapper(),\r\n        });\r\n\r\n        await waitFor(() => expect(result.current.isSuccess).toBe(true));\r\n\r\n        expect(result.current.data).toHaveLength(3);\r\n        expect(result.current.data![0].id).toBe(\"l1\");\r\n        expect(result.current.data![1].id).toBe(\"l2\"); // Migrated one correctly identified\r\n        expect(result.current.data![2].id).toBe(\"l3\");\r\n        expect(result.current.data![0].amount).toBe(100);\r\n        expect(result.current.data![1].amount).toBe(50);\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\hooks\\use-entity-transactions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\hooks\\use-expense-shortcuts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\hooks\\use-reports.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\hooks\\use-transaction-metadata.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\hooks\\use-transactions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\pages\\LogPage.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1546,1549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1546,1549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1579,1582],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1579,1582],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { DashboardLayout } from \"@/shared/components/DashboardLayout\";\r\nimport { useAuth } from \"@/features/auth/contexts/AuthContext\";\r\nimport { useDemoData } from \"@/demo/useDemoData\";\r\nimport { useState } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/shared/ui/card\";\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from \"@/shared/ui/table\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { formatCurrencyBRL } from \"@/shared/lib/currency\";\r\nimport { Database } from \"@/integrations/supabase/types\";\r\nimport { renderSecurityDiff } from \"@/shared/lib/audit-utils\";\r\nimport {\r\n    Pagination,\r\n    PaginationContent,\r\n    PaginationItem,\r\n    PaginationNext,\r\n    PaginationPrevious,\r\n} from \"@/shared/ui/pagination\";\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/shared/ui/select\";\r\nimport { Input } from \"@/shared/ui/input\";\r\nimport { Label } from \"@/shared/ui/label\";\r\nimport { format } from \"date-fns\";\r\nimport { Search, Filter, Calendar as MapPin, User as UserIcon, XCircle, AlertCircle, ShieldCheck, History as HistoryIcon, Loader2 } from \"lucide-react\";\r\nimport { Badge } from \"@/shared/ui/badge\";\r\nimport { Button } from \"@/shared/ui/button\";\r\nimport { MODULE_LABELS } from \"@/shared/lib/constants\";\r\n\r\ninterface AuditLog {\r\n    id: string;\r\n    created_at: string;\r\n    action: string;\r\n    before: Record<string, any>;\r\n    after: Record<string, any>;\r\n    actor_profile: { name: string | null } | null;\r\n}\r\n\r\nexport default function LogPage() {\r\n    const { isDemo } = useAuth();\r\n    const { getLogs, getAccounts } = useDemoData();\r\n\r\n    const [page, setPage] = useState(1);\r\n    const pageSize = 15;\r\n    const [startDate, setStartDate] = useState<string>(\"\");\r\n    const [endDate, setEndDate] = useState<string>(\"\");\r\n    const [selectedUser, setSelectedUser] = useState<string>(\"all\");\r\n    const [selectedAction, setSelectedAction] = useState<string>(\"all\");\r\n\r\n    // Fetch users for filter and lookups\r\n    const { data: users } = useQuery({\r\n        queryKey: [\"users-list\"],\r\n        queryFn: async () => {\r\n            const { data, error } = await supabase\r\n                .from(\"profiles\")\r\n                .select(\"user_id, name\")\r\n                .order(\"name\");\r\n            if (error) throw error;\r\n            return data;\r\n        },\r\n        enabled: !isDemo,\r\n    });\r\n\r\n    // Fetch accounts for lookups\r\n    const { data: accounts } = useQuery({\r\n        queryKey: [\"accounts-lookup\"],\r\n        queryFn: async () => {\r\n            const { data, error } = await supabase\r\n                .from(\"accounts\")\r\n                .select(\"id, name\");\r\n            if (error) throw error;\r\n            return data;\r\n        },\r\n        enabled: !isDemo,\r\n    });\r\n\r\n    const { data: logsData, isLoading: isLoadingLogs } = useQuery({\r\n        queryKey: [\"audit-logs\", page, startDate, endDate, selectedUser, selectedAction],\r\n        queryFn: async () => {\r\n            let query = supabase\r\n                .from(\"ledger_audit_log\")\r\n                .select(`\r\n          id,\r\n          created_at,\r\n          action,\r\n          before,\r\n          after,\r\n          actor_profile:profiles!ledger_audit_log_actor_profiles_fkey(name)\r\n        `, { count: \"exact\" });\r\n\r\n            if (startDate) query = query.gte(\"created_at\", `${startDate}T00:00:00`);\r\n            if (endDate) query = query.lte(\"created_at\", `${endDate}T23:59:59`);\r\n            if (selectedUser !== \"all\") query = query.eq(\"actor\", selectedUser);\r\n\r\n            if (selectedAction !== \"all\") {\r\n                if (selectedAction === \"void\") {\r\n                    query = query.eq(\"action\", \"VOID_LEDGER\");\r\n                } else if (selectedAction === \"change\") {\r\n                    // Mapeia para a├º├Áes de seguran├ºa/config no futuro ou filtro atual\r\n                    query = query.eq(\"action\", \"SECURITY_CHANGE\");\r\n                }\r\n            } else {\r\n                // Por padr├úo, esconde INSERT_LEDGER para focar em anula├º├Áes e mudan├ºas\r\n                query = query.neq(\"action\", \"INSERT_LEDGER\");\r\n            }\r\n\r\n            const from = (page - 1) * pageSize;\r\n            const to = from + pageSize - 1;\r\n\r\n            const { data, error, count } = await query\r\n                .order(\"created_at\", { ascending: false })\r\n                .range(from, to);\r\n\r\n            if (error) {\r\n                console.error(\"Erro ao buscar logs:\", error);\r\n                throw error;\r\n            }\r\n            return {\r\n                logs: data as unknown as AuditLog[],\r\n                totalCount: count || 0\r\n            };\r\n        },\r\n        enabled: !isDemo,\r\n    });\r\n\r\n    const realLogs = logsData?.logs || [];\r\n    const currentTotalCount = logsData?.totalCount || 0;\r\n    const totalPages = Math.ceil(currentTotalCount / pageSize);\r\n\r\n    const logs = isDemo ? getLogs() : realLogs;\r\n    const isLoading = isLoadingLogs;\r\n\r\n    // Create lookup maps for ID resolution\r\n    const userLookup = Object.fromEntries(\r\n        (isDemo ? [] : users)?.map(u => [u.user_id, u.name]) || []\r\n    );\r\n    const accountLookup = Object.fromEntries(\r\n        (isDemo ? getAccounts() : accounts)?.map(a => [a.id, a.name]) || []\r\n    );\r\n\r\n    // Add demo users to lookup if in demo mode\r\n    if (isDemo) {\r\n        userLookup['system'] = 'Sistema';\r\n        userLookup['admin'] = 'Administrador';\r\n        userLookup['user-123'] = 'Usu├írio Teste';\r\n        userLookup['user-456'] = 'Usu├írio Bloqueado';\r\n        userLookup['user-old'] = 'Antigo Respons├ível';\r\n        userLookup['user-new'] = 'Novo Respons├ível';\r\n    }\r\n\r\n    const lookups = { users: userLookup, accounts: accountLookup };\r\n\r\n    return (\r\n        <DashboardLayout>\r\n            <div className=\"space-y-6 animate-fade-in\">\r\n                <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-bold text-foreground\">Trilha de Auditoria</h1>\r\n                        <p className=\"text-muted-foreground\">Hist├│rico profissional de anula├º├Áes e eventos de seguran├ºa</p>\r\n                    </div>\r\n\r\n                    {!isDemo && (\r\n                        <div className=\"flex flex-wrap gap-2 bg-muted/30 p-2 rounded-lg border border-border/50\">\r\n                            <div className=\"space-y-1\">\r\n                                <Label htmlFor=\"start-date\" className=\"text-[10px] uppercase ml-1\">In├¡cio</Label>\r\n                                <Input\r\n                                    id=\"start-date\"\r\n                                    type=\"date\"\r\n                                    className=\"h-8 text-xs w-[130px]\"\r\n                                    value={startDate}\r\n                                    onChange={(e) => setStartDate(e.target.value)}\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-1\">\r\n                                <Label htmlFor=\"end-date\" className=\"text-[10px] uppercase ml-1\">Fim</Label>\r\n                                <Input\r\n                                    id=\"end-date\"\r\n                                    type=\"date\"\r\n                                    className=\"h-8 text-xs w-[130px]\"\r\n                                    value={endDate}\r\n                                    onChange={(e) => setEndDate(e.target.value)}\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-1\">\r\n                                <Label htmlFor=\"log-user\" className=\"text-[10px] uppercase ml-1\">Usu├írio</Label>\r\n                                <Select value={selectedUser} onValueChange={setSelectedUser}>\r\n                                    <SelectTrigger id=\"log-user\" className=\"h-8 text-xs w-[150px]\" aria-label=\"Filtrar por usu├írio\">\r\n                                        <SelectValue placeholder=\"Todos\" />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        <SelectItem value=\"all\">Todos os usu├írios</SelectItem>\r\n                                        {users?.map(u => (\r\n                                            <SelectItem key={u.user_id} value={u.user_id}>{u.name}</SelectItem>\r\n                                        ))}\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                            <div className=\"space-y-1\">\r\n                                <Label htmlFor=\"log-action\" className=\"text-[10px] uppercase ml-1\">A├º├úo</Label>\r\n                                <Select value={selectedAction} onValueChange={setSelectedAction}>\r\n                                    <SelectTrigger id=\"log-action\" className=\"h-8 text-xs w-[110px]\" aria-label=\"Filtrar por a├º├úo\">\r\n                                        <SelectValue placeholder=\"Todas\" />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        <SelectItem value=\"all\">Todas</SelectItem>\r\n                                        <SelectItem value=\"void\">Anula├º├Áes</SelectItem>\r\n                                        <SelectItem value=\"change\">Seguran├ºa</SelectItem>\r\n                                    </SelectContent>\r\n                                </Select>\r\n                            </div>\r\n                            {(startDate || endDate || selectedUser !== \"all\" || selectedAction !== \"all\") && (\r\n                                <div className=\"flex items-end pb-0.5\">\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        className=\"h-8 w-8 text-muted-foreground hover:text-destructive\"\r\n                                        onClick={() => {\r\n                                            setStartDate(\"\");\r\n                                            setEndDate(\"\");\r\n                                            setSelectedUser(\"all\");\r\n                                            setSelectedAction(\"all\");\r\n                                            setPage(1);\r\n                                        }}\r\n                                    >\r\n                                        <XCircle className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <Card>\r\n                    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <HistoryIcon className=\"h-5 w-5 text-primary\" />\r\n                            <CardTitle className=\"text-lg font-bold\">Hist├│rico de Auditoria</CardTitle>\r\n                        </div>\r\n                        {!isDemo && currentTotalCount > 0 && (\r\n                            <Badge variant=\"outline\" className=\"text-[10px] font-normal\">\r\n                                {currentTotalCount} registros\r\n                            </Badge>\r\n                        )}\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        {isLoading ? (\r\n                            <div className=\"py-20 text-center\">\r\n                                <Loader2 className=\"h-8 w-8 animate-spin mx-auto text-primary/40 mb-2\" />\r\n                                <p className=\"text-xs text-muted-foreground animate-pulse\">Buscando registros...</p>\r\n                            </div>\r\n                        ) : !logs || logs.length === 0 ? (\r\n                            <div className=\"py-12 text-center\">\r\n                                <Search className=\"h-10 w-10 text-muted/30 mx-auto mb-3\" />\r\n                                <p className=\"text-muted-foreground text-sm font-medium\">Nenhum log encontrado</p>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"space-y-4\">\r\n                                <div className=\"overflow-x-auto rounded-md border border-border/40\">\r\n                                    <Table>\r\n                                        <TableHeader className=\"bg-muted/30\">\r\n                                            <TableRow>\r\n                                                <TableHead className=\"w-[120px]\">Timestamp</TableHead>\r\n                                                <TableHead>A├º├úo</TableHead>\r\n                                                <TableHead>Ator</TableHead>\r\n                                                <TableHead className=\"text-right\">Valor</TableHead>\r\n                                                <TableHead>Detalhes da Opera├º├úo</TableHead>\r\n                                                <TableHead className=\"w-[250px] border-l font-bold text-destructive/80\">Justificativa / Motivo</TableHead>\r\n                                            </TableRow>\r\n                                        </TableHeader>\r\n                                        <TableBody>\r\n                                            {logs.map((log) => {\r\n                                                const data = log.after || log.before || {};\r\n                                                const isVoid = log.action === 'VOID_LEDGER';\r\n                                                const isSecurity = log.action === 'SECURITY_CHANGE';\r\n\r\n                                                // Extrair dados da transa├º├úo do JSON\r\n                                                const amount = data.amount_cents ? Number(data.amount_cents) / 100 : 0;\r\n                                                const module = data.module;\r\n                                                const description = data.description || \"Sem descri├º├úo\";\r\n                                                const direction = data.type === 'income' ? 'in' : 'out';\r\n                                                const reason = data.metadata?.void_reason || log.reason || null;\r\n\r\n                                                return (\r\n                                                    <TableRow key={log.id} className={isSecurity ? \"bg-muted/5 italic\" : \"bg-card\"}>\r\n                                                        <TableCell className=\"text-[10px] font-mono whitespace-nowrap opacity-60\">\r\n                                                            {format(new Date(log.created_at), \"dd/MM HH:mm:ss\")}\r\n                                                        </TableCell>\r\n                                                        <TableCell>\r\n                                                            <div className=\"flex items-center gap-2\">\r\n                                                                {isSecurity ? (\r\n                                                                    <Badge variant=\"outline\" className=\"bg-blue-500/5 text-blue-500 border-blue-500/20 text-[9px] px-1.5 h-5 uppercase\">\r\n                                                                        <ShieldCheck className=\"h-3 w-3 mr-1\" /> Seguran├ºa\r\n                                                                    </Badge>\r\n                                                                ) : (\r\n                                                                    <Badge variant=\"outline\" className={`${isVoid ? 'bg-destructive/5 text-destructive border-destructive/20' : 'bg-primary/5 text-primary border-primary/20'} text-[9px] px-1.5 h-5 uppercase`}>\r\n                                                                        {isVoid ? 'Anula├º├úo' : 'A├º├úo'}\r\n                                                                    </Badge>\r\n                                                                )}\r\n                                                            </div>\r\n                                                        </TableCell>\r\n                                                        <TableCell>\r\n                                                            <div className=\"flex flex-col gap-0.5\">\r\n                                                                <div className=\"flex items-center gap-1.5\">\r\n                                                                    <UserIcon className=\"h-3 w-3 text-muted-foreground/60\" />\r\n                                                                    <span className=\"text-xs font-semibold\">{log.actor_profile?.name || \"Sistema\"}</span>\r\n                                                                </div>\r\n                                                                {module && (\r\n                                                                    <span className=\"text-[10px] text-muted-foreground\">\r\n                                                                        {MODULE_LABELS[module] || module}\r\n                                                                    </span>\r\n                                                                )}\r\n                                                            </div>\r\n                                                        </TableCell>\r\n                                                        <TableCell className={`text-right font-mono text-xs tabular-nums ${direction === \"in\" || module === \"aporte_saldo\" ? \"text-success\" : \"text-destructive\"}`}>\r\n                                                            {amount !== 0 ? (\r\n                                                                <>\r\n                                                                    {direction === \"in\" || module === \"aporte_saldo\" ? \"+\" : \"-\"}\r\n                                                                    {formatCurrencyBRL(amount)}\r\n                                                                </>\r\n                                                            ) : (\r\n                                                                <span className=\"text-muted-foreground/30\">ÔÇö</span>\r\n                                                            )}\r\n                                                        </TableCell>\r\n                                                        <TableCell className=\"max-w-[300px]\">\r\n                                                            <div className=\"flex flex-col gap-1\">\r\n                                                                <p className=\"text-xs leading-tight line-clamp-2\">\r\n                                                                    {isSecurity\r\n                                                                        ? renderSecurityDiff(log.before, log.after, lookups)\r\n                                                                        : (description)}\r\n                                                                </p>\r\n                                                            </div>\r\n                                                        </TableCell>\r\n                                                        <TableCell className=\"text-xs border-l bg-muted/5 font-medium px-4 py-3 leading-relaxed\">\r\n                                                            <div className=\"flex items-start gap-2\">\r\n                                                                <AlertCircle className=\"h-3.5 w-3.5 mt-0.5 text-muted-foreground/40 shrink-0\" />\r\n                                                                <span className=\"text-foreground/80 italic\">\"{reason || \"Nenhuma justificativa fornecida\"}\"</span>\r\n                                                            </div>\r\n                                                        </TableCell>\r\n                                                    </TableRow>\r\n                                                );\r\n                                            })}\r\n                                        </TableBody>\r\n                                    </Table>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </CardContent>\r\n                </Card>\r\n\r\n                {!isDemo && totalPages > 1 && (\r\n                    <div className=\"flex justify-center pt-2\">\r\n                        <Pagination>\r\n                            <PaginationContent>\r\n                                <PaginationItem>\r\n                                    <PaginationPrevious\r\n                                        href=\"#\"\r\n                                        onClick={(e) => {\r\n                                            e.preventDefault();\r\n                                            if (page > 1) setPage(p => p - 1);\r\n                                        }}\r\n                                        className={page === 1 ? \"pointer-events-none opacity-50\" : \"\"}\r\n                                    />\r\n                                </PaginationItem>\r\n\r\n                                <div className=\"flex items-center gap-2 mx-4 text-sm text-muted-foreground\">\r\n                                    P├ígina <span className=\"font-bold text-foreground\">{page}</span> de {totalPages}\r\n                                </div>\r\n\r\n                                <PaginationItem>\r\n                                    <PaginationNext\r\n                                        href=\"#\"\r\n                                        onClick={(e) => {\r\n                                            e.preventDefault();\r\n                                            if (page < totalPages) setPage(p => p + 1);\r\n                                        }}\r\n                                        className={page === totalPages ? \"pointer-events-none opacity-50\" : \"\"}\r\n                                    />\r\n                                </PaginationItem>\r\n                            </PaginationContent>\r\n                        </Pagination>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </DashboardLayout>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\pages\\RelatoriosPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\pages\\__tests__\\LogPage.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[619,622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[619,622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2425,2428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2425,2428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2523,2526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2523,2526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3485,3488],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3485,3488],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3546,3549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3546,3549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5261,5264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5261,5264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5320,5323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5320,5323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { render, screen } from \"@testing-library/react\";\r\nimport LogPage from \"@/features/transactions/pages/LogPage\";\r\nimport React from \"react\";\r\nimport { useAuth } from \"@/features/auth/contexts/AuthContext\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\n\r\n// Mock contexts/hooks\r\nvi.mock(\"@/features/auth/contexts/AuthContext\", () => ({\r\n    useAuth: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@tanstack/react-query\", async (importOriginal) => {\r\n    const actual = await importOriginal<any>();\r\n    return {\r\n        ...actual,\r\n        useQuery: vi.fn()\r\n    };\r\n});\r\n\r\n// Mock Supabase\r\nvi.mock(\"@/integrations/supabase/client\", () => ({\r\n    supabase: {\r\n        from: vi.fn(() => ({\r\n            select: vi.fn(() => ({\r\n                order: vi.fn(() => ({\r\n                    range: vi.fn(() => Promise.resolve({ data: [], error: null, count: 0 }))\r\n                }))\r\n            })),\r\n            neq: vi.fn().mockReturnThis(),\r\n            gte: vi.fn().mockReturnThis(),\r\n            lte: vi.fn().mockReturnThis(),\r\n            eq: vi.fn().mockReturnThis()\r\n        }))\r\n    }\r\n}));\r\n\r\n// Mock layout/components\r\nvi.mock(\"@/shared/components/DashboardLayout\", () => ({\r\n    DashboardLayout: ({ children }: { children: React.ReactNode }) => <div>{children}</div>\r\n}));\r\n\r\nvi.mock(\"@/shared/lib/audit-utils\", () => ({\r\n    renderSecurityDiff: vi.fn(() => \"Security Diff Text\")\r\n}));\r\n\r\n// Mock demo data\r\nvi.mock(\"@/demo/useDemoData\", () => ({\r\n    useDemoData: vi.fn(() => ({\r\n        getLogs: vi.fn(() => []),\r\n        getAccounts: vi.fn(() => [])\r\n    }))\r\n}));\r\n\r\nconst createWrapper = () => {\r\n    const queryClient = new QueryClient({\r\n        defaultOptions: { queries: { retry: false } },\r\n    });\r\n    return ({ children }: { children: React.ReactNode }) => (\r\n        <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n    );\r\n};\r\n\r\ndescribe(\"LogPage integration\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n\r\n        vi.mocked(useAuth).mockReturnValue({ ...vi.mocked(useAuth)(), isDemo: false });\r\n\r\n        // Default mock for useQuery\r\n        vi.mocked(useQuery).mockImplementation(({ queryKey }: { queryKey: readonly unknown[] }) => {\r\n            if (queryKey[0] === \"users-list\") return { data: [], isLoading: false } as any;\r\n            if (queryKey[0] === \"accounts-lookup\") return { data: [], isLoading: false } as any;\r\n            if (queryKey[0] === \"audit-logs\") return {\r\n                data: {\r\n                    logs: [\r\n                        {\r\n                            id: \"l1\",\r\n                            created_at: new Date().toISOString(),\r\n                            action: \"VOID_LEDGER\",\r\n                            actor_profile: { name: \"Test User\" },\r\n                            after: {\r\n                                amount_cents: 5000,\r\n                                description: \"Estorno Teste\",\r\n                                module: \"mensalidade\",\r\n                                type: \"expense\",\r\n                                metadata: {\r\n                                    void_reason: \"Erro de teste\"\r\n                                }\r\n                            }\r\n                        }\r\n                    ],\r\n                    totalCount: 1\r\n                },\r\n                isLoading: false\r\n            } as any;\r\n            return { data: null, isLoading: false } as any;\r\n        });\r\n    });\r\n\r\n    it(\"should render page header and filters\", () => {\r\n        render(<LogPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Trilha de Auditoria\")).toBeDefined();\r\n        expect(screen.getByText(\"In├¡cio\")).toBeDefined();\r\n        expect(screen.getByText(\"Fim\")).toBeDefined();\r\n        expect(screen.getByText(\"Usu├írio\")).toBeDefined();\r\n        expect(screen.getAllByText(\"A├º├úo\")).toHaveLength(2); // Label and Table Head\r\n    });\r\n\r\n    it(\"should render audit logs in the table\", () => {\r\n        render(<LogPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Hist├│rico de Auditoria\")).toBeDefined();\r\n        expect(screen.getByText(\"Anula├º├úo\")).toBeDefined();\r\n        expect(screen.getByText(\"Test User\")).toBeDefined();\r\n        expect(screen.getByText(\"Estorno Teste\")).toBeDefined();\r\n        expect(screen.getByText(/\"Erro de teste\"/)).toBeDefined();\r\n    });\r\n\r\n    it(\"should render security logs differently\", () => {\r\n        vi.mocked(useQuery).mockImplementation(({ queryKey }: { queryKey: readonly unknown[] }) => {\r\n            if (queryKey[0] === \"audit-logs\") return {\r\n                data: {\r\n                    logs: [\r\n                        {\r\n                            id: \"l2\",\r\n                            created_at: new Date().toISOString(),\r\n                            action: \"SECURITY_CHANGE\",\r\n                            actor_profile: { name: \"Admin\" },\r\n                            before: {},\r\n                            after: {}\r\n                        }\r\n                    ],\r\n                    totalCount: 1\r\n                },\r\n                isLoading: false\r\n            } as any;\r\n            return { data: [], isLoading: false } as any;\r\n        });\r\n\r\n        render(<LogPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Seguran├ºa\")).toBeDefined();\r\n        expect(screen.getByText(\"Security Diff Text\")).toBeDefined();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\pages\\__tests__\\RelatoriosPage.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1666,1669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1666,1669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect, vi, beforeEach } from \"vitest\";\r\nimport { render, screen } from \"@testing-library/react\";\r\nimport RelatoriosPage from \"@/features/transactions/pages/RelatoriosPage\";\r\nimport React from \"react\";\r\nimport { useDashboardData, useReportData } from \"@/features/dashboard/hooks/use-dashboard-data\";\r\nimport { useAllTransactionsWithCreator } from \"@/features/transactions/hooks/use-entity-transactions\";\r\nimport { useEntities } from \"@/shared/hooks/use-accounts\";\r\nimport { useReports } from \"@/features/transactions/hooks/use-reports\";\r\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\r\n\r\n// Mock hooks\r\nvi.mock(\"@/features/dashboard/hooks/use-dashboard-data\", () => ({\r\n    useDashboardData: vi.fn(),\r\n    useReportData: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/hooks/use-entity-transactions\", () => ({\r\n    useAllTransactionsWithCreator: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/shared/hooks/use-accounts\", () => ({\r\n    useEntities: vi.fn()\r\n}));\r\n\r\nvi.mock(\"@/features/transactions/hooks/use-reports\", () => ({\r\n    useReports: vi.fn()\r\n}));\r\n\r\n// Mock auth\r\nvi.mock(\"@/features/auth/contexts/AuthContext\", () => ({\r\n    useAuth: vi.fn(() => ({\r\n        user: { id: \"user-123\" },\r\n        profile: { role: \"admin\" },\r\n        isAdmin: true,\r\n        isDemo: false,\r\n        isSecretaria: false,\r\n        loading: false,\r\n    }))\r\n}));\r\n\r\n// Mock layout/components\r\nvi.mock(\"@/shared/components/DashboardLayout\", () => ({\r\n    DashboardLayout: ({ children }: { children: React.ReactNode }) => <div>{children}</div>\r\n}));\r\n\r\nvi.mock(\"@/shared/components/forms/DateInput\", () => ({\r\n    DateInput: ({ value, onChange }: any) => <input type=\"date\" value={value} onChange={(e) => onChange(e.target.value)} data-testid=\"date-input\" />\r\n}));\r\n\r\nconst createWrapper = () => {\r\n    const queryClient = new QueryClient({\r\n        defaultOptions: { queries: { retry: false } },\r\n    });\r\n    return ({ children }: { children: React.ReactNode }) => (\r\n        <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\r\n    );\r\n};\r\n\r\ndescribe(\"RelatoriosPage integration\", () => {\r\n    beforeEach(() => {\r\n        vi.clearAllMocks();\r\n\r\n        // Setup default mocks\r\n        vi.mocked(useDashboardData).mockReturnValue({\r\n            data: {},\r\n            isLoading: false\r\n        } as ReturnType<typeof useDashboardData>);\r\n\r\n        vi.mocked(useEntities).mockReturnValue({\r\n            data: [{ id: \"ent-assoc\", type: \"associacao\", name: \"Associa├º├úo\", cnpj: \"\" }],\r\n            isLoading: false\r\n        } as ReturnType<typeof useEntities>);\r\n\r\n        vi.mocked(useReportData).mockReturnValue({\r\n            data: { income: 0, expense: 0, balance: 0 },\r\n            isLoading: false\r\n        } as ReturnType<typeof useReportData>);\r\n\r\n        vi.mocked(useAllTransactionsWithCreator).mockReturnValue({\r\n            data: [{ id: \"t1\", amount: 100, description: \"Relatorio Teste\", transaction_date: new Date().toISOString(), module: \"mensalidade\", direction: \"in\" }],\r\n            isLoading: false\r\n        } as ReturnType<typeof useAllTransactionsWithCreator>);\r\n\r\n        vi.mocked(useReports).mockReturnValue({\r\n            getWhatsAppReportText: () => \"Mock Report Text\",\r\n            copyReport: vi.fn(),\r\n            openWhatsApp: vi.fn(),\r\n            exportPDF: vi.fn()\r\n        } as ReturnType<typeof useReports>);\r\n    });\r\n\r\n    it(\"should render page header and date controls\", () => {\r\n        render(<RelatoriosPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Relat├│rios\")).toBeDefined();\r\n        expect(screen.getAllByTestId(\"date-input\")).toHaveLength(2);\r\n    });\r\n\r\n    it(\"should render report preview section\", () => {\r\n        render(<RelatoriosPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Preview do Relat├│rio (WhatsApp)\")).toBeDefined();\r\n        expect(screen.getByText(\"Mock Report Text\")).toBeDefined();\r\n    });\r\n\r\n    it(\"should render transactions table in history section\", () => {\r\n        render(<RelatoriosPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Hist├│rico do Per├¡odo\")).toBeDefined();\r\n        expect(screen.getByText(\"Relatorio Teste\")).toBeDefined();\r\n        expect(screen.getByText(/100/)).toBeDefined();\r\n    });\r\n\r\n    it(\"should render action buttons\", () => {\r\n        render(<RelatoriosPage />, { wrapper: createWrapper() });\r\n\r\n        expect(screen.getByText(\"Copiar Texto\")).toBeDefined();\r\n        expect(screen.getByText(\"Abrir WhatsApp\")).toBeDefined();\r\n        expect(screen.getByText(\"Exportar PDF\")).toBeDefined();\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\transactions\\services\\transactionService.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1963,1966],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1963,1966],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { extendedSupabase } from \"@/integrations/supabase/extendedClient\";\r\nimport { LedgerType, LedgerTransaction } from \"@/domain/ledger\";\r\nimport { LedgerStatus } from \"@/shared/constants/ledger\";\r\n\r\nexport const transactionService = {\r\n    /**\r\n     * Cria uma transa├º├úo no Ledger\r\n     */\r\n    async createLedgerTransaction(input: {\r\n        type: LedgerType;\r\n        source_account: string;\r\n        destination_account?: string | null;\r\n        amount_cents: number;\r\n        description?: string | null;\r\n        reference_id?: string | null;\r\n        status?: LedgerStatus;\r\n        created_at?: string;\r\n        metadata?: Record<string, unknown>;\r\n    }): Promise<LedgerTransaction> {\r\n        if (!Number.isInteger(input.amount_cents) || input.amount_cents <= 0) {\r\n            throw new Error(\"O valor (em centavos) deve ser um n├║mero inteiro positivo.\");\r\n        }\r\n\r\n        const { data: userData, error: userError } = await extendedSupabase.auth.getUser();\r\n        const userId = userData.user?.id;\r\n        if (!userId || userError) throw new Error(\"Usu├írio n├úo autenticado no Supabase.\");\r\n\r\n        const { data, error } = await extendedSupabase.from(\"ledger_transactions\").insert({\r\n            created_at: input.created_at ? new Date(input.created_at).toISOString() : undefined,\r\n            created_by: userId,\r\n            type: input.type,\r\n            source_account: input.source_account,\r\n            destination_account: input.destination_account ?? null,\r\n            amount_cents: input.amount_cents,\r\n            description: input.description ?? null,\r\n            reference_id: input.reference_id ?? null,\r\n            status: input.status || LedgerStatus.VALIDATED,\r\n            module: (input.metadata?.module as string) ?? null,\r\n            entity_id: (input.metadata?.entity_id as string) ?? null,\r\n            payment_method: (input.metadata?.payment_method as string) ?? null,\r\n            metadata: (input.metadata as any) ?? {},\r\n        })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) {\r\n            console.error(\"Erro ao inserir no Ledger:\", error);\r\n            throw error;\r\n        }\r\n\r\n        return data as unknown as LedgerTransaction;\r\n    },\r\n\r\n    /**\r\n     * Anula uma transa├º├úo via RPC\r\n     */\r\n    async voidTransaction(transactionId: string, reason: string): Promise<void> {\r\n        const { error } = await extendedSupabase.rpc(\"void_transaction\", {\r\n            p_id: transactionId,\r\n            p_reason: reason,\r\n        });\r\n\r\n        if (error) throw error;\r\n    },\r\n\r\n    /**\r\n     * Aprova uma transa├º├úo pendente via RPC\r\n     */\r\n    async approveTransaction(transactionId: string): Promise<void> {\r\n        const { error } = await extendedSupabase.rpc(\"approve_ledger_transaction\", {\r\n            p_id: transactionId,\r\n        });\r\n\r\n        if (error) throw error;\r\n    },\r\n\r\n    /**\r\n     * Verifica se j├í existe uma mensalidade para o turno e m├®todo na data\r\n     */\r\n    async checkExistingMonthlyFee(date: string, turno: string, method: \"cash\" | \"pix\"): Promise<{ id: string }[]> {\r\n        const module = method === \"cash\" ? \"mensalidade\" : \"mensalidade_pix\";\r\n        const { data, error } = await extendedSupabase\r\n            .from(\"ledger_transactions\")\r\n            .select(\"id\")\r\n            .eq(\"status\", \"validated\")\r\n            .eq(\"metadata->>shift\", turno)\r\n            .gte(\"created_at\", `${date}T00:00:00`)\r\n            .lte(\"created_at\", `${date}T23:59:59.999`)\r\n            // Compat├¡vel com registros novos (coluna module) e antigos (metadata)\r\n            .or(\r\n                [\r\n                    `module.eq.${module}`,\r\n                    `metadata->>module.eq.${module}`,\r\n                    `metadata->>modulo.eq.${module}`,\r\n                    `metadata->>original_module.eq.${module}`,\r\n                ].join(\",\")\r\n            );\r\n\r\n        if (error) throw error;\r\n        return data || [];\r\n    }\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\users\\pages\\PerfilPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\users\\pages\\UsuariosPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\features\\users\\services\\profileService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\integrations\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\integrations\\supabase\\database.extension.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\integrations\\supabase\\extendedClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\integrations\\supabase\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\main.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[475,478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[475,478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createRoot } from \"react-dom/client\";\r\nimport App from \"./App.tsx\";\r\nimport \"./index.css\";\r\nimport { ErrorBoundary } from \"@/shared/components/ErrorBoundary\";\r\n\r\nconst polyfillCrypto = () => {\r\n    try {\r\n        if (typeof window !== \"undefined\" && !window.crypto.randomUUID) {\r\n            Object.defineProperty(window.crypto, 'randomUUID', {\r\n                value: () => {\r\n                    return \"10000000-1000-4000-8000-100000000000\".replace(/[018]/g, (c: any) => {\r\n                        const random = (window.crypto.getRandomValues && window.crypto.getRandomValues(new Uint8Array(1))[0]) || Math.floor(Math.random() * 256);\r\n                        return (c ^ random & 15 >> (c / 4)).toString(16);\r\n                    }) as `${string}-${string}-${string}-${string}-${string}`;\r\n                },\r\n                configurable: true,\r\n                writable: true\r\n            });\r\n        }\r\n    } catch (e) {\r\n        console.warn(\"Could not polyfill crypto.randomUUID\", e);\r\n    }\r\n};\r\n\r\npolyfillCrypto();\r\n\r\ncreateRoot(document.getElementById(\"root\")!).render(\r\n    <ErrorBoundary>\r\n        <App />\r\n    </ErrorBoundary>\r\n);\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\ActionCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\BuildVersion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\DashboardLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\DemoModeBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\NavLink.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\PageLoader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\ProtectedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\VoidTransactionDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\dialogs\\AccountDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\forms\\CurrencyInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\forms\\DateInput.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\forms\\__tests__\\CurrencyInput.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\components\\forms\\__tests__\\DateInput.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\constants\\ledger.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\hooks\\use-accounts.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\hooks\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\__tests__\\account-display.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\__tests__\\currency.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\__tests__\\date-utils.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\__tests__\\domain-balances.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\__tests__\\search-filter.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\__tests__\\sorting.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\account-display.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\audit-utils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1521,1524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1521,1524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n/**\r\n * Traduz chaves t├®cnicas do banco para nomes amig├íveis em portugu├¬s\r\n */\r\nconst FIELD_LABELS: Record<string, string> = {\r\n    name: \"Nome\",\r\n    role: \"N├¡vel de Acesso\",\r\n    active: \"Status da Conta\",\r\n    email: \"E-mail\",\r\n    active_user: \"Usu├írio Ativo\",\r\n    updated_at: \"├Ültima Atualiza├º├úo\",\r\n    user_id: \"Usu├írio\",\r\n    user: \"Usu├írio\",\r\n    account_id: \"Conta\",\r\n    source_account_id: \"Conta de Origem\",\r\n    destination_account_id: \"Conta de Destino\",\r\n    description: \"Descri├º├úo\",\r\n    notes: \"Observa├º├Áes\",\r\n    amount: \"Valor\",\r\n    module: \"M├│dulo\",\r\n    entity_id: \"Entidade\",\r\n    merchant_id: \"Estabelecimento\"\r\n};\r\n\r\n/**\r\n * Traduz valores espec├¡ficos para algo mais leg├¡vel\r\n */\r\nconst VALUE_LABELS: Record<string, string> = {\r\n    admin: \"Administrador\",\r\n    user: \"Usu├írio\",\r\n    demo: \"Demonstra├º├úo\",\r\n    true: \"Ativo\",\r\n    false: \"Inativo/Pendente\",\r\n    posted: \"Efetivado\",\r\n    voided: \"Anulado\"\r\n};\r\n\r\nexport function renderSecurityDiff(\r\n    before: Record<string, unknown> | null,\r\n    after: Record<string, unknown> | null,\r\n    lookups: { users?: Record<string, string>, accounts?: Record<string, string> } = {}\r\n) {\r\n    if (!before || !after) return \"Altera├º├úo de Seguran├ºa\";\r\n\r\n    const changes = [];\r\n\r\n    // Lista de chaves que representam IDs e devem ser resolvidas\r\n    const USER_KEYS = ['user_id', 'user', 'actor', 'created_by'];\r\n    const ACCOUNT_KEYS = ['account_id', 'source_account_id', 'destination_account_id'];\r\n\r\n    const resolveValue = (key: string, val: any) => {\r\n        const strVal = String(val ?? 'Nulo');\r\n\r\n        // Se for uma chave de usu├írio e tivermos o lookup\r\n        if (USER_KEYS.includes(key) && lookups.users?.[strVal]) {\r\n            return lookups.users[strVal];\r\n        }\r\n\r\n        // Se for uma chave de conta e tivermos o lookup\r\n        if (ACCOUNT_KEYS.includes(key) && lookups.accounts?.[strVal]) {\r\n            return lookups.accounts[strVal];\r\n        }\r\n\r\n        return VALUE_LABELS[strVal] || strVal;\r\n    };\r\n\r\n    // Compara as chaves do objeto 'after' com 'before'\r\n    for (const key in after) {\r\n        if (JSON.stringify(before[key]) !== JSON.stringify(after[key])) {\r\n            // Ignora campos de sistema ou timestamp\r\n            if (['id', 'updated_at', 'created_at'].includes(key)) continue;\r\n\r\n            const label = FIELD_LABELS[key] || key;\r\n            const oldVal = resolveValue(key, before[key]);\r\n            const newVal = resolveValue(key, after[key]);\r\n\r\n            changes.push(`${label}: ${oldVal} Ô×ö ${newVal}`);\r\n        }\r\n    }\r\n\r\n    return changes.length > 0 ? changes.join(\" | \") : \"Ajuste t├®cnico de sistema\";\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\currency.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\date-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\export-utils.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3528,3531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3528,3531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\mappers\\__tests__\\transactionMapper.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2123,2126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2123,2126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":79,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":79,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3343,3346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3343,3346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3707,3710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3707,3710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from \"vitest\";\r\nimport { mapLedgerTransaction, mapLegacyTransaction, MapperMetadata } from \"../transactionMapper\";\r\nimport { Transaction } from \"@/types\";\r\nimport { LedgerTransaction } from \"@/domain/ledger\";\r\nimport { LedgerStatus, TransactionModuleKey } from \"@/shared/constants/ledger\";\r\n\r\ndescribe(\"transactionMapper\", () => {\r\n    const mockMeta: MapperMetadata = {\r\n        profileNameMap: new Map([[\"u1\", \"User One\"]]),\r\n        accountNameMap: new Map([[\"acc1\", \"Account One\"]]),\r\n        merchantNameMap: new Map([[\"m1\", \"Merchant One\"]]),\r\n        entityTypeMap: new Map([[\"ent1\", \"ue\"]]),\r\n        entityNameMap: new Map([[\"ent1\", \"UE Test\"]]),\r\n    };\r\n\r\n    describe(\"mapLegacyTransaction\", () => {\r\n        it(\"should map legacy transaction correctly\", () => {\r\n            const legacyTx: Transaction = {\r\n                id: \"tx1\",\r\n                amount: 100,\r\n                description: \"Legacy Test\",\r\n                created_at: \"2024-01-01T10:00:00Z\",\r\n                created_by: \"u1\",\r\n                source_account_id: \"acc1\",\r\n                destination_account_id: \"m1\",\r\n                merchant_id: \"m1\",\r\n                status: \"completed\",\r\n                transaction_date: \"2024-01-01\",\r\n                module: \"gasto\",\r\n                direction: \"out\",\r\n                payment_method: \"cash\",\r\n                shift: \"matutino\",\r\n                entity_id: \"ent1\",\r\n                notes: \"\",\r\n                origin_fund: \"fund\",\r\n                parent_transaction_id: null,\r\n                ledger_status: \"validated\"\r\n            };\r\n\r\n            const result = mapLegacyTransaction(legacyTx, mockMeta);\r\n\r\n            expect(result.creator_name).toBe(\"User One\");\r\n            expect(result.source_account_name).toBe(\"Account One\");\r\n            expect(result.destination_account_name).toBe(\"Merchant One\");\r\n            expect(result.merchant_name).toBe(\"Merchant One\");\r\n        });\r\n    });\r\n\r\n    describe(\"mapLedgerTransaction\", () => {\r\n        it(\"should map ledger transaction (income) correctly\", () => {\r\n            const ledgerTx: any = { // Using any to avoid complex nested partials for mock\r\n                id: \"ltx1\",\r\n                amount_cents: 5000,\r\n                description: \"Ledger Income\",\r\n                type: \"income\",\r\n                status: LedgerStatus.VALIDATED,\r\n                created_at: \"2024-01-01T10:00:00Z\",\r\n                created_by: \"u1\",\r\n                source_account: \"ext:external\",\r\n                destination_account: \"acc1\",\r\n                entity_id: \"ent1\",\r\n                metadata: {\r\n                    module: TransactionModuleKey.RECURSOS,\r\n                    transaction_date: \"2024-01-01\"\r\n                }\r\n            };\r\n\r\n            const result = mapLedgerTransaction(ledgerTx, mockMeta);\r\n\r\n            expect(result.amount).toBe(50);\r\n            expect(result.direction).toBe(\"in\");\r\n            expect(result.source_account_name).toBe(\"Account One\"); // Prioritize internal account\r\n            expect(result.destination_account_name).toBe(\"Account One\");\r\n            expect(result.creator_name).toBe(\"User One\");\r\n            expect(result.entity_name).toBe(\"UE Test\");\r\n        });\r\n\r\n        it(\"should map adjustment based on amount sign\", () => {\r\n            const posAdj: any = {\r\n                id: \"adj1\",\r\n                amount_cents: 1000,\r\n                type: \"adjustment\",\r\n                status: LedgerStatus.VALIDATED,\r\n                created_at: \"2024-01-01T10:00:00Z\",\r\n                created_by: \"u1\",\r\n                source_account: \"acc1\",\r\n                metadata: {}\r\n            };\r\n\r\n            const negAdj: any = {\r\n                id: \"adj2\",\r\n                amount_cents: -1000,\r\n                type: \"adjustment\",\r\n                status: LedgerStatus.VALIDATED,\r\n                created_at: \"2024-01-01T10:00:00Z\",\r\n                created_by: \"u1\",\r\n                source_account: \"acc1\",\r\n                metadata: {}\r\n            };\r\n\r\n            expect(mapLedgerTransaction(posAdj, mockMeta).direction).toBe(\"in\");\r\n            expect(mapLedgerTransaction(negAdj, mockMeta).direction).toBe(\"out\");\r\n        });\r\n    });\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\mappers\\transactionMapper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\schemas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\search-filter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\query\\invalidation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\services\\accountService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":36,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":36,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/shared/lib/utils\"\r\n\r\nconst badgeVariants = cva(\r\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\r\n        secondary:\r\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        destructive:\r\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\r\n        outline: \"text-foreground\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface BadgeProps\r\n  extends React.HTMLAttributes<HTMLDivElement>,\r\n  VariantProps<typeof badgeVariants> { }\r\n\r\nfunction Badge({ className, variant, ...props }: BadgeProps) {\r\n  return (\r\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\r\n  )\r\n}\r\n\r\nexport { Badge, badgeVariants }\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":47,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":47,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"@/shared/lib/utils\";\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\r\n        destructive: \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\r\n        outline: \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\r\n        secondary: \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\r\n        link: \"text-primary underline-offset-4 hover:underline\",\r\n      },\r\n      size: {\r\n        default: \"h-10 px-4 py-2\",\r\n        sm: \"h-9 rounded-md px-3\",\r\n        lg: \"h-11 rounded-md px-8\",\r\n        icon: \"h-10 w-10\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  },\r\n);\r\n\r\nexport interface ButtonProps\r\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\r\n    VariantProps<typeof buttonVariants> {\r\n  asChild?: boolean;\r\n}\r\n\r\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\r\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : \"button\";\r\n    return <Comp className={cn(buttonVariants({ variant, size, className }))} ref={ref} {...props} />;\r\n  },\r\n);\r\nButton.displayName = \"Button\";\r\n\r\nexport { Button, buttonVariants };\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\form.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":129,"column":10,"nodeType":"Identifier","messageId":"namedExport","endLine":129,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport { Controller, ControllerProps, FieldPath, FieldValues, FormProvider, useFormContext } from \"react-hook-form\";\r\n\r\nimport { cn } from \"@/shared/lib/utils\";\r\nimport { Label } from \"@/shared/ui/label\";\r\n\r\nconst Form = FormProvider;\r\n\r\ntype FormFieldContextValue<\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\r\n> = {\r\n  name: TName;\r\n};\r\n\r\nconst FormFieldContext = React.createContext<FormFieldContextValue>({} as FormFieldContextValue);\r\n\r\nconst FormField = <\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\r\n>({\r\n  ...props\r\n}: ControllerProps<TFieldValues, TName>) => {\r\n  return (\r\n    <FormFieldContext.Provider value={{ name: props.name }}>\r\n      <Controller {...props} />\r\n    </FormFieldContext.Provider>\r\n  );\r\n};\r\n\r\nconst useFormField = () => {\r\n  const fieldContext = React.useContext(FormFieldContext);\r\n  const itemContext = React.useContext(FormItemContext);\r\n  const { getFieldState, formState } = useFormContext();\r\n\r\n  const fieldState = getFieldState(fieldContext.name, formState);\r\n\r\n  if (!fieldContext) {\r\n    throw new Error(\"useFormField should be used within <FormField>\");\r\n  }\r\n\r\n  const { id } = itemContext;\r\n\r\n  return {\r\n    id,\r\n    name: fieldContext.name,\r\n    formItemId: `${id}-form-item`,\r\n    formDescriptionId: `${id}-form-item-description`,\r\n    formMessageId: `${id}-form-item-message`,\r\n    ...fieldState,\r\n  };\r\n};\r\n\r\ntype FormItemContextValue = {\r\n  id: string;\r\n};\r\n\r\nconst FormItemContext = React.createContext<FormItemContextValue>({} as FormItemContextValue);\r\n\r\nconst FormItem = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\r\n  ({ className, ...props }, ref) => {\r\n    const id = React.useId();\r\n\r\n    return (\r\n      <FormItemContext.Provider value={{ id }}>\r\n        <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\r\n      </FormItemContext.Provider>\r\n    );\r\n  },\r\n);\r\nFormItem.displayName = \"FormItem\";\r\n\r\nconst FormLabel = React.forwardRef<\r\n  React.ElementRef<typeof LabelPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\r\n>(({ className, ...props }, ref) => {\r\n  const { error, formItemId } = useFormField();\r\n\r\n  return <Label ref={ref} className={cn(error && \"text-destructive\", className)} htmlFor={formItemId} {...props} />;\r\n});\r\nFormLabel.displayName = \"FormLabel\";\r\n\r\nconst FormControl = React.forwardRef<React.ElementRef<typeof Slot>, React.ComponentPropsWithoutRef<typeof Slot>>(\r\n  ({ ...props }, ref) => {\r\n    const { error, formItemId, formDescriptionId, formMessageId } = useFormField();\r\n\r\n    return (\r\n      <Slot\r\n        ref={ref}\r\n        id={formItemId}\r\n        aria-describedby={!error ? `${formDescriptionId}` : `${formDescriptionId} ${formMessageId}`}\r\n        aria-invalid={!!error}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nFormControl.displayName = \"FormControl\";\r\n\r\nconst FormDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(\r\n  ({ className, ...props }, ref) => {\r\n    const { formDescriptionId } = useFormField();\r\n\r\n    return <p ref={ref} id={formDescriptionId} className={cn(\"text-sm text-muted-foreground\", className)} {...props} />;\r\n  },\r\n);\r\nFormDescription.displayName = \"FormDescription\";\r\n\r\nconst FormMessage = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(\r\n  ({ className, children, ...props }, ref) => {\r\n    const { error, formMessageId } = useFormField();\r\n    const body = error ? String(error?.message) : children;\r\n\r\n    if (!body) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <p ref={ref} id={formMessageId} className={cn(\"text-sm font-medium text-destructive\", className)} {...props}>\r\n        {body}\r\n      </p>\r\n    );\r\n  },\r\n);\r\nFormMessage.displayName = \"FormMessage\";\r\n\r\nexport { useFormField, Form, FormItem, FormLabel, FormControl, FormDescription, FormMessage, FormField };\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\navigation-menu.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":111,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":111,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\";\r\nimport { cva } from \"class-variance-authority\";\r\nimport { ChevronDown } from \"lucide-react\";\r\n\r\nimport { cn } from \"@/shared/lib/utils\";\r\n\r\nconst NavigationMenu = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\r\n>(({ className, children, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\"relative z-10 flex max-w-max flex-1 items-center justify-center\", className)}\r\n    {...props}\r\n  >\r\n    {children}\r\n    <NavigationMenuViewport />\r\n  </NavigationMenuPrimitive.Root>\r\n));\r\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName;\r\n\r\nconst NavigationMenuList = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.List\r\n    ref={ref}\r\n    className={cn(\"group flex flex-1 list-none items-center justify-center space-x-1\", className)}\r\n    {...props}\r\n  />\r\n));\r\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName;\r\n\r\nconst NavigationMenuItem = NavigationMenuPrimitive.Item;\r\n\r\nconst navigationMenuTriggerStyle = cva(\r\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\",\r\n);\r\n\r\nconst NavigationMenuTrigger = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\r\n>(({ className, children, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\r\n    {...props}\r\n  >\r\n    {children}{\" \"}\r\n    <ChevronDown\r\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\r\n      aria-hidden=\"true\"\r\n    />\r\n  </NavigationMenuPrimitive.Trigger>\r\n));\r\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName;\r\n\r\nconst NavigationMenuContent = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName;\r\n\r\nconst NavigationMenuLink = NavigationMenuPrimitive.Link;\r\n\r\nconst NavigationMenuViewport = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\r\n>(({ className, ...props }, ref) => (\r\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\r\n    <NavigationMenuPrimitive.Viewport\r\n      className={cn(\r\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\r\n        className,\r\n      )}\r\n      ref={ref}\r\n      {...props}\r\n    />\r\n  </div>\r\n));\r\nNavigationMenuViewport.displayName = NavigationMenuPrimitive.Viewport.displayName;\r\n\r\nconst NavigationMenuIndicator = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Indicator\r\n    ref={ref}\r\n    className={cn(\r\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  >\r\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\r\n  </NavigationMenuPrimitive.Indicator>\r\n));\r\nNavigationMenuIndicator.displayName = NavigationMenuPrimitive.Indicator.displayName;\r\n\r\nexport {\r\n  navigationMenuTriggerStyle,\r\n  NavigationMenu,\r\n  NavigationMenuList,\r\n  NavigationMenuItem,\r\n  NavigationMenuContent,\r\n  NavigationMenuTrigger,\r\n  NavigationMenuLink,\r\n  NavigationMenuIndicator,\r\n  NavigationMenuViewport,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\sidebar.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":636,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":636,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport { VariantProps, cva } from \"class-variance-authority\";\r\nimport { PanelLeft } from \"lucide-react\";\r\n\r\nimport { useIsMobile } from \"@/shared/hooks/use-mobile\";\r\nimport { cn } from \"@/shared/lib/utils\";\r\nimport { Button } from \"@/shared/ui/button\";\r\nimport { Input } from \"@/shared/ui/input\";\r\nimport { Separator } from \"@/shared/ui/separator\";\r\nimport { Sheet, SheetContent } from \"@/shared/ui/sheet\";\r\nimport { Skeleton } from \"@/shared/ui/skeleton\";\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/shared/ui/tooltip\";\r\n\r\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\";\r\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;\r\nconst SIDEBAR_WIDTH = \"16rem\";\r\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\";\r\nconst SIDEBAR_WIDTH_ICON = \"3rem\";\r\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\";\r\n\r\ntype SidebarContext = {\r\n  state: \"expanded\" | \"collapsed\";\r\n  open: boolean;\r\n  setOpen: (open: boolean) => void;\r\n  openMobile: boolean;\r\n  setOpenMobile: (open: boolean) => void;\r\n  isMobile: boolean;\r\n  toggleSidebar: () => void;\r\n};\r\n\r\nconst SidebarContext = React.createContext<SidebarContext | null>(null);\r\n\r\nfunction useSidebar() {\r\n  const context = React.useContext(SidebarContext);\r\n  if (!context) {\r\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\");\r\n  }\r\n\r\n  return context;\r\n}\r\n\r\nconst SidebarProvider = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    defaultOpen?: boolean;\r\n    open?: boolean;\r\n    onOpenChange?: (open: boolean) => void;\r\n  }\r\n>(({ defaultOpen = true, open: openProp, onOpenChange: setOpenProp, className, style, children, ...props }, ref) => {\r\n  const isMobile = useIsMobile();\r\n  const [openMobile, setOpenMobile] = React.useState(false);\r\n\r\n  // This is the internal state of the sidebar.\r\n  // We use openProp and setOpenProp for control from outside the component.\r\n  const [_open, _setOpen] = React.useState(defaultOpen);\r\n  const open = openProp ?? _open;\r\n  const setOpen = React.useCallback(\r\n    (value: boolean | ((value: boolean) => boolean)) => {\r\n      const openState = typeof value === \"function\" ? value(open) : value;\r\n      if (setOpenProp) {\r\n        setOpenProp(openState);\r\n      } else {\r\n        _setOpen(openState);\r\n      }\r\n\r\n      // This sets the cookie to keep the sidebar state.\r\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;\r\n    },\r\n    [setOpenProp, open],\r\n  );\r\n\r\n  // Helper to toggle the sidebar.\r\n  const toggleSidebar = React.useCallback(() => {\r\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);\r\n  }, [isMobile, setOpen, setOpenMobile]);\r\n\r\n  // Adds a keyboard shortcut to toggle the sidebar.\r\n  React.useEffect(() => {\r\n    const handleKeyDown = (event: KeyboardEvent) => {\r\n      if (event.key === SIDEBAR_KEYBOARD_SHORTCUT && (event.metaKey || event.ctrlKey)) {\r\n        event.preventDefault();\r\n        toggleSidebar();\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\r\n  }, [toggleSidebar]);\r\n\r\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\r\n  // This makes it easier to style the sidebar with Tailwind classes.\r\n  const state = open ? \"expanded\" : \"collapsed\";\r\n\r\n  const contextValue = React.useMemo<SidebarContext>(\r\n    () => ({\r\n      state,\r\n      open,\r\n      setOpen,\r\n      isMobile,\r\n      openMobile,\r\n      setOpenMobile,\r\n      toggleSidebar,\r\n    }),\r\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],\r\n  );\r\n\r\n  return (\r\n    <SidebarContext.Provider value={contextValue}>\r\n      <TooltipProvider delayDuration={0}>\r\n        <div\r\n          style={\r\n            {\r\n              \"--sidebar-width\": SIDEBAR_WIDTH,\r\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\r\n              ...style,\r\n            } as React.CSSProperties\r\n          }\r\n          className={cn(\"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\", className)}\r\n          ref={ref}\r\n          {...props}\r\n        >\r\n          {children}\r\n        </div>\r\n      </TooltipProvider>\r\n    </SidebarContext.Provider>\r\n  );\r\n});\r\nSidebarProvider.displayName = \"SidebarProvider\";\r\n\r\nconst Sidebar = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    side?: \"left\" | \"right\";\r\n    variant?: \"sidebar\" | \"floating\" | \"inset\";\r\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\";\r\n  }\r\n>(({ side = \"left\", variant = \"sidebar\", collapsible = \"offcanvas\", className, children, ...props }, ref) => {\r\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();\r\n\r\n  if (collapsible === \"none\") {\r\n    return (\r\n      <div\r\n        className={cn(\"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\", className)}\r\n        ref={ref}\r\n        {...props}\r\n      >\r\n        {children}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (isMobile) {\r\n    return (\r\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\r\n        <SheetContent\r\n          data-sidebar=\"sidebar\"\r\n          data-mobile=\"true\"\r\n          className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\r\n          style={\r\n            {\r\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\r\n            } as React.CSSProperties\r\n          }\r\n          side={side}\r\n        >\r\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\r\n        </SheetContent>\r\n      </Sheet>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      className=\"group peer hidden text-sidebar-foreground md:block\"\r\n      data-state={state}\r\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\r\n      data-variant={variant}\r\n      data-side={side}\r\n    >\r\n      {/* This is what handles the sidebar gap on desktop */}\r\n      <div\r\n        className={cn(\r\n          \"relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\r\n          \"group-data-[collapsible=offcanvas]:w-0\",\r\n          \"group-data-[side=right]:rotate-180\",\r\n          variant === \"floating\" || variant === \"inset\"\r\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\r\n            : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\",\r\n        )}\r\n      />\r\n      <div\r\n        className={cn(\r\n          \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\r\n          side === \"left\"\r\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\r\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\r\n          // Adjust the padding for floating and inset variants.\r\n          variant === \"floating\" || variant === \"inset\"\r\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\r\n            : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      >\r\n        <div\r\n          data-sidebar=\"sidebar\"\r\n          className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\r\n        >\r\n          {children}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\nSidebar.displayName = \"Sidebar\";\r\n\r\nconst SidebarTrigger = React.forwardRef<React.ElementRef<typeof Button>, React.ComponentProps<typeof Button>>(\r\n  ({ className, onClick, ...props }, ref) => {\r\n    const { toggleSidebar } = useSidebar();\r\n\r\n    return (\r\n      <Button\r\n        ref={ref}\r\n        data-sidebar=\"trigger\"\r\n        variant=\"ghost\"\r\n        size=\"icon\"\r\n        className={cn(\"h-7 w-7\", className)}\r\n        onClick={(event) => {\r\n          onClick?.(event);\r\n          toggleSidebar();\r\n        }}\r\n        {...props}\r\n      >\r\n        <PanelLeft />\r\n        <span className=\"sr-only\">Toggle Sidebar</span>\r\n      </Button>\r\n    );\r\n  },\r\n);\r\nSidebarTrigger.displayName = \"SidebarTrigger\";\r\n\r\nconst SidebarRail = React.forwardRef<HTMLButtonElement, React.ComponentProps<\"button\">>(\r\n  ({ className, ...props }, ref) => {\r\n    const { toggleSidebar } = useSidebar();\r\n\r\n    return (\r\n      <button\r\n        ref={ref}\r\n        data-sidebar=\"rail\"\r\n        aria-label=\"Toggle Sidebar\"\r\n        tabIndex={-1}\r\n        onClick={toggleSidebar}\r\n        title=\"Toggle Sidebar\"\r\n        className={cn(\r\n          \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex\",\r\n          \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\r\n          \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\r\n          \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\r\n          \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\r\n          \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nSidebarRail.displayName = \"SidebarRail\";\r\n\r\nconst SidebarInset = React.forwardRef<HTMLDivElement, React.ComponentProps<\"main\">>(({ className, ...props }, ref) => {\r\n  return (\r\n    <main\r\n      ref={ref}\r\n      className={cn(\r\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\r\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nSidebarInset.displayName = \"SidebarInset\";\r\n\r\nconst SidebarInput = React.forwardRef<React.ElementRef<typeof Input>, React.ComponentProps<typeof Input>>(\r\n  ({ className, ...props }, ref) => {\r\n    return (\r\n      <Input\r\n        ref={ref}\r\n        data-sidebar=\"input\"\r\n        className={cn(\r\n          \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nSidebarInput.displayName = \"SidebarInput\";\r\n\r\nconst SidebarHeader = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\r\n  return <div ref={ref} data-sidebar=\"header\" className={cn(\"flex flex-col gap-2 p-2\", className)} {...props} />;\r\n});\r\nSidebarHeader.displayName = \"SidebarHeader\";\r\n\r\nconst SidebarFooter = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\r\n  return <div ref={ref} data-sidebar=\"footer\" className={cn(\"flex flex-col gap-2 p-2\", className)} {...props} />;\r\n});\r\nSidebarFooter.displayName = \"SidebarFooter\";\r\n\r\nconst SidebarSeparator = React.forwardRef<React.ElementRef<typeof Separator>, React.ComponentProps<typeof Separator>>(\r\n  ({ className, ...props }, ref) => {\r\n    return (\r\n      <Separator\r\n        ref={ref}\r\n        data-sidebar=\"separator\"\r\n        className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nSidebarSeparator.displayName = \"SidebarSeparator\";\r\n\r\nconst SidebarContent = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"content\"\r\n      className={cn(\r\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nSidebarContent.displayName = \"SidebarContent\";\r\n\r\nconst SidebarGroup = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"group\"\r\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nSidebarGroup.displayName = \"SidebarGroup\";\r\n\r\nconst SidebarGroupLabel = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\"> & { asChild?: boolean }>(\r\n  ({ className, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : \"div\";\r\n\r\n    return (\r\n      <Comp\r\n        ref={ref}\r\n        data-sidebar=\"group-label\"\r\n        className={cn(\r\n          \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n          \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\";\r\n\r\nconst SidebarGroupAction = React.forwardRef<HTMLButtonElement, React.ComponentProps<\"button\"> & { asChild?: boolean }>(\r\n  ({ className, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : \"button\";\r\n\r\n    return (\r\n      <Comp\r\n        ref={ref}\r\n        data-sidebar=\"group-action\"\r\n        className={cn(\r\n          \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n          // Increases the hit area of the button on mobile.\r\n          \"after:absolute after:-inset-2 after:md:hidden\",\r\n          \"group-data-[collapsible=icon]:hidden\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nSidebarGroupAction.displayName = \"SidebarGroupAction\";\r\n\r\nconst SidebarGroupContent = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(\r\n  ({ className, ...props }, ref) => (\r\n    <div ref={ref} data-sidebar=\"group-content\" className={cn(\"w-full text-sm\", className)} {...props} />\r\n  ),\r\n);\r\nSidebarGroupContent.displayName = \"SidebarGroupContent\";\r\n\r\nconst SidebarMenu = React.forwardRef<HTMLUListElement, React.ComponentProps<\"ul\">>(({ className, ...props }, ref) => (\r\n  <ul ref={ref} data-sidebar=\"menu\" className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)} {...props} />\r\n));\r\nSidebarMenu.displayName = \"SidebarMenu\";\r\n\r\nconst SidebarMenuItem = React.forwardRef<HTMLLIElement, React.ComponentProps<\"li\">>(({ className, ...props }, ref) => (\r\n  <li ref={ref} data-sidebar=\"menu-item\" className={cn(\"group/menu-item relative\", className)} {...props} />\r\n));\r\nSidebarMenuItem.displayName = \"SidebarMenuItem\";\r\n\r\nconst sidebarMenuButtonVariants = cva(\r\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\r\n        outline:\r\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\r\n      },\r\n      size: {\r\n        default: \"h-8 text-sm\",\r\n        sm: \"h-7 text-xs\",\r\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  },\r\n);\r\n\r\nconst SidebarMenuButton = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\"> & {\r\n    asChild?: boolean;\r\n    isActive?: boolean;\r\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>;\r\n  } & VariantProps<typeof sidebarMenuButtonVariants>\r\n>(({ asChild = false, isActive = false, variant = \"default\", size = \"default\", tooltip, className, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"button\";\r\n  const { isMobile, state } = useSidebar();\r\n\r\n  const button = (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-button\"\r\n      data-size={size}\r\n      data-active={isActive}\r\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\r\n      {...props}\r\n    />\r\n  );\r\n\r\n  if (!tooltip) {\r\n    return button;\r\n  }\r\n\r\n  if (typeof tooltip === \"string\") {\r\n    tooltip = {\r\n      children: tooltip,\r\n    };\r\n  }\r\n\r\n  return (\r\n    <Tooltip>\r\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\r\n      <TooltipContent side=\"right\" align=\"center\" hidden={state !== \"collapsed\" || isMobile} {...tooltip} />\r\n    </Tooltip>\r\n  );\r\n});\r\nSidebarMenuButton.displayName = \"SidebarMenuButton\";\r\n\r\nconst SidebarMenuAction = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\"> & {\r\n    asChild?: boolean;\r\n    showOnHover?: boolean;\r\n  }\r\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"button\";\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-action\"\r\n      className={cn(\r\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n        // Increases the hit area of the button on mobile.\r\n        \"after:absolute after:-inset-2 after:md:hidden\",\r\n        \"peer-data-[size=sm]/menu-button:top-1\",\r\n        \"peer-data-[size=default]/menu-button:top-1.5\",\r\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        showOnHover &&\r\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nSidebarMenuAction.displayName = \"SidebarMenuAction\";\r\n\r\nconst SidebarMenuBadge = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(\r\n  ({ className, ...props }, ref) => (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"menu-badge\"\r\n      className={cn(\r\n        \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\r\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\r\n        \"peer-data-[size=sm]/menu-button:top-1\",\r\n        \"peer-data-[size=default]/menu-button:top-1.5\",\r\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  ),\r\n);\r\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\";\r\n\r\nconst SidebarMenuSkeleton = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    showIcon?: boolean;\r\n  }\r\n>(({ className, showIcon = false, ...props }, ref) => {\r\n  // Random width between 50 to 90%.\r\n  const width = React.useMemo(() => {\r\n    return `${Math.floor(Math.random() * 40) + 50}%`;\r\n  }, []);\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"menu-skeleton\"\r\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\r\n      {...props}\r\n    >\r\n      {showIcon && <Skeleton className=\"size-4 rounded-md\" data-sidebar=\"menu-skeleton-icon\" />}\r\n      <Skeleton\r\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\r\n        data-sidebar=\"menu-skeleton-text\"\r\n        style={\r\n          {\r\n            \"--skeleton-width\": width,\r\n          } as React.CSSProperties\r\n        }\r\n      />\r\n    </div>\r\n  );\r\n});\r\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\";\r\n\r\nconst SidebarMenuSub = React.forwardRef<HTMLUListElement, React.ComponentProps<\"ul\">>(\r\n  ({ className, ...props }, ref) => (\r\n    <ul\r\n      ref={ref}\r\n      data-sidebar=\"menu-sub\"\r\n      className={cn(\r\n        \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  ),\r\n);\r\nSidebarMenuSub.displayName = \"SidebarMenuSub\";\r\n\r\nconst SidebarMenuSubItem = React.forwardRef<HTMLLIElement, React.ComponentProps<\"li\">>(({ ...props }, ref) => (\r\n  <li ref={ref} {...props} />\r\n));\r\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\";\r\n\r\nconst SidebarMenuSubButton = React.forwardRef<\r\n  HTMLAnchorElement,\r\n  React.ComponentProps<\"a\"> & {\r\n    asChild?: boolean;\r\n    size?: \"sm\" | \"md\";\r\n    isActive?: boolean;\r\n  }\r\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"a\";\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-sub-button\"\r\n      data-size={size}\r\n      data-active={isActive}\r\n      className={cn(\r\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\r\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\r\n        size === \"sm\" && \"text-xs\",\r\n        size === \"md\" && \"text-sm\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\";\r\n\r\nexport {\r\n  Sidebar,\r\n  SidebarContent,\r\n  SidebarFooter,\r\n  SidebarGroup,\r\n  SidebarGroupAction,\r\n  SidebarGroupContent,\r\n  SidebarGroupLabel,\r\n  SidebarHeader,\r\n  SidebarInput,\r\n  SidebarInset,\r\n  SidebarMenu,\r\n  SidebarMenuAction,\r\n  SidebarMenuBadge,\r\n  SidebarMenuButton,\r\n  SidebarMenuItem,\r\n  SidebarMenuSkeleton,\r\n  SidebarMenuSub,\r\n  SidebarMenuSubButton,\r\n  SidebarMenuSubItem,\r\n  SidebarProvider,\r\n  SidebarRail,\r\n  SidebarSeparator,\r\n  SidebarTrigger,\r\n  useSidebar,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\sonner.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":27,"column":19,"nodeType":"Identifier","messageId":"namedExport","endLine":27,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTheme } from \"next-themes\";\r\nimport { Toaster as Sonner, toast } from \"sonner\";\r\n\r\ntype ToasterProps = React.ComponentProps<typeof Sonner>;\r\n\r\nconst Toaster = ({ ...props }: ToasterProps) => {\r\n  const { theme = \"system\" } = useTheme();\r\n\r\n  return (\r\n    <Sonner\r\n      theme={theme as ToasterProps[\"theme\"]}\r\n      className=\"toaster group\"\r\n      toastOptions={{\r\n        classNames: {\r\n          toast:\r\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\r\n          description: \"group-[.toast]:text-muted-foreground\",\r\n          actionButton: \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\r\n          cancelButton: \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\r\n        },\r\n      }}\r\n      {...props}\r\n    />\r\n  );\r\n};\r\n\r\nexport { Toaster, toast };\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\toggle.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":37,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":37,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"@/shared/lib/utils\";\r\n\r\nconst toggleVariants = cva(\r\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-transparent\",\r\n        outline: \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\r\n      },\r\n      size: {\r\n        default: \"h-10 px-3\",\r\n        sm: \"h-9 px-2.5\",\r\n        lg: \"h-11 px-5\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  },\r\n);\r\n\r\nconst Toggle = React.forwardRef<\r\n  React.ElementRef<typeof TogglePrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> & VariantProps<typeof toggleVariants>\r\n>(({ className, variant, size, ...props }, ref) => (\r\n  <TogglePrimitive.Root ref={ref} className={cn(toggleVariants({ variant, size, className }))} {...props} />\r\n));\r\n\r\nToggle.displayName = TogglePrimitive.Root.displayName;\r\n\r\nexport { Toggle, toggleVariants };\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\shared\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\test\\integration\\ImportTest.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\test\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\test\\test-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\types\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Projetos\\CMCB-XI\\vitest.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
